# Compass Integration - Online Testing Checklist

**Date**: 2025-10-30
**Status**: Ready for Testing
**Environment**: Production/Staging

---

## üöÄ Push Status

‚úÖ **6 commits pushed to main**:
- `d9a7438b` - Initial analysis document
- `34dd27ab` - RAG integration (Phase 3)
- `938c3c10` - Frontend UI (Phase 2)
- `48bf2404` - Backend API (Phase 1)
- `bc4cc843` - Documentation organization
- `d3838bfc` - Middleware support

---

## üìã Pre-Testing Setup

### 1. Environment Variables (Backend)

V√©rifier que ces variables sont configur√©es sur le serveur :

```bash
# Required
COMPASS_API_URL=https://compass.intelia.com/api/v1
COMPASS_API_TOKEN=your_token_here

# Optional (defaults shown)
COMPASS_REQUEST_TIMEOUT=10
COMPASS_CACHE_ENABLED=true
COMPASS_CACHE_TTL=300
```

**V√©rification** :
```bash
# SSH into server
ssh user@your-server.com

# Check environment
env | grep COMPASS

# Or check .env file
cat /path/to/backend/.env | grep COMPASS
```

### 2. Database Migration

La table `user_compass_config` doit √™tre cr√©√©e (d√©j√† fait via DBeaver) :

```sql
-- Verify table exists
SELECT table_name, column_name, data_type
FROM information_schema.columns
WHERE table_name = 'user_compass_config'
ORDER BY ordinal_position;

-- Expected: 6 columns (id, user_id, compass_enabled, barns, created_at, updated_at)
```

### 3. Backend Deployment

**Option A - Auto Deploy (si CI/CD configur√©)** :
- Le push devrait d√©clencher le d√©ploiement automatique
- V√©rifier le statut du build/deploy pipeline

**Option B - Manuel Deploy** :
```bash
# SSH into server
ssh user@your-server.com

# Pull latest changes
cd /path/to/intelia-cognito
git pull origin main

# Restart backend
pm2 restart backend
# OR
systemctl restart intelia-backend

# Check logs
pm2 logs backend --lines 100
# OR
journalctl -u intelia-backend -f
```

### 4. Frontend Deployment

**Option A - Auto Deploy (Vercel/Netlify)** :
- Le push devrait d√©clencher le build automatique
- V√©rifier le statut du deployment

**Option B - Manuel Build** :
```bash
# SSH into server OR locally
cd frontend
npm install
npm run build

# Deploy (method depends on hosting)
# Vercel: vercel deploy --prod
# Netlify: netlify deploy --prod
# Manual: rsync -avz .next/ user@server:/app/frontend/
```

---

## ‚úÖ Backend Testing

### Test 1: Backend Startup

**Objectif** : V√©rifier que le backend d√©marre sans erreurs

**√âtapes** :
```bash
# Check logs for Compass initialization
pm2 logs backend | grep -i compass
```

**R√©sultat attendu** :
```
‚úÖ Compass router imported with 9 routes
‚úÖ Compass router mounted
‚úÖ Compass Integration enabled!
‚úÖ Compass API service initialized
```

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 2: Connection Status (Admin)

**Objectif** : V√©rifier la connexion √† l'API Compass

**√âtapes** :
1. Ouvrir un terminal
2. Obtenir un JWT token admin (connexion √† l'app)
3. Ex√©cuter :

```bash
curl -H "Authorization: Bearer YOUR_ADMIN_JWT" \
     https://api.intelia.com/api/v1/compass/admin/connection-status
```

**R√©sultat attendu** :
```json
{
  "status": "connected",
  "api_url": "https://compass.intelia.com/api/v1",
  "has_token": true,
  "device_count": 5
}
```

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Notes** : _______________________________________________

---

### Test 3: Device List (Admin)

**Objectif** : Lister les appareils Compass disponibles

**√âtapes** :
```bash
curl -H "Authorization: Bearer YOUR_ADMIN_JWT" \
     https://api.intelia.com/api/v1/compass/admin/devices
```

**R√©sultat attendu** :
```json
{
  "success": true,
  "data": [
    {
      "id": "849",
      "name": "Poulailler A",
      "entity_id": 123
    },
    {
      "id": "850",
      "name": "Poulailler B",
      "entity_id": 123
    }
  ]
}
```

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Device Count** : _______

---

### Test 4: User Configs List (Admin)

**Objectif** : Lister toutes les configurations utilisateur

**√âtapes** :
```bash
curl -H "Authorization: Bearer YOUR_ADMIN_JWT" \
     https://api.intelia.com/api/v1/compass/admin/users
```

**R√©sultat attendu** :
```json
{
  "success": true,
  "data": []
}
```
*(Vide au d√©but - normal)*

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 5: Unauthorized Access (Security)

**Objectif** : V√©rifier que les endpoints admin sont prot√©g√©s

**√âtapes** :
```bash
# Sans token
curl https://api.intelia.com/api/v1/compass/admin/devices

# Avec token utilisateur normal (non-admin)
curl -H "Authorization: Bearer USER_JWT" \
     https://api.intelia.com/api/v1/compass/admin/devices
```

**R√©sultat attendu** :
```json
{
  "detail": "Access denied - admin privileges required",
  "error": "insufficient_privileges"
}
```

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## ‚úÖ Frontend Testing

### Test 6: Statistics Page Access

**Objectif** : V√©rifier l'acc√®s √† la page Statistics (admin uniquement)

**√âtapes** :
1. Ouvrir https://expert.intelia.com
2. Se connecter avec un compte admin
3. Naviguer vers Statistics page
4. Chercher l'onglet "Compass"

**R√©sultat attendu** :
- ‚úÖ Onglet "Compass" visible dans la navigation
- ‚úÖ Autres onglets : Dashboard, Questions, Invitations, etc.

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 7: Compass Tab UI

**Objectif** : V√©rifier l'interface Compass Tab

**√âtapes** :
1. Cliquer sur l'onglet "Compass"
2. V√©rifier les √©l√©ments affich√©s

**R√©sultat attendu** :
- ‚úÖ Header avec titre "Compass Integration"
- ‚úÖ Bouton "Actualiser"
- ‚úÖ Connection Status Card (vert si connect√©)
- ‚úÖ API URL affich√©
- ‚úÖ Device count affich√©
- ‚úÖ User configurations table (vide au d√©but)

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Screenshot** : _______________________

---

### Test 8: Connection Status Display

**Objectif** : V√©rifier l'affichage du statut de connexion

**√âtapes** :
1. Dans Compass Tab, regarder la "Connection Status Card"
2. Noter les informations affich√©es

**R√©sultat attendu** :
- ‚úÖ Badge vert "Connect√©" ou rouge "D√©connect√©"
- ‚úÖ URL de l'API Compass
- ‚úÖ "Token configur√© : Oui"
- ‚úÖ Nombre d'appareils disponibles

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Device Count** : _______

---

### Test 9: Configure User Modal

**Objectif** : Tester l'ouverture du modal de configuration

**√âtapes** :
1. Cliquer sur "Configurer" pour un utilisateur
2. V√©rifier que le modal s'ouvre

**R√©sultat attendu** :
- ‚úÖ Modal s'ouvre avec titre "Configuration Compass"
- ‚úÖ Email utilisateur affich√©
- ‚úÖ Toggle "Activer Compass" visible
- ‚úÖ Section "Poulaillers configur√©s" visible
- ‚úÖ Bouton "Ajouter un poulailler" visible
- ‚úÖ Boutons "Annuler" et "Sauvegarder" visible

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 10: Add Barn Configuration

**Objectif** : Ajouter une configuration de poulailler

**√âtapes** :
1. Dans le modal, activer "Activer Compass" (toggle ON)
2. Cliquer sur "Ajouter un poulailler"
3. Remplir :
   - Appareil Compass : S√©lectionner un device (ex: "Poulailler A #849")
   - Num√©ro client : "2"
   - Nom du poulailler : "Poulailler Test"
4. Cliquer "Sauvegarder"

**R√©sultat attendu** :
- ‚úÖ Poulailler ajout√© avec succ√®s
- ‚úÖ Modal se ferme
- ‚úÖ User table se met √† jour
- ‚úÖ Badge "Activ√©" vert visible

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 11: Preview Real-Time Data

**Objectif** : Pr√©visualiser les donn√©es temps r√©el

**√âtapes** :
1. Dans la table, cliquer "Pr√©visualiser" pour l'utilisateur configur√©
2. V√©rifier l'affichage des donn√©es

**R√©sultat attendu** :
- ‚úÖ Modal "Donn√©es Temps R√©el Compass" s'ouvre
- ‚úÖ Carte(s) de poulailler affich√©e(s)
- ‚úÖ Donn√©es visibles :
  - Temp√©rature (¬∞C)
  - Humidit√© (%)
  - Poids moyen (g)
  - √Çge du troupeau (jours)
- ‚úÖ Timestamp "Derni√®re mise √† jour"
- ‚úÖ Bouton "Actualiser" fonctionne

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Data Displayed** : ‚¨ú Yes / ‚¨ú No / ‚¨ú N/A (empty)

---

### Test 12: Responsive Design

**Objectif** : V√©rifier le responsive design

**√âtapes** :
1. Ouvrir Chrome DevTools (F12)
2. Tester diff√©rentes tailles d'√©cran :
   - Desktop (1920x1080)
   - Tablet (768x1024)
   - Mobile (375x667)

**R√©sultat attendu** :
- ‚úÖ Desktop : Layout normal, 2 colonnes pour preview
- ‚úÖ Tablet : Layout adapt√©, navigation OK
- ‚úÖ Mobile : Cards en colonne unique, buttons adapt√©s

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## ‚úÖ Integration Testing (End-to-End)

### Test 13: User Query Flow

**Objectif** : Tester une requ√™te utilisateur compl√®te

**Pr√©requis** :
- Utilisateur configur√© avec au moins 1 poulailler

**√âtapes** :
1. Se connecter avec le compte utilisateur (non-admin)
2. Ouvrir le chat
3. Poser la question : "Quelle est la temp√©rature dans mon poulailler 2?"
4. V√©rifier la r√©ponse

**R√©sultat attendu** :
- ‚úÖ R√©ponse contient la temp√©rature actuelle
- ‚úÖ R√©ponse mentionne le nom du poulailler
- ‚úÖ Donn√©es sont √† jour (timestamp r√©cent)
- ‚úÖ Format de r√©ponse professionnel

**Exemple de r√©ponse** :
```
La temp√©rature actuelle dans votre Poulailler Test (poulailler 2) est de 22.5¬∞C.

Derni√®re mise √† jour : 30 octobre 2025 √† 13:45
```

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Response Time** : _______ ms

---

### Test 14: Multiple Barns Query

**Objectif** : Requ√™te pour plusieurs poulaillers

**√âtapes** :
1. Poser : "Quelles sont les temp√©ratures de tous mes poulaillers?"

**R√©sultat attendu** :
- ‚úÖ Liste de tous les poulaillers configur√©s
- ‚úÖ Temp√©rature pour chaque poulailler
- ‚úÖ Formatage clair (liste √† puces ou tableau)

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 15: Data Type Queries

**Objectif** : Tester diff√©rents types de donn√©es

**√âtapes** :
Poser ces questions successivement :
1. "Quelle est l'humidit√© dans mon poulailler 2?"
2. "Quel est le poids moyen de mes poulets dans le poulailler 2?"
3. "Quel est l'√¢ge du troupeau dans le poulailler 2?"

**R√©sultat attendu** :
- ‚úÖ Humidit√© affich√©e en %
- ‚úÖ Poids affich√© en grammes
- ‚úÖ √Çge affich√© en jours

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## ‚ùå Error Handling Tests

### Test 16: Invalid Barn Number

**Objectif** : G√©rer un num√©ro de poulailler invalide

**√âtapes** :
1. Poser : "Quelle est la temp√©rature dans mon poulailler 999?"

**R√©sultat attendu** :
- ‚úÖ Message d'erreur clair
- ‚úÖ Suggestion des poulaillers disponibles

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 17: Compass API Down

**Objectif** : G√©rer l'indisponibilit√© de Compass

**√âtapes** :
1. Temporairement invalider le COMPASS_API_TOKEN
2. Red√©marrer le backend
3. Tester la connexion dans l'UI

**R√©sultat attendu** :
- ‚úÖ Badge rouge "D√©connect√©"
- ‚úÖ Message d'erreur explicite
- ‚úÖ Pas de crash de l'application

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 18: User Without Config

**Objectif** : G√©rer un utilisateur sans configuration

**√âtapes** :
1. Se connecter avec un utilisateur non configur√©
2. Poser : "Quelle est la temp√©rature dans mon poulailler?"

**R√©sultat attendu** :
- ‚úÖ Message indiquant l'absence de configuration
- ‚úÖ Suggestion de contacter l'admin

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## üîí Security Tests

### Test 19: Admin-Only Access

**Objectif** : V√©rifier que seuls les admins acc√®dent √† la config

**√âtapes** :
1. Se connecter avec un compte utilisateur normal
2. Naviguer vers Statistics
3. V√©rifier que l'onglet Compass n'est PAS visible

**R√©sultat attendu** :
- ‚úÖ Onglet Compass invisible pour utilisateurs normaux
- ‚úÖ Tentative d'acc√®s direct redirige ou erreur 403

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

### Test 20: User Data Isolation

**Objectif** : V√©rifier que les users ne voient que leurs donn√©es

**√âtapes** :
1. Configurer User A avec poulailler #849
2. Configurer User B avec poulailler #850
3. Se connecter comme User A
4. Tenter d'acc√©der aux donn√©es du poulailler #850

**R√©sultat attendu** :
- ‚úÖ User A ne peut acc√©der qu'√† son poulailler #849
- ‚úÖ Erreur si tentative d'acc√®s au poulailler d'un autre user

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## üìä Performance Tests

### Test 21: Load Time

**Objectif** : Mesurer les temps de chargement

**√âtapes** :
1. Ouvrir Chrome DevTools > Network
2. Naviguer vers Compass Tab
3. Noter les temps de chargement

**R√©sultat attendu** :
- ‚úÖ Connection status : < 500ms
- ‚úÖ Device list : < 1s
- ‚úÖ User configs : < 1s
- ‚úÖ Preview data : < 2s

**Statut** : ‚¨ú Passed / ‚¨ú Failed
**Actual Times** : ___________________________

---

### Test 22: Concurrent Users

**Objectif** : Tester avec plusieurs utilisateurs simultan√©s

**√âtapes** :
1. Ouvrir 3-5 navigateurs/sessions
2. Faire des requ√™tes simultan√©es

**R√©sultat attendu** :
- ‚úÖ Toutes les requ√™tes r√©pondent correctement
- ‚úÖ Pas de timeouts
- ‚úÖ Pas d'erreurs serveur

**Statut** : ‚¨ú Passed / ‚¨ú Failed

---

## üìù Summary

### Overall Status
- ‚¨ú All Tests Passed (Production Ready)
- ‚¨ú Minor Issues (Deploy with monitoring)
- ‚¨ú Major Issues (Do not deploy)

### Test Results Summary
- **Backend Tests** : ___/5 passed
- **Frontend Tests** : ___/7 passed
- **Integration Tests** : ___/3 passed
- **Error Handling** : ___/3 passed
- **Security Tests** : ___/2 passed
- **Performance Tests** : ___/2 passed

**Total** : ___/22 tests passed

### Issues Found
1. _________________________________________________
2. _________________________________________________
3. _________________________________________________

### Action Items
- [ ] _________________________________________________
- [ ] _________________________________________________
- [ ] _________________________________________________

### Sign-Off
- **Tester** : _____________________
- **Date** : _____________________
- **Approved for Production** : ‚¨ú Yes / ‚¨ú No

---

**Last Updated**: 2025-10-30
**Document Version**: 1.0.0
