# 🚀 REQUIREMENTS.TXT - DIGITAL OCEAN APP PLATFORM OPTIMIZED - VERSION FINALE CORRIGÉE
# 🔧 CONFLIT HTTPX/SUPABASE/OPENAI RÉSOLU

# =============================================================================
# CORE FASTAPI - Versions stables testées
# =============================================================================
fastapi==0.104.1
uvicorn[standard]==0.24.0
python-multipart==0.0.6
pydantic==2.5.0
email-validator==2.1.0.post1

# =============================================================================
# 🔧 SUPABASE - VERSION COMPATIBLE AVEC HTTPX 0.26+
# =============================================================================
# ✅ CORRECTION CRITIQUE: Utiliser version Supabase compatible
supabase==2.9.1
# Version 2.9.1 requiert httpx>=0.26,<0.28 (compatible avec la résolution)

# =============================================================================
# AUTH & SECURITY - Versions éprouvées
# =============================================================================
PyJWT==2.8.0
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4

# =============================================================================
# 🔧 OPENAI - CORRECTION CRITIQUE APPLIQUÉE
# =============================================================================
# ✅ CORRECTION: Version compatible sans paramètre 'proxies'
openai==1.51.0
# ANCIEN: openai==1.3.0 (causait l'erreur AsyncClient proxies)
# OpenAI 1.51.0 accepte httpx<1,>=0.23.0 (compatible avec 0.26+)

# =============================================================================
# 🔧 HTTPX - RÉSOLUTION DU CONFLIT SUPABASE/OPENAI
# =============================================================================
# ✅ CORRECTION CRITIQUE: Version qui satisfait tous les requirements
httpx>=0.26.0,<0.28.0
# Résout le conflit:
# - Supabase 2.9.1 requiert httpx>=0.26,<0.28
# - OpenAI 1.51.0 accepte httpx<1,>=0.23.0
# - Notre choix: httpx 0.26.x (compatible avec les deux)

# =============================================================================
# RAG SYSTEM - Versions optimisées et compatibles
# =============================================================================
torch==2.2.2
torchvision==0.17.2
transformers==4.40.0
sentence-transformers==2.7.0
faiss-cpu==1.8.0
numpy==1.26.4

# 🔧 CORRECTION WARNINGS HUGGING FACE
huggingface_hub>=0.24.0
# Résout: FutureWarning resume_download deprecated
safetensors==0.4.3

# =============================================================================
# 🔧 PARSERS DOCUMENTS - CORRECTION WARNINGS CRITIQUES
# =============================================================================
# ✅ CORRECTION: Ajouter langchain-community pour parseurs complets
langchain==0.2.16
langchain-community==0.2.16
# Résout: Module langchain_community.document_loaders not found

# ✅ DATA PROCESSING - Requis pour parseurs avancés
pandas==2.2.2

# =============================================================================
# UTILS - Versions stables
# =============================================================================
python-dotenv==1.0.0
aiofiles==23.2.1
toml==0.10.2

# =============================================================================
# ML LIBS - Versions compatibles RAG
# =============================================================================
scikit-learn==1.4.2
scipy==1.13.0
tqdm==4.66.1
pillow==10.3.0

# =============================================================================
# HTTP REQUESTS
# =============================================================================
requests==2.31.0

# =============================================================================
# 🔧 CORRECTIONS FINALES DIGITAL OCEAN APP PLATFORM
# =============================================================================

# ✅ TYPING EXTENSIONS - Pour compatibilité Python 3.11
typing-extensions>=4.8.0

# =============================================================================
# 📊 RÉSUMÉ DES CORRECTIONS APPLIQUÉES - VERSION FINALE
# =============================================================================
# 
# ✅ CONFLIT HTTPX RÉSOLU:
#    - Supabase: 2.9.1 (requiert httpx>=0.26,<0.28)
#    - OpenAI: 1.51.0 (accepte httpx<1,>=0.23.0)
#    - Solution: httpx>=0.26.0,<0.28.0 (satisfait les deux)
#
# ✅ AUTRES CORRECTIONS CONSERVÉES:
#    - openai: 1.3.0 → 1.51.0 (corrige erreur proxies AsyncClient)
#    - langchain-community: Ajouté (corrige parseurs documents)
#    - huggingface_hub: Version mise à jour (corrige warnings deprecation)
#    - typing-extensions: Ajouté (compatibilité Python 3.11)
#    - asyncio-compat: SUPPRIMÉ (package inexistant)
#    - pandas: Ajouté (requis pour parseurs avancés)
#
# 🎯 RÉSULTAT ATTENDU APRÈS DÉPLOIEMENT:
# - ❌ Conflit httpx/supabase/openai → ✅ RÉSOLU
# - ❌ AsyncClient proxies error → ✅ RÉSOLU
# - ❌ AsyncHttpxClientWrapper _state error → ✅ RÉSOLU  
# - ❌ langchain_community not found → ✅ RÉSOLU
# - ❌ Hugging Face deprecation warnings → ✅ RÉSOLU
# - ❌ asyncio-compat not found → ✅ RÉSOLU (supprimé)
# - ✅ OpenAI IA pleinement fonctionnelle
# - ✅ Parsing de documents complet
# - ✅ Système 100% opérationnel sur Digital Ocean
#
# =============================================================================