# ğŸ“Š Sondage de Satisfaction - Placement dans l'Interface

## ğŸ¯ OÃ¹ apparaÃ®tra le sondage ?

Le sondage apparaÃ®tra **dans le flux de conversation**, comme un message systÃ¨me distinct.

---

## ğŸ“± Mockup Visuel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [+]  [History]                      [?]  [Profile] â”‚  â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ‘¤ User:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Comment prÃ©venir la coccidiose ?          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚                                          ğŸ¤– AI:    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ La coccidiose est une maladie...         â”‚    â”‚
â”‚  â”‚ (longue rÃ©ponse dÃ©taillÃ©e)               â”‚    â”‚
â”‚  â”‚ ğŸ‘ ğŸ‘                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  ğŸ‘¤ User:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Et pour les pondeuses ?                   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚                                          ğŸ¤– AI:    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Pour les pondeuses, c'est diffÃ©rent...   â”‚    â”‚
â”‚  â”‚ ğŸ‘ ğŸ‘                                     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”‚  ... (23 autres Ã©changes) ...                     â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŒŸ Before you go â€” could you rate your     â”‚ â”‚  â† SONDAGE
â”‚  â”‚    experience today?                        â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚    ğŸ˜Š     â”‚  â”‚    ğŸ˜     â”‚  â”‚    ğŸ™     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Satisfied â”‚  â”‚  Neutral  â”‚  â”‚Unsatisfiedâ”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚  [Skip this survey]                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                     â”‚
â”‚  ğŸ‘¤ User:  (peut continuer la conversation)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Merci, une autre question...              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“·ğŸ¤ | [Type your message...]           | â¤       â”‚  â† Footer
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” DÃ©tails d'ImplÃ©mentation

### 1ï¸âƒ£ Position dans le DOM

**Emplacement exact :**
```tsx
// Dans ChatInterface component (page.tsx)

<MessageList
  processedMessages={processedMessages}  // Messages normaux
  // ... autres props
/>

{/* NOUVEAU: Sondage de satisfaction */}
{shouldShowSurvey && !surveyCompleted && (
  <SatisfactionSurvey
    conversationId={currentConversation.id}
    onComplete={handleSurveyComplete}
    onSkip={handleSurveySkip}
  />
)}

{isLoadingChat && <LoadingDots />}

<div ref={messagesEndRef} />  {/* Scroll anchor */}
```

**Rendu :** Le sondage apparaÃ®t **APRÃˆS** tous les messages, **AVANT** l'indicateur de chargement.

---

### 2ï¸âƒ£ Logique d'Affichage

```typescript
// Quand afficher le sondage ?

const shouldShowSurvey = useMemo(() => {
  if (!currentConversation) return false;

  const messageCount = currentConversation.message_count || 0;
  const lastSurveyAt = localStorage.getItem(`survey_${currentConversation.id}`);

  // PremiÃ¨re fois : ~25 messages (Â±5 pour variation)
  if (!lastSurveyAt && messageCount >= 20 && messageCount <= 30) {
    return Math.random() < 0.3; // 30% de chance Ã  chaque render
  }

  // Suivantes : tous les ~40 messages
  if (lastSurveyAt) {
    const lastCount = parseInt(lastSurveyAt);
    const delta = messageCount - lastCount;

    if (delta >= 35 && delta <= 45) {
      return Math.random() < 0.3;
    }
  }

  return false;
}, [currentConversation?.message_count]);
```

---

### 3ï¸âƒ£ Design du Composant SatisfactionSurvey

```tsx
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒŸ Before you go â€” could you rate your           â”‚
â”‚     experience today?                              â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚      ğŸ˜Š       â”‚  â”‚      ğŸ˜       â”‚  â”‚    ğŸ™     â”‚â”‚
â”‚  â”‚   Satisfied   â”‚  â”‚    Neutral    â”‚  â”‚Unsatisfiedâ”‚â”‚
â”‚  â”‚               â”‚  â”‚               â”‚  â”‚          â”‚â”‚
â”‚  â”‚  âœ“ Helpful    â”‚  â”‚  âš–ï¸ Okay      â”‚  â”‚ âŒ Poor   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                                    â”‚
â”‚  [ğŸ’¬ Add a comment (optional)]                    â”‚  â† Si cliquÃ©
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Tell us more... (optional)                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  [Skip this survey]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã‰tat aprÃ¨s clic sur un bouton:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Thank you for your feedback!                  â”‚
â”‚                                                    â”‚
â”‚  Your rating helps us improve Intelia Expert.     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“ (disparaÃ®t aprÃ¨s 3 secondes)
```

---

## ğŸ¨ Variantes de Styles

### Style 1: **Cards distinctes** (RecommandÃ©)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ğŸ˜Š      â”‚  â”‚     ğŸ˜      â”‚  â”‚     ğŸ™      â”‚
â”‚  Satisfied  â”‚  â”‚   Neutral   â”‚  â”‚ Unsatisfied â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚ [    âœ“    ] â”‚  â”‚ [    âš–ï¸    ] â”‚  â”‚ [    âŒ    ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  hover: scale(1.05), shadow-lg
  active: scale(0.95)
```

### Style 2: **Boutons horizontaux simples**
```
[ğŸ˜Š Satisfied]  [ğŸ˜ Neutral]  [ğŸ™ Unsatisfied]
```

### Style 3: **Emoji grande taille clickable**
```
      ğŸ˜Š              ğŸ˜              ğŸ™
   Satisfied       Neutral      Unsatisfied

   (emoji size: 48px, clickable avec hover effect)
```

---

## ğŸ“Š DonnÃ©es EnregistrÃ©es

### Table: `conversation_satisfaction_surveys`

```sql
CREATE TABLE conversation_satisfaction_surveys (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    conversation_id UUID NOT NULL REFERENCES conversations(id),
    user_id TEXT NOT NULL,
    rating TEXT NOT NULL CHECK (rating IN ('satisfied', 'neutral', 'unsatisfied')),
    comment TEXT,
    message_count_at_survey INTEGER,  -- Nombre de messages au moment du sondage
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

**Exemple de donnÃ©es:**
```
id: uuid
conversation_id: a1b2c3d4...
user_id: user_123
rating: "satisfied"
comment: "Super rapide et prÃ©cis !"
message_count_at_survey: 27
created_at: 2025-10-23 10:30:00
```

---

## ğŸ”„ Flow Utilisateur

```
User pose 25+ questions
         â†“
Sondage apparaÃ®t dans le chat
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â†“         â†“
  Clique   Skip
    â†“         â†“
  Rate    Continue
    â†“
Commentaire (optionnel)
    â†“
EnregistrÃ© en DB
    â†“
Message "Merci !" (3s)
    â†“
Continue conversation
```

---

## ğŸ“± Responsive Mobile

### Desktop (>768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸŒŸ Before you go â€” could you rate your     â”‚
â”‚     experience today?                        â”‚
â”‚                                              â”‚
â”‚  [ğŸ˜Š Satisfied]  [ğŸ˜ Neutral]  [ğŸ™ Unsatisfied] â”‚
â”‚                                              â”‚
â”‚  [Skip]                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mobile (<768px)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŒŸ Rate your experienceâ”‚
â”‚                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚     ğŸ˜Š      â”‚     â”‚
â”‚    â”‚  Satisfied  â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚     ğŸ˜      â”‚     â”‚
â”‚    â”‚   Neutral   â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚    â”‚     ğŸ™      â”‚     â”‚
â”‚    â”‚ Unsatisfied â”‚     â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                         â”‚
â”‚    [Skip]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Quelle option prÃ©fÃ©rez-vous ?

**Option A: Card dans le flux de messages** (RecommandÃ©e)
- âœ… Naturel, suit le flow
- âœ… Pas intrusif
- âœ… Facile Ã  skip

**Option B: Modal popup**
- âš ï¸ Plus intrusif
- âš ï¸ Bloque la conversation
- âŒ Moins naturel

**Option C: BanniÃ¨re sticky en haut**
- âš ï¸ Prend de l'espace
- âš ï¸ Cache le header
- âŒ Mobile problÃ©matique

---

## â° Timing RecommandÃ©

```javascript
// PremiÃ¨re apparition
messageCount >= 23 && messageCount <= 27  // ~25 (Â±2)
  â†’ 30% de chance Ã  chaque nouveau message

// Apparitions suivantes
lastSurvey + 38 <= messageCount <= lastSurvey + 42  // ~40 (Â±2)
  â†’ 30% de chance
```

**Pourquoi 30% de chance ?**
- Ã‰vite d'apparaÃ®tre systÃ©matiquement au mÃªme moment
- Rend l'expÃ©rience plus naturelle
- RÃ©duit la fatigue de sondage

---

## ğŸš€ RÃ©sumÃ© Visuel Final

```
Chat normal:
[Message 1] [Message 2] ... [Message 24]

DÃ©clenchement:
[Message 25] â† Trigger zone (23-27)
     â†“
[SONDAGE APPARAÃT ICI] ğŸŒŸ
     â†“
User peut:
  - RÃ©pondre au sondage
  - Skip
  - Continuer Ã  poser des questions

Le sondage reste visible jusqu'Ã :
  - User clique (rate ou skip)
  - User pose une nouvelle question (auto-skip)
```

---

**Question finale:** PrÃ©fÃ©rez-vous le **Style 1 (Cards)**, **Style 2 (Boutons)**, ou **Style 3 (Emojis grands)** ?
