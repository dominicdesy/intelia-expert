(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[929],{8163:function(e,t,s){Promise.resolve().then(s.bind(s,185))},185:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return oe}});var a=s(7437),r=s(2265),n=s(1369),o=s(9272),i=s(7667),l=s(7208),c=s(257);const d=(()=>{const e=c.env.NEXT_PUBLIC_API_BASE_URL||"https://expert-app-cngws.ondigitalocean.app",t=c.env.NEXT_PUBLIC_API_VERSION||"v1",s=e.replace(/\/api\/?$/,"");return"".concat(s,"/api/").concat(t)})(),u=async()=>{console.log("[apiService] \ud83d\udd0d getAuthHeaders() appel\xe9e...");const e={"Content-Type":"application/json",Origin:"https://expert.intelia.com"};console.log("[apiService] \ud83d\udd0d Appel getAuthToken()...");const t=await(async()=>{console.log("[apiService] \ud83d\udd0d getAuthToken() appel\xe9e...");try{console.log("[apiService] \ud83d\udd0d Tentative r\xe9cup\xe9ration depuis intelia-expert-auth...");const o=localStorage.getItem("intelia-expert-auth");if(o){const e=JSON.parse(o);if(e.access_token){console.log("[apiService] \u2705 Token r\xe9cup\xe9r\xe9 depuis intelia-expert-auth"),console.log("[apiService] \ud83d\udccb Token preview:",e.access_token.substring(0,30)+"...");try{const t=e.access_token.split(".");if(3===t.length){const s=JSON.parse(atob(t[1])),a=Math.floor(Date.now()/1e3);if(!(s.exp<a))return console.log("[apiService] \u2705 Token valide, expire dans:",Math.floor((s.exp-a)/60),"minutes"),e.access_token;console.warn("[apiService] \u26a0\ufe0f Token expir\xe9 dans intelia-expert-auth")}}catch(r){return console.log("[apiService] \ud83d\udccb Token JWT non d\xe9codable, utilisation directe"),e.access_token}}}console.log("[apiService] \ud83d\udd0d Tentative fallback vers supabase-auth-store...");const i=localStorage.getItem("supabase-auth-store");if(i){var e,t,s,a;const r=JSON.parse(i),n=[null===(t=r.state)||void 0===t||null===(e=t.session)||void 0===e?void 0:e.access_token,null===(a=r.state)||void 0===a||null===(s=a.user)||void 0===s?void 0:s.access_token,r.access_token];for(const e of n)if(e&&"string"===typeof e&&e.length>20)return console.log("[apiService] \u2705 Token fallback trouv\xe9 dans supabase-auth-store"),e}console.log("[apiService] \ud83d\udd0d Tentative derni\xe8re chance avec cookies...");const l=document.cookie.split(";");for(const e of l)if(e.includes("sb-")&&e.includes("auth-token"))try{const t=e.split("=")[1],s=decodeURIComponent(t),a=JSON.parse(s);if(Array.isArray(a)&&a[0]&&"string"===typeof a[0])return console.log("[apiService] \u2705 Token trouv\xe9 dans cookies"),a[0]}catch(n){continue}return console.error("[apiService] \u274c Aucun token trouv\xe9 dans aucune source"),null}catch(o){return console.error("[apiService] \u274c Erreur r\xe9cup\xe9ration token:",o),null}})();return console.log("[apiService] \ud83d\udccb getAuthToken() r\xe9sultat:",!!t),t?(e.Authorization="Bearer ".concat(t),console.log("[apiService] \u2705 Headers avec Authorization configur\xe9s")):console.warn("[apiService] \u26a0\ufe0f Headers sans authentification - pas de token Supabase (singleton)"),console.log("[apiService] \ud83d\udccb Headers finaux:",Object.keys(e)),e},m=()=>"undefined"!==typeof crypto&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),p=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"fr",a=arguments.length>3?arguments[3]:void 0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6?arguments[6]:void 0;if(!e||""===e.trim())throw new Error("Question requise");if(!t||!t.id)throw new Error("Utilisateur requis");const o=a||m();console.log("[apiService] Expert API avec Supabase natif (singleton):",{question:e.substring(0,50)+"...",session_id:o.substring(0,8)+"...",system:"Supabase singleton -> Expert API"});try{var i,l,c,p,g,f,h;const t="".concat(d,"/expert/ask");let a=e.trim();if(r&&n){console.log("[apiService] Mode clarification - enrichissement question");const e=a.match(/(ross\s*308|cobb\s*500|hubbard)/i),t=a.match(/(male|male|femelle|female|mixte|mixed)/i),s=e?e[0]:"",r=t?t[0]:"";s&&r&&(a="".concat(n," pour ").concat(s," ").concat(r),console.log("[apiService] Question enrichie:",a))}const m={session_id:o,question:a};console.log("[apiService] \ud83d\udd0d R\xe9cup\xe9ration des headers d'authentification...");const b=await u();console.log("[apiService] Requete Expert API (Supabase singleton):",m),console.log("[apiService] \ud83d\udd0d Pr\xe9paration de la requ\xeate fetch..."),console.log("[apiService] \ud83d\ude80 Envoi de la requ\xeate vers:",t),console.log("[apiService] \ud83d\udccb D\xe9tails de la requ\xeate:",{method:"POST",headers_keys:Object.keys(b),body_size:JSON.stringify(m).length,has_auth_header:!!b.Authorization});const j=await fetch(t,{method:"POST",headers:b,body:JSON.stringify(m)});if(console.log("[apiService] \u2705 R\xe9ponse re\xe7ue du serveur"),console.log("[apiService] Expert API status (Supabase singleton):",j.status),!j.ok){const e=await j.text();if(console.error("[apiService] \u274c Erreur Expert API (Supabase singleton):",e),401===j.status)throw new Error("Session expiree. Veuillez vous reconnecter.");if(403===j.status)throw new Error("Acces non autorise.");let t="Erreur API: ".concat(j.status);try{t=JSON.parse(e).detail||t}catch(y){t=e||t}throw new Error(t)}console.log("[apiService] \ud83d\udd0d Lecture du JSON de la r\xe9ponse...");const k=await j.json();console.log("[apiService] Reponse Expert API recue (Supabase singleton):",{type:k.type,has_answer:!!k.answer,answer_text_exists:!!(null===(i=k.answer)||void 0===i?void 0:i.text),has_general_answer:!!k.general_answer,has_questions:!!k.questions,has_message:!!k.message,source:k.source,documents_used:k.documents_used});let N="";"answer"===k.type&&(null===(l=k.answer)||void 0===l?void 0:l.text)?(N=k.answer.text,console.log("[apiService] Texte extrait de data.answer.text")):"partial_answer"===k.type&&(null===(c=k.general_answer)||void 0===c?void 0:c.text)?(N=k.general_answer.text,console.log("[apiService] Texte extrait de data.general_answer.text")):"validation_rejected"===k.type?(N=k.message||"Cette question ne concerne pas le domaine agricole.",console.log("[apiService] Question rejetee par validation agricole")):console.warn("[apiService] Aucun texte trouve dans la reponse!");const C={conversation_id:o,language:s,timestamp:(new Date).toISOString(),..."answer"===k.type?{type:"answer",response:N,full_text:N,requires_clarification:!1,rag_used:!0,sources:(null===(p=k.answer)||void 0===p?void 0:p.sources)||(k.source?[{source:k.source}]:[]),mode:"perfstore_hit",note:k.warning||"Documents utilises: ".concat(k.documents_used||0),confidence_score:(null===(g=k.answer)||void 0===g?void 0:g.confidence)||.9}:{},..."partial_answer"===k.type?{type:"partial_answer",general_answer:k.general_answer,follow_up_questions:k.follow_up_questions,response:N,full_text:N,rag_used:!0,sources:k.source?[{source:k.source}]:[],mode:"rag_partial_answer",note:k.warning||"Documents utilises: ".concat(k.documents_used||0),confidence_score:k.documents_used?Math.min(.9,.5+.1*k.documents_used):.5}:{},..."clarification"===k.type?{type:"clarification",requires_clarification:!0,clarification_questions:k.questions||[],clarification_type:"missing_info",vague_entities:["breed","sex"],clarification_result:{clarification_requested:!0,clarification_type:"missing_info",missing_information:["breed","sex"],confidence:.5},rag_used:!1,sources:[],mode:"clarification_dialoguemanager",note:"Clarification requise"}:{},..."validation_rejected"===k.type?{type:"validation_rejected",message:k.message,validation:k.validation,response:N,full_text:N,requires_clarification:!1,rag_used:!1,sources:[],mode:"validation_rejected",note:"Question rejetee par validation agricole",confidence_score:0}:{}};if(C.response&&!C.response_versions){var v;console.log("[apiService] Generation automatique response_versions");const e=C.response;C.response_versions={ultra_concise:e.length>200?e.substring(0,150)+"...":e,concise:e.length>400?e.substring(0,300)+"...":e,standard:e,detailed:e+((null===(v=C.sources)||void 0===v?void 0:v.length)?"\n\nSources consultees: ".concat(C.sources.length," documents"):"")}}try{x.storeRecentSessionId(o),console.log("[apiService] Session ID stocke pour historique (singleton)")}catch(w){console.warn("[apiService] Erreur stockage session ID (singleton):",w)}return console.log("[apiService] Reponse traitee (Supabase singleton):",{type:C.type,requires_clarification:C.requires_clarification,clarification_questions_count:(null===(f=C.clarification_questions)||void 0===f?void 0:f.length)||0,has_response:!!C.response,response_length:(null===(h=C.response)||void 0===h?void 0:h.length)||0,has_general_answer:!!C.general_answer,has_versions:!!C.response_versions,validation_rejected:"validation_rejected"===C.type}),console.log("[apiService] \ud83c\udf89 SUCC\xc8S: Retour de la r\xe9ponse trait\xe9e"),C}catch(w){var b;if(console.error("[apiService] \u274c ERREUR CRITIQUE dans generateAIResponse:",w),console.error("[apiService] \ud83d\udccb Stack trace:",null===w||void 0===w||null===(b=w.stack)||void 0===b?void 0:b.substring(0,500)),w instanceof Error)throw w;throw new Error("Erreur de communication avec le serveur")}},g=async e=>{if(!e)throw new Error("User ID requis");console.log("[apiService] Chargement conversations pour (singleton):",e);try{var t;const s=await u(),a="".concat(d,"/conversations/user/").concat(e),r=await fetch(a,{method:"GET",headers:s});if(console.log("[apiService] Conversations statut (singleton):",r.status),!r.ok){const t=await r.text();if(console.error("[apiService] Erreur conversations (singleton):",t),401===r.status)throw new Error("Session expiree. Veuillez vous reconnecter.");if(405===r.status||404===r.status)return console.warn("[apiService] Endpoint conversations non disponible - retour donnees vides (singleton)"),{count:0,conversations:[],user_id:e,note:"Fonctionnalite en cours de developpement"};throw new Error("Erreur chargement conversations: ".concat(r.status))}const n=await r.json();return console.log("[apiService] Conversations chargees (singleton):",{count:n.count,conversations:(null===(t=n.conversations)||void 0===t?void 0:t.length)||0}),n}catch(s){if(console.error("[apiService] Erreur chargement conversations (singleton):",s),s instanceof Error&&s.message.includes("Failed to fetch"))return console.warn("[apiService] Erreur reseau - retour donnees vides (singleton)"),{count:0,conversations:[],user_id:e,note:"Erreur de connexion - reessayez plus tard"};throw s}};var f=s(257);class h{canAttempt(){return Date.now()-this.lastAttempt>this.RESET_INTERVAL&&(this.attempts=0),!(this.attempts>=this.MAX_ATTEMPTS)||(console.warn("[ConversationService] Circuit breaker: trop de tentatives, arr\xeat temporaire"),!1)}recordAttempt(){this.attempts++,this.lastAttempt=Date.now(),console.log("[ConversationService] Circuit breaker: tentative ".concat(this.attempts,"/").concat(this.MAX_ATTEMPTS))}recordSuccess(){this.attempts=0,console.log("[ConversationService] Circuit breaker: reset apr\xe8s succ\xe8s")}recordFailure(){console.log("[ConversationService] Circuit breaker: \xe9chec ".concat(this.attempts,"/").concat(this.MAX_ATTEMPTS))}constructor(){this.attempts=0,this.lastAttempt=0,this.MAX_ATTEMPTS=3,this.RESET_INTERVAL=3e4}}function v(e){return{id:e.id,title:e.title,preview:e.preview,message_count:e.message_count,created_at:e.created_at,updated_at:e.updated_at,feedback:e.feedback,language:e.language,last_message_preview:e.last_message_preview,status:"active"}}const x=new class{getAuthToken(){try{const t=document.cookie.split(";").find((e=>e.trim().startsWith("sb-cdrmjshmkdfwwtsfdvbl-auth-token=")));if(t){const e=t.split("=")[1],s=decodeURIComponent(e),a=JSON.parse(s);if(Array.isArray(a)&&a[0]&&"mock-jwt-token-for-development"!==a[0])return a[0]}const s=localStorage.getItem("sb-cdrmjshmkdfwwtsfdvbl-auth-token");if(s)try{const e=JSON.parse(s);if(Array.isArray(e)&&e[0])return e[0]}catch(e){console.warn("[ConversationService] Failed to parse localStorage token")}return""}catch(t){return console.error("[ConversationService] Error getting auth token:",t),""}}getHeaders(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET";const t=this.getAuthToken();return"GET"===e?{Accept:"application/json",...t&&{Authorization:"Bearer ".concat(t)}}:{"Content-Type":"application/json",Accept:"application/json",...t&&{Authorization:"Bearer ".concat(t)}}}async getConversationWithMessages(e){try{console.log("[ConversationService] Chargement conversation compl\xe8te:",e);const l=await fetch("".concat(this.baseUrl,"/conversations/").concat(e),{method:"GET",headers:this.getHeaders("GET")});if(l.ok){var t,s,a,r,n,o;const e=await l.json();var i;if(console.log("[ConversationService] Donn\xe9es r\xe9cup\xe9r\xe9es:",{id:null===(t=e.conversation)||void 0===t?void 0:t.conversation_id,questionLength:(null===(a=e.conversation)||void 0===a||null===(s=a.question)||void 0===s?void 0:s.length)||0,responseLength:(null===(r=null!==(i=null===(n=e.conversation)||void 0===n?void 0:n.full_text)&&void 0!==i?i:null===(o=e.conversation)||void 0===o?void 0:o.response)||void 0===r?void 0:r.length)||0}),e.conversation&&e.conversation.question&&e.conversation.response){const t=this.transformToConversationWithMessages(e.conversation);if(t.messages.length>0)return console.log("[ConversationService] Conversation transform\xe9e avec messages complets"),t}}return console.warn("[ConversationService] Impossible de r\xe9cup\xe9rer la conversation compl\xe8te"),null}catch(l){return console.error("[ConversationService] Erreur getConversationWithMessages:",l),null}}async getConversationHistory(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{groupBy:"date",sortBy:"updated_at",sortOrder:"desc",limit:50};try{console.log("[ConversationService] Chargement historique pour:",e);const s=new URLSearchParams({groupBy:t.groupBy,sortBy:t.sortBy,sortOrder:t.sortOrder,...t.limit&&{limit:t.limit.toString()},...t.offset&&{offset:t.offset.toString()}}),a=await fetch("".concat(this.baseUrl,"/v1/conversations/history/").concat(e,"?").concat(s),{method:"GET",headers:this.getHeaders("GET")});if(!a.ok)throw new Error("HTTP ".concat(a.status,": Failed to load conversation history"));const r=await a.json();return console.log("[ConversationService] Historique charg\xe9:",r.total_count,"conversations"),r}catch(s){throw console.error("[ConversationService] Erreur chargement historique:",s),s}}async getConversationDetail(e){try{console.log("[ConversationService] Chargement conversation:",e);const t=await fetch("".concat(this.baseUrl,"/v1/conversations/").concat(e),{method:"GET",headers:this.getHeaders("GET")});if(!t.ok)throw new Error("HTTP ".concat(t.status,": Failed to load conversation"));const s=await t.json();return console.log("[ConversationService] Conversation charg\xe9e:",s.conversation.message_count,"messages"),s}catch(t){throw console.error("[ConversationService] Erreur chargement conversation:",t),t}}groupConversationsByDate(e){const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(s.getTime()-864e5),r=new Date(s.getTime()-6048e5),n=new Date(s.getTime()-2592e6),o=[{title:"Aujourd'hui",conversations:[]},{title:"Hier",conversations:[]},{title:"Cette semaine",conversations:[]},{title:"Ce mois-ci",conversations:[]},{title:"Plus ancien",conversations:[]}];return e.forEach((e=>{const t=new Date(e.updated_at);t>=s?o[0].conversations.push(e):t>=a?o[1].conversations.push(e):t>=r?o[2].conversations.push(e):t>=n?o[3].conversations.push(e):o[4].conversations.push(e)})),o.filter((e=>e.conversations.length>0))}async getUserConversations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;if(!this.circuitBreaker.canAttempt())return console.warn("[ConversationService] Circuit breaker actif - tentatives bloqu\xe9es temporairement"),[];if(!this.loggingEnabled)return console.log("Logging d\xe9sactiv\xe9 - conversations non r\xe9cup\xe9r\xe9es"),[];console.log("[ConversationService] R\xe9cup\xe9ration conversations pour:",e),this.circuitBreaker.recordAttempt();try{console.log("[ConversationService] \ud83d\udd04 D\xe9l\xe9gation vers apiService.loadUserConversations...");const s=await g(e);if(!s||!s.conversations){console.log("[ConversationService] \ud83d\udced Aucune conversation via apiService, essai fallback localStorage...");const e=await this.getConversationsFromLocalStorage(t);return e.length>0?this.circuitBreaker.recordSuccess():this.circuitBreaker.recordFailure(),e}const a=s.conversations;console.log("[ConversationService] \u2705 ".concat(a.length," conversations r\xe9cup\xe9r\xe9es via apiService"));const r=a.map((e=>{var t,s,a;if(e.title&&e.preview&&void 0!==e.message_count)return e;const r=(null===(s=e.question)||void 0===s||null===(t=s.split("\n--- Question suivante ---\n"))||void 0===t?void 0:t[0])||e.question||"Conversation sans titre",n=r.length>100?r.substring(0,100)+"...":r,o=(null===(a=e.response)||void 0===a?void 0:a.split("\n--- R\xe9ponse suivante ---\n"))||[e.response],i=o[o.length-1]||"Aucune r\xe9ponse",l=i.length>300?i.substring(0,300)+"...":i;return v({id:e.conversation_id||e.id||e.session_id,title:n,preview:r,message_count:e.message_count||2,created_at:e.timestamp||e.created_at||(new Date).toISOString(),updated_at:e.updated_at||e.timestamp||(new Date).toISOString(),feedback:e.feedback,language:e.language||"fr",last_message_preview:l})}));return this.circuitBreaker.recordSuccess(),r}catch(s){console.error("[ConversationService] \u274c Erreur apiService, fallback localStorage...",s);try{const e=await this.getConversationsFromLocalStorage(t);return e.length>0?this.circuitBreaker.recordSuccess():this.circuitBreaker.recordFailure(),e}catch(a){return console.error("Erreur fallback localStorage:",a),this.circuitBreaker.recordFailure(),[]}}}async getConversationsFromLocalStorage(e){try{const s=this.getRecentSessionIds();if(0===s.length)return console.log("Aucune session localStorage trouv\xe9e"),[];console.log("".concat(s.length," sessions localStorage trouv\xe9es"));const a=[];for(const r of s.slice(0,e))try{console.log("R\xe9cup\xe9ration session: ".concat(r));const e=await fetch("".concat(this.baseUrl,"/conversations/").concat(r),{method:"GET",headers:this.getHeaders("GET")});if(e.ok){const t=await e.json();if(t.session_id){const e=v({id:t.session_id,title:this.extractTitleFromConversation(t),preview:this.extractPreviewFromConversation(t),message_count:this.extractMessageCount(t),created_at:t.timestamp||(new Date).toISOString(),updated_at:t.updated_at||t.timestamp||(new Date).toISOString(),feedback:t.feedback,language:t.language||"fr",last_message_preview:this.extractLastMessagePreview(t)});a.push(e),console.log("Session ".concat(r," transform\xe9e"))}else console.log("Session ".concat(r," - pas de session_id"))}else console.log("Session ".concat(r," - status ").concat(e.status))}catch(t){console.log("Erreur r\xe9cup\xe9ration session ".concat(r,":"),t)}return console.log("".concat(a.length," conversations r\xe9cup\xe9r\xe9es via localStorage fallback")),a.sort(((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())),a}catch(t){return console.error("Erreur fallback localStorage:",t),[]}}extractTitleFromConversation(e){var t,s,a;if(e.question&&"string"===typeof e.question){const t=e.question.substring(0,100);return 100===t.length?t+"...":t}if((null===(s=e.context)||void 0===s||null===(t=s.messages)||void 0===t?void 0:t.length)>0){const t=e.context.messages.find((e=>e.isUser));if(null===t||void 0===t?void 0:t.content){const e=t.content.substring(0,100);return 100===e.length?e+"...":e}}return"Conversation ".concat((null===(a=e.session_id)||void 0===a?void 0:a.substring(0,8))||"inconnue")}extractPreviewFromConversation(e){var t,s;if(e.question&&"string"===typeof e.question)return e.question;if((null===(s=e.context)||void 0===s||null===(t=s.messages)||void 0===t?void 0:t.length)>0){const t=e.context.messages.find((e=>e.isUser));if(null===t||void 0===t?void 0:t.content)return t.content}return"Conversation sans question d\xe9finie"}extractMessageCount(e){var t,s;if((null===(s=e.context)||void 0===s||null===(t=s.messages)||void 0===t?void 0:t.length)>0)return e.context.messages.length;let a=0;return e.question&&a++,e.response&&a++,a||2}extractLastMessagePreview(e){var t,s;if(e.response&&"string"===typeof e.response){const t=e.response.substring(0,300);return 300===t.length?t+"...":t}if((null===(s=e.context)||void 0===s||null===(t=s.messages)||void 0===t?void 0:t.length)>0){const t=[...e.context.messages].reverse().find((e=>!e.isUser));if(null===t||void 0===t?void 0:t.content){const e=t.content.substring(0,300);return 300===e.length?e+"...":e}}return"Aucune r\xe9ponse disponible"}getRecentSessionIds(){try{const e=localStorage.getItem("recent_conversation_sessions");if(e){const t=JSON.parse(e);if(Array.isArray(t))return t.slice(0,20)}}catch(e){console.warn("Erreur lecture sessions r\xe9centes:",e)}return[]}storeRecentSessionId(e){try{const t=this.getRecentSessionIds(),s=[e,...t.filter((t=>t!==e))].slice(0,50);localStorage.setItem("recent_conversation_sessions",JSON.stringify(s)),console.log("Session ID stock\xe9 pour historique:",e.substring(0,8)+"...")}catch(t){console.warn("Erreur stockage session ID:",t)}}async discoverWorkingEndpoints(){console.log("=== D\xc9COUVERTE DES ENDPOINTS FONCTIONNELS ===");const e=["/conversations","/conversations/list","/conversations/all","/conversations/history","/expert/conversations","/expert/sessions","/expert/list","/sessions","/sessions/list","/history"],t=[];for(const a of e)try{const e=await fetch("".concat(this.baseUrl).concat(a),{method:"GET",headers:this.getHeaders("GET")});if(console.log("".concat(a,": ").concat(e.status," ").concat(e.statusText)),e.ok){const s=await e.json();console.log("ENDPOINT FONCTIONNEL: ".concat(a)),console.log("Structure:",Array.isArray(s)?"Array[".concat(s.length,"]"):Object.keys(s)),t.push(a)}}catch(s){console.log("".concat(a,": ").concat(s.message))}return console.log("Endpoints fonctionnels d\xe9couverts:",t),t}transformToConversationWithMessages(e){var t,s;const a=[];if(e.question&&e.response){const t=e.question.split("\n--- Question suivante ---\n");var r;const s=(null!==(r=e.full_text)&&void 0!==r?r:e.response).split("\n--- R\xe9ponse suivante ---\n");for(let r=0;r<Math.max(t.length,s.length);r++)t[r]&&a.push({id:"".concat(e.conversation_id||e.id,"_user_").concat(r),content:t[r].trim(),isUser:!0,timestamp:new Date(e.timestamp||new Date),conversation_id:e.conversation_id||e.id}),s[r]&&a.push({id:"".concat(e.conversation_id||e.id,"_assistant_").concat(r),content:s[r].trim(),isUser:!1,timestamp:new Date(e.timestamp||new Date),conversation_id:e.conversation_id||e.id,feedback:r===s.length-1&&1===e.feedback?"positive":r===s.length-1&&-1===e.feedback?"negative":null,feedbackComment:r===s.length-1?e.feedback_comment:void 0})}const n=(null===(t=a.find((e=>e.isUser)))||void 0===t?void 0:t.content)||"Conversation",o=n.length>100?n.substring(0,100)+"...":n,i=(null===(s=a.filter((e=>!e.isUser)).pop())||void 0===s?void 0:s.content)||"Aucune r\xe9ponse",l=i.length>300?i.substring(0,300)+"...":i;return{id:e.conversation_id||e.id,title:o,preview:n,message_count:a.length,created_at:e.timestamp||(new Date).toISOString(),updated_at:e.updated_at||e.timestamp||(new Date).toISOString(),feedback:e.feedback,language:e.language||"fr",last_message_preview:l,status:"active",messages:a}}async saveConversation(e){if(this.loggingEnabled)try{var t;console.log("Sauvegarde conversation:",e.conversation_id),console.log("URL de sauvegarde:","".concat(this.baseUrl,"/conversation"));const s=await fetch("".concat(this.baseUrl,"/conversation"),{method:"POST",headers:this.getHeaders("POST"),body:JSON.stringify({user_id:e.user_id,question:e.question,response:e.response,full_text:null!==(t=e.full_text)&&void 0!==t?t:void 0,conversation_id:e.conversation_id,confidence_score:e.confidence_score,response_time_ms:e.response_time_ms,language:e.language||"fr",rag_used:void 0===e.rag_used||e.rag_used})});if(!s.ok){const e=await s.text();throw new Error("HTTP ".concat(s.status,": ").concat(e))}const a=await s.json();console.log("Conversation sauvegard\xe9e:",a.message)}catch(s){console.error("Erreur sauvegarde conversation:",s)}else console.log("Logging d\xe9sactiv\xe9 - conversation non sauvegard\xe9e:",e.conversation_id)}async sendFeedback(e,t){if(this.loggingEnabled)return console.log("[ConversationService] \ud83d\udd04 D\xe9l\xe9gation feedback vers apiService..."),await(async(e,t,s)=>{if(!e)throw new Error("ID de conversation requis");console.log("[apiService] Envoi feedback (Supabase singleton):",t);try{const a={conversation_id:e,rating:1===t?"positive":"negative",...s&&{comment:s.trim()}},r=await u(),n=await fetch("".concat(d,"/expert/feedback"),{method:"POST",headers:r,body:JSON.stringify(a)});if(!n.ok){const e=await n.text();if(console.error("[apiService] Erreur feedback (Supabase singleton):",e),401===n.status)throw new Error("Session expiree. Veuillez vous reconnecter.");throw new Error("Erreur envoi feedback: ".concat(n.status))}console.log("[apiService] Feedback envoye avec succes (Supabase singleton)")}catch(a){throw console.error("[apiService] Erreur feedback (Supabase singleton):",a),a}})(e,t);console.log("Logging d\xe9sactiv\xe9 - feedback non envoy\xe9:",e)}async sendFeedbackComment(e,t){if(this.loggingEnabled)try{console.log("Envoi commentaire feedback:",e,t.substring(0,50)+"..."),console.log("URL commentaire:","".concat(this.baseUrl,"/conversations/").concat(e,"/comment"));const s=await fetch("".concat(this.baseUrl,"/conversations/").concat(e,"/comment"),{method:"PATCH",headers:this.getHeaders("PATCH"),body:JSON.stringify({comment:t,timestamp:(new Date).toISOString()})});if(!s.ok){if(404===s.status)return void console.warn("Endpoint commentaire feedback pas encore impl\xe9ment\xe9 sur le serveur");const e=await s.text();throw new Error("HTTP ".concat(s.status,": ").concat(e))}const a=await s.json();console.log("Commentaire feedback enregistr\xe9:",a.message)}catch(s){console.error("Erreur envoi commentaire feedback:",s)}else console.log("Logging d\xe9sactiv\xe9 - commentaire non envoy\xe9:",e)}async sendFeedbackWithComment(e,t,s){if(this.loggingEnabled)try{console.log("Envoi feedback avec commentaire:",e,t,s?"avec commentaire":"sans commentaire"),console.log("URL feedback combin\xe9:","".concat(this.baseUrl,"/conversations/").concat(e,"/feedback-with-comment"));const a=await fetch("".concat(this.baseUrl,"/conversations/").concat(e,"/feedback-with-comment"),{method:"PATCH",headers:this.getHeaders("PATCH"),body:JSON.stringify({feedback:t,comment:s||null,timestamp:(new Date).toISOString()})});if(!a.ok){if(404===a.status)return console.warn("Endpoint combin\xe9 non disponible, utilisation m\xe9thodes s\xe9par\xe9es"),await this.sendFeedback(e,t),void(s&&await this.sendFeedbackComment(e,s));const r=await a.text();throw new Error("HTTP ".concat(a.status,": ").concat(r))}const r=await a.json();console.log("Feedback avec commentaire enregistr\xe9:",r.message)}catch(a){throw console.error("Erreur envoi feedback avec commentaire:",a),a}else console.log("Logging d\xe9sactiv\xe9 - feedback avec commentaire non envoy\xe9:",e)}async deleteConversation(e){if(this.loggingEnabled)return console.log("[ConversationService] \ud83d\udd04 D\xe9l\xe9gation suppression vers apiService..."),await(async e=>{if(!e)throw new Error("ID de conversation requis");console.log("[apiService] Suppression conversation (Supabase singleton):",e);try{const t=await u(),s=await fetch("".concat(d,"/conversations/").concat(e),{method:"DELETE",headers:t});if(console.log("[apiService] Delete statut (Supabase singleton):",s.status),!s.ok){if(404===s.status)return void console.warn("[apiService] Conversation deja supprimee ou inexistante (singleton)");const e=await s.text();if(console.error("[apiService] Erreur delete conversation (Supabase singleton):",e),401===s.status)throw new Error("Session expiree. Veuillez vous reconnecter.");throw new Error("Erreur suppression conversation: ".concat(s.status))}const a=await s.json();console.log("[apiService] Conversation supprimee (Supabase singleton):",a.message||"Succes")}catch(t){throw console.error("[apiService] Erreur suppression conversation (Supabase singleton):",t),t}})(e);console.log("Logging d\xe9sactiv\xe9 - conversation non supprim\xe9e:",e)}async clearAllUserConversations(e){if(this.loggingEnabled)try{console.log("Suppression toutes conversations serveur pour:",e),console.log("URL suppression globale:","".concat(this.baseUrl,"/conversations/user/").concat(e));const t=await fetch("".concat(this.baseUrl,"/conversations/user/").concat(e),{method:"DELETE",headers:this.getHeaders("DELETE")});if(!t.ok){const e=await t.text();throw new Error("HTTP ".concat(t.status,": ").concat(e))}const s=await t.json();console.log("Toutes conversations supprim\xe9es du serveur:",s.message,"Count:",s.deleted_count)}catch(t){throw console.error("Erreur suppression toutes conversations serveur:",t),t}else console.log("Logging d\xe9sactiv\xe9 - conversations non supprim\xe9es:",e)}async getFeedbackStats(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:7;if(!this.loggingEnabled)return console.log("Logging d\xe9sactiv\xe9 - stats feedback non r\xe9cup\xe9r\xe9es"),null;try{const s=new URLSearchParams;e&&s.append("user_id",e),s.append("days",t.toString());const a="".concat(this.baseUrl,"/analytics/feedback?").concat(s.toString());console.log("R\xe9cup\xe9ration stats feedback:",a);const r=await fetch(a,{headers:this.getHeaders("GET")});if(!r.ok){if(404===r.status)return console.warn("Endpoint stats feedback pas encore impl\xe9ment\xe9"),null;throw new Error("HTTP ".concat(r.status))}const n=await r.json();return console.log("Stats feedback r\xe9cup\xe9r\xe9es:",n),n}catch(s){return console.error("Erreur r\xe9cup\xe9ration stats feedback:",s),null}}async testConnection(){try{console.log("Test connectivit\xe9 service logging...");const e=await fetch("".concat(this.baseUrl,"/test-comments"),{headers:this.getHeaders("GET")});if(e.ok){const t=await e.json();return console.log("Service logging op\xe9rationnel:",t.message),!0}return console.warn("Service logging indisponible:",e.status),!1}catch(e){return console.error("Erreur test connectivit\xe9:",e),!1}}resetCircuitBreaker(){this.circuitBreaker=new h,console.log("[ConversationService] Circuit breaker resett\xe9 manuellement")}getCircuitBreakerStatus(){return{attempts:this.circuitBreaker.attempts,canAttempt:this.circuitBreaker.canAttempt()}}constructor(){var e;this.loggingEnabled=!0,this.circuitBreaker=new h;const t=null===(e=f.env.NEXT_PUBLIC_API_BASE_URL)||void 0===e?void 0:e.replace(/\/+$/,""),s=f.env.NEXT_PUBLIC_API_VERSION||"v1";if(!t)return console.error("NEXT_PUBLIC_API_BASE_URL environment variable missing"),this.loggingEnabled=!1,void(this.baseUrl="");this.baseUrl="".concat(t,"/api/").concat(s),console.log("ConversationService configur\xe9:",t)}},b={isLoading:!1,currentUserId:null,lastLoadTime:0,COOLDOWN_PERIOD:3e3,MAX_RETRIES:3,retryCount:0},y=e=>{const t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()),a=new Date(s.getTime()-864e5),r=new Date(s.getTime()-6048e5),n=new Date(s.getTime()-2592e6),o=[{title:"today",conversations:[]},{title:"yesterday",conversations:[]},{title:"thisWeek",conversations:[]},{title:"thisMonth",conversations:[]},{title:"older",conversations:[]}];return e.forEach((e=>{const t=new Date(e.updated_at);t>=s?o[0].conversations.push(e):t>=a?o[1].conversations.push(e):t>=r?o[2].conversations.push(e):t>=n?o[3].conversations.push(e):o[4].conversations.push(e)})),o.filter((e=>e.conversations.length>0))},w=(0,l.Ue)(((e,t)=>({conversations:[],isLoading:!1,conversationGroups:[],currentConversation:null,isLoadingHistory:!1,isLoadingConversation:!1,loadConversations:async t=>{if(!t)return void console.warn("\u26a0\ufe0f [ChatStore] Pas d'userId fourni pour charger les conversations");if(b.isLoading&&b.currentUserId===t)return void console.log("\ud83d\udee1\ufe0f [ChatStore] Chargement d\xe9j\xe0 en cours pour cet utilisateur, ignor\xe9");const s=Date.now();if(s-b.lastLoadTime<b.COOLDOWN_PERIOD)console.log("\ud83d\udee1\ufe0f [ChatStore] Cooldown actif, chargement ignor\xe9");else if(b.retryCount>=b.MAX_RETRIES)console.log("\ud83d\udee1\ufe0f [ChatStore] Maximum de tentatives atteint, chargement bloqu\xe9");else{b.isLoading=!0,b.currentUserId=t,b.lastLoadTime=s,b.retryCount++,e({isLoading:!0,isLoadingHistory:!0});try{console.log("\ud83d\udce1 [ChatStore] Chargement conversations pour:",t);const s=await g(t);if(!s||!s.conversations||0===s.conversations.length)return console.log("\ud83d\udd2d [ChatStore] Aucune conversation trouv\xe9e"),void e({conversations:[],conversationGroups:[],isLoading:!1,isLoadingHistory:!1});const a=s.conversations;console.log("\u2705 [ChatStore] Conversations r\xe9cup\xe9r\xe9es:",a.length);const r=a.map((e=>{const t=e.title&&e.title.length>0?e.title.length>50?e.title.substring(0,50)+"...":e.title:"Conversation sans titre";return{id:e.id||Date.now().toString(),title:t,messages:[{id:"".concat(e.id,"-q"),role:"user",content:e.preview||"Question non disponible"},{id:"".concat(e.id,"-a"),role:"assistant",content:e.last_message_preview||"R\xe9ponse non disponible"}],updated_at:e.updated_at||(new Date).toISOString(),created_at:e.created_at||(new Date).toISOString(),feedback:e.feedback||null}})).sort(((e,t)=>new Date(t.updated_at).getTime()-new Date(e.updated_at).getTime())),n=y(a);e({conversations:r,conversationGroups:n,isLoading:!1,isLoadingHistory:!1}),console.log("\u2705 [ChatStore] \xc9tat mis \xe0 jour - Conversations:",r.length,"Groupes:",n.length),b.retryCount=0}catch(a){throw console.error("\u274c [ChatStore] Erreur chargement conversations:",a),e({conversations:[],conversationGroups:[],isLoading:!1,isLoadingHistory:!1}),b.retryCount<b.MAX_RETRIES&&setTimeout((()=>{b.isLoading=!1}),5e3),a}finally{b.isLoading=!1,b.lastLoadTime=Date.now()}}},deleteConversation:async s=>{try{var a;console.log("\ud83d\uddd1\ufe0f [ChatStore] Suppression conversation:",s);const r=t(),n=r.conversations.filter((e=>e.id!==s)),o=r.conversationGroups.map((e=>({...e,conversations:e.conversations.filter((e=>e.id!==s))}))).filter((e=>e.conversations.length>0));e({conversations:n,conversationGroups:o,currentConversation:(null===(a=r.currentConversation)||void 0===a?void 0:a.id)===s?null:r.currentConversation}),await x.deleteConversation(s),console.log("\u2705 [ChatStore] Conversation supprim\xe9e c\xf4t\xe9 serveur")}catch(r){console.error("\u274c [ChatStore] Erreur suppression conversation:",r)}},clearAllConversations:async t=>{try{console.log("\ud83d\uddd1\ufe0f [ChatStore] Suppression toutes conversations"),b.isLoading=!1,b.currentUserId=null,b.retryCount=0,e({conversations:[],conversationGroups:[],currentConversation:null}),t&&(await x.clearAllUserConversations(t),console.log("\u2705 [ChatStore] Toutes conversations supprim\xe9es c\xf4t\xe9 serveur"))}catch(s){console.error("\u274c [ChatStore] Erreur suppression conversations:",s)}},refreshConversations:async e=>{b.isLoading=!1,b.retryCount=0,b.lastLoadTime=0,await t().loadConversations(e)},addConversation:(s,a,r)=>{const n={id:s,title:a.length>50?a.substring(0,50)+"...":a,messages:[{id:"".concat(s,"-q"),role:"user",content:a},{id:"".concat(s,"-a"),role:"assistant",content:r}],updated_at:(new Date).toISOString(),created_at:(new Date).toISOString(),feedback:null},o=t(),i=[n,...o.conversations],l=[{id:s,title:a.length>60?a.substring(0,60)+"...":a,preview:a,message_count:2,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),language:"fr",last_message_preview:r.substring(0,100)+(r.length>100?"...":""),status:"active"},...o.conversationGroups.flatMap((e=>e.conversations))],c=y(l);e({conversations:i,conversationGroups:c})},loadConversation:async s=>{if(s){e({isLoadingConversation:!0});try{console.log("\ud83d\udcd6 [ChatStore] Chargement conversation:",s);try{var a;const t=await(null===(a=x.getConversationWithMessages)||void 0===a?void 0:a.call(x,s));if(t&&t.messages&&t.messages.length>0)return console.log("\u2705 [ChatStore] Conversation charg\xe9e depuis serveur avec messages complets"),void e({currentConversation:t,isLoadingConversation:!1})}catch(n){console.warn("\u26a0\ufe0f [ChatStore] Service getConversationWithMessages non disponible:",n)}const o=t().conversations.find((e=>e.id===s));if(o){var r;const t={id:o.id,title:o.title,preview:(null===(r=o.messages.find((e=>"user"===e.role)))||void 0===r?void 0:r.content)||"Aucun aper\xe7u",message_count:o.messages.length,created_at:o.created_at,updated_at:o.updated_at,language:"fr",status:"active",feedback:o.feedback,messages:o.messages.map((e=>({id:e.id,content:e.content,isUser:"user"===e.role,timestamp:new Date(o.updated_at),conversation_id:s,feedback:"assistant"===e.role&&1===o.feedback?"positive":"assistant"===e.role&&-1===o.feedback?"negative":null})))};return e({currentConversation:t,isLoadingConversation:!1}),void console.log("\u2705 [ChatStore] Conversation charg\xe9e depuis cache local")}const i={id:s,title:"Conversation non disponible",preview:"Impossible de charger les messages",message_count:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),language:"fr",status:"active",messages:[{id:"error-"+Date.now(),content:"\u274c Impossible de charger cette conversation. Veuillez r\xe9essayer ou commencer une nouvelle conversation.",isUser:!1,timestamp:new Date,conversation_id:s}]};e({currentConversation:i,isLoadingConversation:!1})}catch(o){console.error("\u274c [ChatStore] Erreur chargement conversation:",o),e({isLoadingConversation:!1})}}else console.warn("\u26a0\ufe0f [ChatStore] ID conversation requis")},createNewConversation:()=>{console.log("\u2728 [ChatStore] Nouvelle conversation"),e({currentConversation:null})},addMessage:s=>{var a;console.log("\ud83d\udcac [ChatStore] Ajout message:",s.id,"User:",s.isUser);const r=t();if(!r.currentConversation){const t={id:"temp-"+Date.now(),title:s.isUser?s.content.substring(0,60)+"...":"Nouvelle conversation",preview:s.content,message_count:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),language:"fr",status:"active",messages:[s]};return e({currentConversation:t}),void console.log("\ud83c\udd95 [ChatStore] Conversation temporaire cr\xe9\xe9e:",t.id)}if(null===(a=r.currentConversation.messages)||void 0===a?void 0:a.some((e=>e.id===s.id)))return void console.log("\u26a0\ufe0f [ChatStore] Message d\xe9j\xe0 existant, ignor\xe9");const n=[...r.currentConversation.messages||[],s];let o=r.currentConversation.id;s.conversation_id&&("welcome"===r.currentConversation.id||r.currentConversation.id.startsWith("temp-"))&&(o=s.conversation_id,console.log("\ud83d\udd04 [ChatStore] ID conversation mis \xe0 jour:",r.currentConversation.id,"\u2192",o));const i={...r.currentConversation,id:o,messages:n,message_count:n.length,updated_at:(new Date).toISOString(),title:"welcome"===r.currentConversation.id&&s.isUser?s.content.substring(0,60)+(s.content.length>60?"...":""):r.currentConversation.title,last_message_preview:s.isUser?r.currentConversation.last_message_preview||r.currentConversation.preview:s.content.substring(0,100)+(s.content.length>100?"...":"")};e({currentConversation:i}),console.log("\u2705 [ChatStore] Message ajout\xe9 - Total:",n.length,"Conv ID:",i.id)},updateMessage:(s,a)=>{const r=t();if(!r.currentConversation)return;const n=r.currentConversation.messages.map((e=>e.id===s?{...e,...a}:e)),o={...r.currentConversation,messages:n,updated_at:(new Date).toISOString()};e({currentConversation:o})},setCurrentConversation:t=>{var s;console.log("\ud83d\udd04 [ChatStore] setCurrentConversation appel\xe9e:",null===t||void 0===t?void 0:t.id,"Messages:",(null===t||void 0===t||null===(s=t.messages)||void 0===s?void 0:s.length)||0),e({currentConversation:t})}}))),j=e=>{let{className:t="w-5 h-5"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0 1 21.485 12 59.77 59.77 0 0 1 3.27 20.876L5.999 12zm0 0h7.5"})})},k=e=>{let{className:t="w-6 h-6"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})})},N=e=>{let{className:t="w-4 h-4"}=e;return(0,a.jsx)("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})})},C=e=>{let{className:t="w-4 h-4"}=e;return(0,a.jsx)("svg",{className:t,fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M18 9.5a1.5 1.5 0 11-3 0v-6a1.5 1.5 0 013 0v6zM14 9.667v-5.43a2 2 0 00-1.106-1.79l-.05-.025A4 4 0 0011.057 2H5.64a2 2 0 00-1.962 1.608l-1.2 6A2 2 0 004.44 12H8v4a2 2 0 002 2 1 1 0 001-1v-.667a4 4 0 01.8-2.4l1.4-1.866a4 4 0 00.8-2.4z"})})},S=e=>{let{className:t="w-5 h-5"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})},_=e=>{let{className:t="w-8 h-8"}=e;return(0,a.jsx)("img",{src:"/images/favicon.png",alt:"Intelia Logo",className:t})},E=e=>{let{className:t="w-5 h-5"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3"})})},L=e=>{let{className:t="w-6 h-6"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})},I=e=>{let{className:t="w-5 h-5"}=e;return(0,a.jsx)("svg",{className:t,fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.625 12a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H8.25m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0H12m4.125 0a.375.375 0 11-.75 0 .375.375 0 01.75 0zm0 0h-.375M21 12c0 4.556-4.03 8.25-9 8.25a9.764 9.764 0 01-2.555-.337A5.972 5.972 0 015.41 20.97a5.969 5.969 0 01-.474-.065 4.48 4.48 0 00.978-2.025c.09-.457-.133-.901-.467-1.226C3.93 16.178 3 14.189 3 12c0-4.556 4.03-8.25 9-8.25s9 3.694 9 8.25z"})})},P=r.memo((()=>{const{t:e}=(0,i.$G)(),[t,s]=(0,r.useState)(!1),{user:n}=(0,o.useAuthStore)(),{conversationGroups:l,isLoadingHistory:c,loadConversations:d}={conversationGroups:w((e=>e.conversationGroups)),isLoadingHistory:w((e=>e.isLoadingHistory)),loadConversations:w((e=>e.loadConversations))},{deleteConversation:u,clearAllConversations:m,refreshConversations:p,createNewConversation:g}={deleteConversation:w((e=>e.deleteConversation)),clearAllConversations:w((e=>e.clearAllConversations)),refreshConversations:w((e=>e.refreshConversations)),createNewConversation:w((e=>e.createNewConversation))},{currentConversation:f,loadConversation:h}={currentConversation:w((e=>e.currentConversation)),isLoadingConversation:w((e=>e.isLoadingConversation)),setCurrentConversation:w((e=>e.setCurrentConversation)),loadConversation:w((e=>e.loadConversation)),addMessage:w((e=>e.addMessage)),updateMessage:w((e=>e.updateMessage))},v=(0,r.useCallback)((t=>{switch(t){case"today":return e("history.groups.today");case"yesterday":return e("history.groups.yesterday");case"thisWeek":return e("history.groups.thisWeek");case"thisMonth":return e("history.groups.thisMonth");case"older":return e("history.groups.older");default:return t}}),[e]);r.useEffect((()=>{n&&!c&&d(n.email||n.id).catch(console.error)}),[n,d,c]),r.useEffect((()=>{if(!n)return;const e=setInterval((()=>{t||c||d(n.email||n.id).catch(console.error)}),3e4);return()=>clearInterval(e)}),[n,t,c,d]);const x=(0,r.useCallback)((async()=>{console.log(e("history.toggleClicked"),t,e("history.userPresent"),!!n);const a=!t;if(s(a),a&&n&&!c){console.log(e("history.loadingConversationsFor"),n.email||n.id);try{await d(n.email||n.id),console.log(e("history.conversationsLoaded"))}catch(r){console.error(e("history.loadingError"),r)}}}),[t,n,c,d,e]),b=(0,r.useCallback)((async e=>{e.preventDefault(),e.stopPropagation(),n&&await p(n.email||n.id)}),[n,p]),y=((0,r.useCallback)((async t=>{t.preventDefault(),t.stopPropagation(),n&&confirm(e("history.confirmClearAll"))&&await m(n.email||n.id)}),[n,m,e]),(0,r.useCallback)((async(e,t)=>{t.preventDefault(),t.stopPropagation(),await u(e),n&&await p(n.email||n.id)}),[u,n,p])),j=(0,r.useCallback)((async(e,t)=>{t.preventDefault(),t.stopPropagation(),await h(e.id),s(!1)}),[h]),N=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),g(),s(!1)}),[g]),C=(0,r.useCallback)((e=>{try{let t=e;!t||t.endsWith("Z")||/[+-]\d{2}:\d{2}$/.test(t)||(t+="Z");const s=new Date(t);if(isNaN(s.getTime()))return"\u2014";const a=s.getHours().toString().padStart(2,"0"),r=s.getMinutes().toString().padStart(2,"0");return"".concat(a,":").concat(r)}catch(t){return"\u2014"}}),[]),_=(0,r.useMemo)((()=>l.reduce(((e,t)=>e+t.conversations.length),0)),[l]),E=((0,r.useMemo)((()=>{const s={isOpen:t,totalConversations:_,conversationGroupsLength:l.length,isLoadingHistory:c,hasUser:!!n};return console.log(e("history.renderState"),s),s}),[t,_,l.length,c,n,e]),(0,r.useMemo)((()=>c?(0,a.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,a.jsxs)("div",{className:"flex items-center justify-center space-x-3 mb-2",children:[(0,a.jsx)("div",{className:"w-6 h-6 border-2 border-blue-600 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:e("history.loadingConversations")})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:e("history.retrievingHistory")})]}):0===l.length?(0,a.jsxs)("div",{className:"p-6 text-center text-gray-500",children:[(0,a.jsx)("div",{className:"mb-3",children:(0,a.jsx)(I,{className:"w-12 h-12 text-gray-300 mx-auto mb-2"})}),(0,a.jsx)("div",{className:"text-sm font-medium text-gray-600 mb-1",children:e("history.noConversations")}),(0,a.jsx)("div",{className:"text-xs text-gray-400 mb-4",children:e("history.startQuestion")}),(0,a.jsxs)("button",{onClick:N,className:"inline-flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(k,{className:"w-4 h-4"}),(0,a.jsx)("span",{children:e("history.newConversation")})]}),n&&(0,a.jsx)("button",{onClick:b,className:"ml-2 text-blue-600 hover:text-blue-700 text-xs underline",disabled:c,children:e("history.refresh")})]}):l.map(((t,s)=>(0,a.jsxs)("div",{className:"border-b border-gray-100 last:border-b-0",children:[(0,a.jsx)("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-700",children:v(t.title)}),(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["(",t.conversations.length,")"]})]})}),(0,a.jsx)("div",{className:"divide-y divide-gray-50",children:t.conversations.map((t=>(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 cursor-pointer transition-colors group ".concat((null===f||void 0===f?void 0:f.id)===t.id?"bg-blue-50 border-l-4 border-blue-500":""),onClick:e=>j(t,e),children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0 pr-3",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate mb-2",children:t.title}),(0,a.jsxs)("div",{className:"flex items-center space-x-3 text-xs text-gray-400",children:[(0,a.jsx)("span",{children:C(t.updated_at)}),null!=t.message_count&&(0,a.jsxs)("span",{children:[t.message_count," ",e("history.messageCount")]})]})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,a.jsx)("button",{onClick:e=>y(t.id,e),className:"text-red-600 hover:text-red-700 p-1 rounded",title:e("history.deleteConversation"),"aria-label":e("history.deleteConversation"),children:(0,a.jsx)(S,{className:"w-4 h-4"})})})]})},t.id)))})]},s)))),[c,l,n,null===f||void 0===f?void 0:f.id,N,b,j,y,C,v,e])),L=(0,r.useMemo)((()=>_<=0?null:(0,a.jsx)("span",{className:"notification-badge",children:_})),[_]),P=(0,r.useCallback)((()=>{s(!1)}),[]);return(0,a.jsxs)("div",{className:"relative header-icon-container",children:[(0,a.jsx)("button",{onClick:x,className:"w-10 h-10 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center border border-gray-200",title:e("nav.history"),"aria-label":e("nav.history"),children:(0,a.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,a.jsx)("path",{strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",d:"M8 7H5m0 0v3m0-3l2.2 2.2"}),(0,a.jsx)("path",{strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",d:"M21 12a9 9 0 10-9 9"}),(0,a.jsx)("path",{strokeWidth:"1.8",strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7v5l3 3"})]})}),L,t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:P}),(0,a.jsx)("div",{className:"absolute left-0 top-full mt-2 w-96 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-[70vh] overflow-hidden flex flex-col",children:(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:E})})]})]})}));P.displayName="HistoryMenu";var T=s(9376);const M={async performLogout(e){console.log("[LogoutService] Debut deconnexion via service independant");try{let n="fr";try{if(null===e||void 0===e?void 0:e.language)n=e.language,console.log("[LogoutService] Langue detectee depuis user:",n);else{const e=localStorage.getItem("intelia-language");if(e){var t;const s=JSON.parse(e);n=(null===s||void 0===s||null===(t=s.state)||void 0===t?void 0:t.currentLanguage)||"fr",console.log("[LogoutService] Langue detectee depuis localStorage:",n)}}}catch(a){console.warn("[LogoutService] Erreur detection langue, utilisation du francais:",a)}let o=null;try{const e=localStorage.getItem("intelia-remember-me-persist");e&&(o=JSON.parse(e),console.log("[LogoutService] RememberMe preserve"))}catch(a){console.warn("[LogoutService] Erreur preservation RememberMe:",a)}console.log("[LogoutService] Tentative deconnexion Supabase...");try{const{getSupabaseClient:e}=await Promise.resolve().then(s.bind(s,8225)),t=e();await t.auth.signOut(),console.log("[LogoutService] Deconnexion Supabase terminee")}catch(r){console.warn("[LogoutService] Erreur Supabase (continue quand meme):",r)}console.log("[LogoutService] Nettoyage localStorage...");const i=[];for(let e=0;e<localStorage.length;e++){const t=localStorage.key(e);t&&"intelia-remember-me-persist"!==t&&(t.startsWith("supabase-")||t.startsWith("intelia-")&&"intelia-remember-me-persist"!==t||t.includes("auth")||t.includes("session")||"intelia-expert-auth"===t||"intelia-chat-storage"===t)&&i.push(t)}if(i.forEach((e=>{try{localStorage.removeItem(e),console.log("[LogoutService] Supprime: ".concat(e))}catch(t){console.warn("[LogoutService] Impossible de supprimer ".concat(e,":"),t)}})),console.log("[LogoutService] ".concat(i.length," cles supprimees, RememberMe preserve")),o)try{localStorage.setItem("intelia-remember-me-persist",JSON.stringify(o)),console.log("[LogoutService] RememberMe restaure")}catch(a){console.warn("[LogoutService] Erreur restauration RememberMe:",a)}sessionStorage.setItem("recent-logout",Date.now().toString()),sessionStorage.setItem("logout-complete","true"),sessionStorage.setItem("logout-language",n),console.log("[LogoutService] Redirection vers page d'accueil en",n),setTimeout((()=>{window.location.href="/"}),100)}catch(a){console.error("[LogoutService] Erreur durant logout:",a),setTimeout((()=>{window.location.href="/"}),100)}}};var A,D=s(257);!function(e){e.ULTRA_CONCISE="ultra_concise",e.CONCISE="concise",e.STANDARD="standard",e.DETAILED="detailed"}(A||(A={}));Error;Error;(()=>{const e=D.env.NEXT_PUBLIC_API_BASE_URL,t=D.env.NEXT_PUBLIC_API_VERSION||"v1";if(!e)return console.error("\u274c NEXT_PUBLIC_API_BASE_URL environment variable missing"),{BASE_URL:"http://localhost:8000",TIMEOUT:3e4,LOGGING_BASE_URL:"http://localhost:8000/api/v1"};const s=e.replace(/\/api\/?$/,"");"".concat(s,"/api/").concat(t)})();const U={essential:{name:"Essentiel",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200",features:["50 questions par mois","Acc\xe8s aux documents publics","Support par email","Interface web"]},pro:{name:"Pro",color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200",features:["Questions illimit\xe9es","Acc\xe8s documents confidentiels","Support prioritaire","Interface web + mobile","Analytics avanc\xe9es"]}},R={TITLE_MAX_LENGTH:60,PREVIEW_MAX_LENGTH:150,MESSAGE_MAX_LENGTH:5e3,MAX_CONVERSATIONS_PER_USER:1e3,AUTO_DELETE_DAYS:30};"Le commentaire ne peut pas d\xe9passer ".concat({COMMENT_MIN_LENGTH:0,COMMENT_MAX_LENGTH:500,REQUIRED_FIELDS:[],ALLOWED_FEEDBACK_TYPES:["positive","negative"]}.COMMENT_MAX_LENGTH," caract\xe8res"),"Le message ne peut pas d\xe9passer ".concat(R.MESSAGE_MAX_LENGTH," caract\xe8res");var O=s(29),z=s.n(O);const F=[{code:"+1",country:"Canada/\xc9tats-Unis",flag:"\ud83c\udde8\ud83c\udde6\ud83c\uddfa\ud83c\uddf8",priority:1},{code:"+33",country:"France",flag:"\ud83c\uddeb\ud83c\uddf7",priority:2},{code:"+32",country:"Belgique",flag:"\ud83c\udde7\ud83c\uddea",priority:3},{code:"+41",country:"Suisse",flag:"\ud83c\udde8\ud83c\udded",priority:4},{code:"+49",country:"Allemagne",flag:"\ud83c\udde9\ud83c\uddea",priority:5},{code:"+44",country:"Royaume-Uni",flag:"\ud83c\uddec\ud83c\udde7",priority:6},{code:"+39",country:"Italie",flag:"\ud83c\uddee\ud83c\uddf9",priority:7},{code:"+34",country:"Espagne",flag:"\ud83c\uddea\ud83c\uddf8",priority:8},{code:"+31",country:"Pays-Bas",flag:"\ud83c\uddf3\ud83c\uddf1",priority:9},{code:"+46",country:"Su\xe8de",flag:"\ud83c\uddf8\ud83c\uddea",priority:10},{code:"+47",country:"Norv\xe8ge",flag:"\ud83c\uddf3\ud83c\uddf4",priority:11},{code:"+45",country:"Danemark",flag:"\ud83c\udde9\ud83c\uddf0",priority:12},{code:"+358",country:"Finlande",flag:"\ud83c\uddeb\ud83c\uddee",priority:13},{code:"+52",country:"Mexique",flag:"\ud83c\uddf2\ud83c\uddfd",priority:14},{code:"+55",country:"Br\xe9sil",flag:"\ud83c\udde7\ud83c\uddf7",priority:15},{code:"+61",country:"Australie",flag:"\ud83c\udde6\ud83c\uddfa",priority:16},{code:"+81",country:"Japon",flag:"\ud83c\uddef\ud83c\uddf5",priority:17},{code:"+86",country:"Chine",flag:"\ud83c\udde8\ud83c\uddf3",priority:18},{code:"+91",country:"Inde",flag:"\ud83c\uddee\ud83c\uddf3",priority:19},{code:"+7",country:"Russie",flag:"\ud83c\uddf7\ud83c\uddfa",priority:20}],q=e=>{let{countryCode:t,areaCode:s,phoneNumber:n,onChange:o,countries:l=[],countriesLoading:c=!1,usingFallback:d=!0}=e;const{t:u}=(0,i.$G)(),m=(0,r.useMemo)((()=>{if(0===l.length||d)return F;const e=l.filter((e=>e.phoneCode&&"+"!==e.phoneCode)).reduce(((e,t)=>{const s=e.find((e=>e.code===t.phoneCode));return s?s.country.includes(t.label)||(s.country+=", ".concat(t.label)):e.push({code:t.phoneCode,country:t.label,flag:t.flag}),e}),[]).sort(((e,t)=>{var s,a;const r=(null===(s=F.find((t=>t.code===e.code)))||void 0===s?void 0:s.priority)||999,n=(null===(a=F.find((e=>e.code===t.code)))||void 0===a?void 0:a.priority)||999;return r!==n?r-n:e.country.localeCompare(t.country)}));return e.length>50?e:F}),[l,d]),p=(e,a)=>{o({country_code:"country"===e?a:t,area_code:"area"===e?a:s,phone_number:"number"===e?a:n})},g=(0,r.useMemo)((()=>"phone-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9))),[]),f="".concat(g,"-country"),h="".concat(g,"-area"),v="".concat(g,"-number");return(0,a.jsxs)("div",{children:[d&&!c&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-yellow-50 border border-yellow-200 rounded text-xs text-yellow-800",children:(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})}),(0,a.jsx)("span",{children:u("phone.limitedList")})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-3 items-end",children:[(0,a.jsxs)("div",{className:"col-span-4",children:[(0,a.jsx)("label",{htmlFor:f,className:"block text-sm font-medium text-gray-700 mb-1",children:u("phone.countryCode")}),(0,a.jsxs)("select",{id:f,name:"countryCode",value:t,onChange:e=>p("country",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm bg-white h-10","aria-describedby":"".concat(f,"-help"),disabled:c,children:[(0,a.jsx)("option",{value:"",children:u(c?"phone.loading":"phone.select")}),m.map((e=>{let{code:t,country:s,flag:r}=e;return(0,a.jsxs)("option",{value:t,children:[r?"".concat(r," "):"",t," ",s]},t)}))]}),(0,a.jsx)("div",{id:"".concat(f,"-help"),className:"sr-only",children:u("phone.countryCodeHelp")}),c&&(0,a.jsx)("div",{className:"mt-1 text-xs text-gray-500",children:u("phone.loadingCodes")})]}),(0,a.jsxs)("div",{className:"col-span-3",children:[(0,a.jsx)("label",{htmlFor:h,className:"block text-sm font-medium text-gray-700 mb-1",children:u("phone.areaCode")}),(0,a.jsx)("input",{type:"text",id:h,name:"areaCode",value:s,onChange:e=>p("area",e.target.value.replace(/\D/g,"")),placeholder:u("phone.areaCodePlaceholder"),disabled:!t,maxLength:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm disabled:bg-gray-100 disabled:text-gray-500 h-10","aria-describedby":"".concat(h,"-help")}),(0,a.jsx)("div",{id:"".concat(h,"-help"),className:"sr-only",children:u("phone.areaCodeHelp")})]}),(0,a.jsxs)("div",{className:"col-span-5",children:[(0,a.jsx)("label",{htmlFor:v,className:"block text-sm font-medium text-gray-700 mb-1",children:u("phone.phoneNumber")}),(0,a.jsx)("input",{type:"tel",id:v,name:"phoneNumber",value:n,onChange:e=>p("number",e.target.value.replace(/\D/g,"")),placeholder:u("phone.phoneNumberPlaceholder"),disabled:!t,maxLength:10,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm disabled:bg-gray-100 disabled:text-gray-500 h-10","aria-describedby":"".concat(v,"-help")}),(0,a.jsx)("div",{id:"".concat(v,"-help"),className:"sr-only",children:u("phone.phoneNumberHelp")})]})]})]})},B=e=>{let{countries:t,value:s,onChange:n,placeholder:o,className:l=""}=e;const{t:c}=(0,i.$G)(),[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(""),[g,f]=(0,r.useState)(-1),h=(0,r.useRef)(null),v=(0,r.useRef)(null),x=(0,r.useRef)(null),b=o||c("placeholder.countrySelect"),y=t.filter((e=>e.label.toLowerCase().includes(m.toLowerCase()))),w=t.find((e=>e.value===s));(0,r.useEffect)((()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&(u(!1),p(""),f(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),(0,r.useEffect)((()=>{d&&v.current&&v.current.focus()}),[d]);const j=e=>{if(d)switch(e.key){case"ArrowDown":e.preventDefault(),f((e=>e<y.length-1?e+1:0));break;case"ArrowUp":e.preventDefault(),f((e=>e>0?e-1:y.length-1));break;case"Enter":e.preventDefault(),g>=0&&y[g]&&(n(y[g].value),u(!1),p(""),f(-1));break;case"Escape":u(!1),p(""),f(-1)}else"Enter"!==e.key&&" "!==e.key&&"ArrowDown"!==e.key||(e.preventDefault(),u(!0))};(0,r.useEffect)((()=>{if(g>=0&&x.current){const e=x.current.children[g];e&&e.scrollIntoView({block:"nearest"})}}),[g]);return(0,a.jsxs)("div",{ref:h,className:"relative ".concat(l),children:[(0,a.jsxs)("button",{type:"button",onClick:()=>u(!d),onKeyDown:j,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white text-left flex items-center justify-between ".concat(d?"ring-2 ring-blue-500 border-transparent":""),"aria-label":w?w.label:b,"aria-expanded":d,"aria-haspopup":"listbox",children:[(0,a.jsx)("span",{className:w?"text-gray-900":"text-gray-500",children:w?(0,a.jsxs)("span",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"mr-2",children:w.flag}),w.label]}):b}),(0,a.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform duration-200 ".concat(d?"transform rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),d&&(0,a.jsxs)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-hidden",children:[(0,a.jsx)("div",{className:"p-2 border-b border-gray-100",children:(0,a.jsx)("input",{ref:v,type:"text",value:m,onChange:e=>{p(e.target.value),f(-1)},onKeyDown:j,placeholder:c("countries.searchPlaceholder"),className:"w-full px-2 py-1 text-sm border border-gray-200 rounded focus:outline-none focus:ring-1 focus:ring-blue-500 focus:border-transparent","aria-label":c("countries.searchPlaceholder")})}),(0,a.jsx)("ul",{ref:x,className:"max-h-48 overflow-y-auto",role:"listbox","aria-label":c("countries.listLabel"),children:y.length>0?y.map(((e,t)=>(0,a.jsx)("li",{role:"option","aria-selected":e.value===s,children:(0,a.jsxs)("button",{type:"button",onClick:()=>(e=>{n(e.value),u(!1),p(""),f(-1)})(e),className:"w-full px-3 py-2 text-left flex items-center hover:bg-blue-50 focus:outline-none focus:bg-blue-50 ".concat(t===g?"bg-blue-50":""," ").concat(e.value===s?"bg-blue-100 text-blue-900 font-medium":"text-gray-900 bg-white"),style:{color:e.value===s?"#1e3a8a":"#111827",backgroundColor:e.value===s?"#dbeafe":t===g?"#eff6ff":"#ffffff"},"aria-label":"".concat(c("countries.select")," ").concat(e.label),children:[(0,a.jsx)("span",{className:"mr-2 text-base","aria-hidden":"true",children:e.flag}),(0,a.jsx)("span",{className:"flex-1",children:e.label}),e.value===s&&(0,a.jsx)("svg",{className:"w-4 h-4 text-blue-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})]})},e.value))):(0,a.jsx)("li",{className:"px-3 py-4 text-center text-gray-500 text-sm",role:"option",children:"".concat(c("countries.noResults"),": ").concat(m)})})]})]})},H=[{value:"CA",label:"Canada",phoneCode:"+1",flag:"\ud83c\udde8\ud83c\udde6"},{value:"US",label:"\xc9tats-Unis",phoneCode:"+1",flag:"\ud83c\uddfa\ud83c\uddf8"},{value:"FR",label:"France",phoneCode:"+33",flag:"\ud83c\uddeb\ud83c\uddf7"},{value:"GB",label:"Royaume-Uni",phoneCode:"+44",flag:"\ud83c\uddec\ud83c\udde7"},{value:"DE",label:"Allemagne",phoneCode:"+49",flag:"\ud83c\udde9\ud83c\uddea"},{value:"IT",label:"Italie",phoneCode:"+39",flag:"\ud83c\uddee\ud83c\uddf9"},{value:"ES",label:"Espagne",phoneCode:"+34",flag:"\ud83c\uddea\ud83c\uddf8"},{value:"BE",label:"Belgique",phoneCode:"+32",flag:"\ud83c\udde7\ud83c\uddea"},{value:"CH",label:"Suisse",phoneCode:"+41",flag:"\ud83c\udde8\ud83c\udded"},{value:"MX",label:"Mexique",phoneCode:"+52",flag:"\ud83c\uddf2\ud83c\uddfd"},{value:"BR",label:"Br\xe9sil",phoneCode:"+55",flag:"\ud83c\udde7\ud83c\uddf7"},{value:"AU",label:"Australie",phoneCode:"+61",flag:"\ud83c\udde6\ud83c\uddfa"},{value:"JP",label:"Japon",phoneCode:"+81",flag:"\ud83c\uddef\ud83c\uddf5"},{value:"CN",label:"Chine",phoneCode:"+86",flag:"\ud83c\udde8\ud83c\uddf3"},{value:"IN",label:"Inde",phoneCode:"+91",flag:"\ud83c\uddee\ud83c\uddf3"},{value:"NL",label:"Pays-Bas",phoneCode:"+31",flag:"\ud83c\uddf3\ud83c\uddf1"},{value:"SE",label:"Su\xe8de",phoneCode:"+46",flag:"\ud83c\uddf8\ud83c\uddea"},{value:"NO",label:"Norv\xe8ge",phoneCode:"+47",flag:"\ud83c\uddf3\ud83c\uddf4"},{value:"DK",label:"Danemark",phoneCode:"+45",flag:"\ud83c\udde9\ud83c\uddf0"},{value:"FI",label:"Finlande",phoneCode:"+358",flag:"\ud83c\uddeb\ud83c\uddee"}],W=e=>{let{password:t}=e;const{t:s}=(0,i.$G)(),r=[{test:t.length>=8,label:s("profile.passwordRequirements8")},{test:/[A-Z]/.test(t),label:s("profile.passwordRequirementsUpper")},{test:/[a-z]/.test(t),label:s("profile.passwordRequirementsLower")},{test:/\d/.test(t),label:s("profile.passwordRequirementsNumber")},{test:/[!@#$%^&*(),.?":{}|<>]/.test(t),label:s("profile.passwordRequirementsSpecial")}];return(0,a.jsxs)("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-700 mb-2",children:s("profile.passwordRequirements")}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-1 text-xs",children:r.map(((e,t)=>(0,a.jsxs)("div",{className:"flex items-center ".concat(e.test?"text-green-600":"text-gray-400"," ").concat(t===r.length-1?"sm:col-span-2":""),children:[(0,a.jsx)("span",{className:"mr-1",children:e.test?"\u2705":"\u2b55"}),e.label]},t)))})]})},G=e=>{let{id:t,label:s,value:r,onChange:n,placeholder:o,autoComplete:i,required:l,showStrength:c,showPassword:d,onToggleShow:u}=e;return"PasswordInput rendered for ".concat(t),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[s," ",l&&(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("input",{id:t,type:d?"text":"password",name:t,autoComplete:i,value:r,onChange:e=>{"Password ".concat(t," changed"),e.target.value.length,n(e.target.value)},className:"input-primary pr-10",placeholder:o,required:l}),(0,a.jsx)("button",{type:"button",onClick:()=>{"Toggle password visibility for ".concat(t),u()},className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors",children:d?(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 11-4.243-4.243m4.242 4.242L9.88 9.88"})}):(0,a.jsxs)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:[(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]}),c&&(0,a.jsx)(W,{password:r})]})},$=e=>{let{errors:t,title:s}=e;return 0===t.length?null:("Displaying ".concat(t.length," errors"),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"text-sm text-red-800",children:[(0,a.jsxs)("p",{className:"font-medium mb-2",children:[s," :"]}),(0,a.jsx)("ul",{className:"list-disc list-inside space-y-1",children:t.map(((e,t)=>(0,a.jsx)("li",{children:e},t)))})]})}))},V=e=>{let{user:t,onClose:n}=e;if(null===t||void 0===t||t.email,Date.now(),!t)return null;const o=(0,r.useRef)(!0);(0,r.useEffect)((()=>(o.current=!0,()=>{o.current=!1})),[]);const{t:l,changeLanguage:c,getCurrentLanguage:d}=(0,i.$G)(),{validatePhoneFields:u}=(()=>{const{t:e}=(0,i.$G)();return{validatePhoneFields:(t,s,a)=>{const r=t||s||a;if(!r)return{isValid:!0,errors:[]};const n=[];return r&&!t&&n.push(e("phone.validation.countryRequired")),r&&!a&&n.push(e("phone.validation.numberRequired")),{isValid:0===n.length,errors:n}}}})(),m=(0,r.useRef)(null);(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=m.current;if(e){e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("top","0","important"),e.style.setProperty("left","0","important"),e.style.setProperty("right","0","important"),e.style.setProperty("bottom","0","important"),e.style.setProperty("background-color","rgba(0, 0, 0, 0.5)","important"),e.style.setProperty("backdrop-filter","blur(2px)","important"),e.style.setProperty("animation","fadeIn 0.2s ease-out","important"),e.style.setProperty("display","flex","important"),e.style.setProperty("align-items","center","important"),e.style.setProperty("justify-content","center","important"),e.style.setProperty("padding","16px","important");const t=e.querySelector('[data-modal="user-info"]');t&&(t.style.setProperty("animation","modalSlideIn 0.3s ease-out","important"),t.style.setProperty("width","95vw","important"),t.style.setProperty("max-width","700px","important"),t.style.setProperty("max-height","85vh","important"),t.style.setProperty("min-width","320px","important"),t.style.setProperty("background-color","white","important"))}}),[]);(0,r.useMemo)((()=>{if(!(null===t||void 0===t?void 0:t.id))return{firstName:"",lastName:"",email:"",country_code:"",area_code:"",phone_number:"",country:"",linkedinProfile:"",companyName:"",companyWebsite:"",linkedinCorporate:""};const e={firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",country_code:t.country_code||"",area_code:t.area_code||"",phone_number:t.phone_number||"",country:t.country||"",linkedinProfile:t.linkedinProfile||"",companyName:t.companyName||"",companyWebsite:t.companyWebsite||"",linkedinCorporate:t.linkedinCorporate||""};return e}),[null===t||void 0===t?void 0:t.id]);const[p,g]=(0,r.useState)(!1),[f,h]=(0,r.useState)("profile"),[v,x]=(0,r.useState)([]),[b,y]=(0,r.useState)([]),[w,j]=(0,r.useState)((()=>(null===t||void 0===t?void 0:t.id)?{firstName:t.firstName||"",lastName:t.lastName||"",email:t.email||"",country_code:t.country_code||"",area_code:t.area_code||"",phone_number:t.phone_number||"",country:t.country||"",linkedinProfile:t.linkedinProfile||"",companyName:t.companyName||"",companyWebsite:t.companyWebsite||"",linkedinCorporate:t.linkedinCorporate||""}:{firstName:"",lastName:"",email:"",country_code:"",area_code:"",phone_number:"",country:"",linkedinProfile:"",companyName:"",companyWebsite:"",linkedinCorporate:""})),[k,N]=(0,r.useState)({currentPassword:"",newPassword:"",confirmPassword:""}),[C,S]=(0,r.useState)({currentPassword:!1,newPassword:!1,confirmPassword:!1});v.length,b.length;const{countries:_,loading:E,usingFallback:L}=(()=>{const[e,t]=(0,r.useState)(H),[s,a]=(0,r.useState)(!1),[n,o]=(0,r.useState)(!0),i=(0,r.useRef)(null);return(0,r.useEffect)((()=>((async()=>{i.current&&i.current.abort(),i.current=new AbortController;const e=i.current.signal;try{a(!0);const s=await fetch("https://restcountries.com/v3.1/all?fields=cca2,name,idd,flag,translations",{signal:e});if(s.ok,s.status,!s.ok||e.aborted)return;const r=await s.json();if(null===r||void 0===r||r.length,e.aborted)return;const n=r.map((e=>{var t,s,a,r,n;return{value:e.cca2,label:(null===(s=e.translations)||void 0===s||null===(t=s.fra)||void 0===t?void 0:t.common)||e.name.common,phoneCode:((null===(a=e.idd)||void 0===a?void 0:a.root)||"")+((null===(n=e.idd)||void 0===n||null===(r=n.suffixes)||void 0===r?void 0:r[0])||""),flag:e.flag}})).filter((e=>e.phoneCode&&e.phoneCode.length>1&&e.phoneCode.startsWith("+")&&e.value&&e.label)).sort(((e,t)=>e.label.localeCompare(t.label)));n.length,n.length>=50&&!e.aborted&&(t(n),o(!1))}catch(s){s instanceof Error&&"AbortError"!==s.name&&s.message}finally{e.aborted||a(!1)}})(),()=>{i.current&&i.current.abort()})),[]),{countries:e,loading:s,usingFallback:n}})(),I=(0,r.useCallback)((e=>{const t=[];return e.length<8&&t.push(l("form.passwordMinLength")),/[A-Z]/.test(e)||t.push(l("form.passwordUppercase")),/[a-z]/.test(e)||t.push(l("form.passwordLowercase")),/\d/.test(e)||t.push(l("form.passwordNumber")),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push(l("form.passwordSpecial")),e.length,t}),[l]),P=(0,r.useCallback)((e=>{const t=[];return e.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)?e.length>254&&t.push(l("error.emailTooLong")):t.push(l("error.emailInvalid")):t.push(l("error.emailRequired")),t}),[l]),T=(0,r.useCallback)(((e,t)=>{const s=[];if(e.trim())try{new URL(e),e.startsWith("http://")||e.startsWith("https://")||s.push("".concat(t," ").concat(l("error.urlProtocol")))}catch(a){s.push("".concat(t," ").concat(l("error.urlInvalid")))}return s}),[l]),M=(0,r.useCallback)(((e,t)=>{const s=[];if(e.trim()){const a=T(e,t);if(0===a.length){e.includes("linkedin.com/")&&(e.includes("/in/")||e.includes("/company/"))||s.push("".concat(t," ").concat(l("error.linkedinInvalid")))}else s.push(...a)}return s}),[T,l]),A=(0,r.useCallback)((()=>{p||n()}),[p,n]),D=(0,r.useCallback)(((e,t)=>{t.substring(0,20),j((s=>({...s,[e]:t})))}),[]),U=(0,r.useCallback)(((e,t)=>{t.length,N((s=>({...s,[e]:t})))}),[]),R=(0,r.useCallback)((e=>{S((t=>({...t,[e]:!t[e]})))}),[]),O=(0,r.useCallback)((e=>{j((t=>({...t,country_code:e.country_code,area_code:e.area_code,phone_number:e.phone_number})))}),[]),F=(0,r.useCallback)((async()=>{if(o.current&&!p){g(!0),x([]);try{const e=[];w.firstName.trim()?w.firstName.length>50&&e.push(l("error.firstNameTooLong")):e.push(l("error.firstNameRequired")),w.lastName.trim()?w.lastName.length>50&&e.push(l("error.lastNameTooLong")):e.push(l("error.lastNameRequired"));const t=P(w.email);e.push(...t);if(w.country_code||w.area_code||w.phone_number){const t=u(w.country_code,w.area_code,w.phone_number);t.isValid||e.push(...t.errors.map((e=>"".concat(l("error.phonePrefix")," ").concat(e))))}if(w.linkedinProfile){const t=M(w.linkedinProfile,l("profile.linkedinProfile"));e.push(...t)}if(w.companyWebsite){const t=T(w.companyWebsite,l("profile.companyWebsite"));e.push(...t)}if(w.linkedinCorporate){const t=M(w.linkedinCorporate,l("profile.linkedinCorporate"));e.push(...t)}if(w.companyName&&w.companyName.length>100&&e.push(l("error.companyNameTooLong")),e.length>0)return void(o.current&&x(e));const{useAuthStore:a}=await Promise.resolve().then(s.bind(s,9272)),n=(0,a.getState)().user;if(!(null===n||void 0===n?void 0:n.id))return void(o.current&&x([l("error.userNotConnected")]));const i={};if(void 0!==w.firstName&&(i.first_name=String(w.firstName).trim()),void 0!==w.lastName&&(i.last_name=String(w.lastName).trim()),void 0!==w.firstName||void 0!==w.lastName){const e="".concat(w.firstName||""," ").concat(w.lastName||"").trim();i.full_name=e}void 0!==w.country_code&&(i.country_code=w.country_code),void 0!==w.area_code&&(i.area_code=w.area_code),void 0!==w.phone_number&&(i.phone_number=w.phone_number),void 0!==w.country&&(i.country=w.country),void 0!==w.linkedinProfile&&(i.linkedin_profile=w.linkedinProfile),void 0!==w.companyName&&(i.company_name=w.companyName),void 0!==w.companyWebsite&&(i.company_website=w.companyWebsite),void 0!==w.linkedinCorporate&&(i.linkedin_corporate=w.linkedinCorporate);const{getSupabaseClient:c}=await Promise.resolve().then(s.bind(s,8225)),d=c(),{error:m}=await d.from("users").update(i).eq("auth_user_id",n.id);if(m)return void(o.current&&x([m.message||l("error.updateProfile")]));if(!o.current)return;console.log(l("success.profileUpdated")),setTimeout((async()=>{try{const e=a.getState();e.checkAuth&&(await e.checkAuth(),console.log(l("success.authSynchronized")))}catch(e){console.warn("Erreur rechargement profil:",e)}}),100),(0,r.startTransition)((()=>{o.current&&A()}))}catch(e){o.current&&(console.error("Erreur mise \xe0 jour profil:",e),x([l("common.unexpectedError")]))}finally{o.current&&g(!1)}}}),[p,w,P,T,M,u,A,l]),W=(0,r.useCallback)((async()=>{if(p)return;const e=[];k.currentPassword||e.push(l("error.currentPasswordRequired")),k.newPassword||e.push(l("error.newPasswordRequired")),k.confirmPassword||e.push(l("error.confirmPasswordRequired")),k.newPassword!==k.confirmPassword&&e.push(l("form.passwordMismatch"));const s=I(k.newPassword);if(e.push(...s),y(e),!(e.length>0)){g(!0);try{const e=await fetch("/api/v1/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:null===t||void 0===t?void 0:t.email,password:k.currentPassword})});if(e.ok,e.status,!e.ok)return void y([l("error.currentPasswordIncorrect")]);const s=(await e.json()).access_token,n=await fetch("/api/v1/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({current_password:k.currentPassword,new_password:k.newPassword})});n.ok,n.status;let i=null;try{i=await n.json()}catch(a){}if(!n.ok)return void y([(null===i||void 0===i?void 0:i.detail)||(null===i||void 0===i?void 0:i.message)||l("error.changePassword")]);N({currentPassword:"",newPassword:"",confirmPassword:""}),y([]),console.log(l("success.passwordChanged")),(0,r.startTransition)((()=>{o.current&&A()}))}catch(n){null===n||void 0===n||n.message,console.error("Erreur technique:",n),y([l("error.passwordServerError")])}finally{g(!1)}}}),[k,I,null===t||void 0===t?void 0:t.email,A,p,l]),V=(0,r.useMemo)((()=>[{id:"profile",label:l("nav.profile"),icon:"\ud83d\udc64"},{id:"password",label:l("profile.password"),icon:"\ud83d\udd11"}]),[l]);(0,r.useEffect)((()=>{const e=e=>{"Escape"!==e.key||p||A()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}}),[A,p]);const J=(0,r.useCallback)((e=>{e.target!==e.currentTarget||p||A()}),[A,p]);return _.length,(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z(),{id:"48f42c3ef862f813",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}.modal-content.jsx-48f42c3ef862f813{background-color:white!important}"}),(0,a.jsx)("div",{ref:m,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)"},onClick:J,"data-debug":"modal-overlay",className:"jsx-48f42c3ef862f813 fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),"data-modal":"user-info","data-debug":"modal-content",className:"jsx-48f42c3ef862f813 bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"jsx-48f42c3ef862f813 text-xl font-semibold text-gray-900",children:l("profile.title")}),(0,a.jsx)("button",{onClick:A,"aria-label":l("modal.close"),title:l("modal.close"),disabled:p,"data-debug":"close-button",className:"jsx-48f42c3ef862f813 text-gray-400 hover:text-gray-600 transition-colors hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center",children:(0,a.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-48f42c3ef862f813 w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12",className:"jsx-48f42c3ef862f813"})})})]}),(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 border-b border-gray-200",children:(0,a.jsx)("nav",{"data-debug":"tabs-nav",className:"jsx-48f42c3ef862f813 flex px-6",children:V.map((e=>(0,a.jsxs)("button",{onClick:()=>{"Tab clicked: ".concat(e.id),h(e.id)},"data-debug":"tab-".concat(e.id),className:"jsx-48f42c3ef862f813 "+"py-3 px-4 border-b-2 font-medium text-sm transition-colors ".concat(f===e.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 mr-2",children:e.icon}),e.label]},e.id)))})}),(0,a.jsx)("div",{"data-debug":"modal-body",className:"jsx-48f42c3ef862f813 p-6",children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 space-y-6",children:[(0,a.jsx)($,{errors:v,title:l("error.validationErrors")}),L&&!E&&(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center space-x-2",children:[(0,a.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-48f42c3ef862f813 w-4 h-4 text-yellow-600",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z",className:"jsx-48f42c3ef862f813"})}),(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 text-sm text-yellow-800",children:l("countries.fallbackWarning")})]})}),"profile"===f&&(0,a.jsxs)("div",{"data-debug":"profile-tab",className:"jsx-48f42c3ef862f813 space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsxs)("h3",{className:"jsx-48f42c3ef862f813 text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 w-2 h-2 bg-red-500 rounded-full mr-2"}),l("profile.personalInfo"),(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 text-red-500 ml-1",children:"*"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 grid grid-cols-1 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.firstName")}),(0,a.jsx)("input",{type:"text",value:w.firstName,onChange:e=>D("firstName",e.target.value),required:!0,"data-debug":"firstName-input",className:"jsx-48f42c3ef862f813 input-primary"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.lastName")}),(0,a.jsx)("input",{type:"text",value:w.lastName,onChange:e=>D("lastName",e.target.value),required:!0,"data-debug":"lastName-input",className:"jsx-48f42c3ef862f813 input-primary"})]})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 mb-4",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.email")}),(0,a.jsx)("input",{type:"email",value:w.email,onChange:e=>D("email",e.target.value),required:!0,"data-debug":"email-input",className:"jsx-48f42c3ef862f813 input-primary"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 mb-4",children:[(0,a.jsxs)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-3",children:[l("profile.phone")," ",(0,a.jsxs)("span",{className:"jsx-48f42c3ef862f813 text-gray-500 text-sm",children:["(",l("common.optional"),")"]})]}),(0,a.jsx)("div",{"data-debug":"phone-input",className:"jsx-48f42c3ef862f813",children:(0,a.jsx)(q,{countryCode:w.country_code,areaCode:w.area_code,phoneNumber:w.phone_number,onChange:O,countries:_,countriesLoading:E,usingFallback:L})})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsxs)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:[l("profile.country")," ",(0,a.jsxs)("span",{className:"jsx-48f42c3ef862f813 text-gray-500 text-sm",children:["(",l("common.optional"),")"]})]}),(0,a.jsx)("div",{"data-debug":"country-select",className:"jsx-48f42c3ef862f813",children:(0,a.jsx)(B,{countries:_,value:w.country,onChange:e=>D("country",e),placeholder:l("placeholder.countrySelect")})})]})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsxs)("h3",{className:"jsx-48f42c3ef862f813 text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 w-2 h-2 bg-blue-500 rounded-full mr-2"}),l("profile.professionalInfo"),(0,a.jsxs)("span",{className:"jsx-48f42c3ef862f813 text-gray-500 text-sm ml-2",children:["(",l("common.optional"),")"]})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.linkedinProfile")}),(0,a.jsx)("input",{type:"url",value:w.linkedinProfile,onChange:e=>D("linkedinProfile",e.target.value),placeholder:l("placeholder.linkedinPersonal"),"data-debug":"linkedin-input",className:"jsx-48f42c3ef862f813 input-primary"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.companyName")}),(0,a.jsx)("input",{type:"text",value:w.companyName,onChange:e=>D("companyName",e.target.value),placeholder:l("placeholder.companyName"),"data-debug":"company-name-input",className:"jsx-48f42c3ef862f813 input-primary"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.companyWebsite")}),(0,a.jsx)("input",{type:"url",value:w.companyWebsite,onChange:e=>D("companyWebsite",e.target.value),placeholder:l("placeholder.companyWebsite"),"data-debug":"company-website-input",className:"jsx-48f42c3ef862f813 input-primary"})]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("label",{className:"jsx-48f42c3ef862f813 block text-sm font-medium text-gray-700 mb-2",children:l("profile.linkedinCorporate")}),(0,a.jsx)("input",{type:"url",value:w.linkedinCorporate,onChange:e=>D("linkedinCorporate",e.target.value),placeholder:l("placeholder.linkedinCorporate"),"data-debug":"linkedin-corporate-input",className:"jsx-48f42c3ef862f813 input-primary"})]})]})]})]}),"password"===f&&(0,a.jsxs)("div",{"data-debug":"password-tab",className:"jsx-48f42c3ef862f813 space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsxs)("h3",{className:"jsx-48f42c3ef862f813 text-lg font-medium text-gray-900 mb-4 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 w-2 h-2 bg-orange-500 rounded-full mr-2"}),l("profile.password")]}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 space-y-4",children:[(0,a.jsx)(G,{id:"currentPassword",label:l("profile.currentPassword"),value:k.currentPassword,onChange:e=>U("currentPassword",e),placeholder:l("placeholder.currentPassword"),autoComplete:"current-password",required:!0,showPassword:C.currentPassword,onToggleShow:()=>R("currentPassword")}),(0,a.jsx)(G,{id:"newPassword",label:l("profile.newPassword"),value:k.newPassword,onChange:e=>U("newPassword",e),placeholder:l("placeholder.newPassword"),autoComplete:"new-password",required:!0,showStrength:!0,showPassword:C.newPassword,onToggleShow:()=>R("newPassword")}),(0,a.jsx)(G,{id:"confirmPassword",label:l("profile.confirmPassword"),value:k.confirmPassword,onChange:e=>U("confirmPassword",e),placeholder:l("placeholder.confirmPassword"),autoComplete:"new-password",required:!0,showPassword:C.confirmPassword,onToggleShow:()=>R("confirmPassword")})]})]}),(0,a.jsx)($,{errors:b,title:l("profile.passwordErrors")})]}),(0,a.jsxs)("div",{"data-debug":"footer",className:"jsx-48f42c3ef862f813 flex justify-end space-x-3 pt-4 pb-8",children:[(0,a.jsx)("button",{onClick:A,disabled:p,"data-debug":"cancel-button",className:"jsx-48f42c3ef862f813 px-4 py-2 text-gray-600 hover:text-gray-800 font-medium transition-colors",children:l("modal.cancel")}),(0,a.jsxs)("button",{onClick:"profile"===f?F:W,disabled:p,"data-debug":"save-button",className:"jsx-48f42c3ef862f813 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed font-medium transition-colors flex items-center focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:[p&&(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),l(p?"modal.loading":"modal.save")]})]})]})})]})})]})},J=e=>{let{user:t,onClose:s}=e;const{t:r}=(0,i.$G)(),n=(null===t||void 0===t?void 0:t.plan)||"essential",o=U[n];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:s}),(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:r("subscription.title")}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 text-2xl","aria-label":r("modal.close"),title:r("modal.close"),children:"\xd7"})]}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:r("subscription.currentPlan")}),(0,a.jsxs)("div",{className:"inline-flex items-center px-4 py-2 rounded-full ".concat(o.bgColor," ").concat(o.borderColor," border"),children:[(0,a.jsx)("span",{className:"font-medium ".concat(o.color),children:o.name}),(0,a.jsx)("span",{className:"mx-2 text-gray-400",children:"\u2022"}),(0,a.jsx)("span",{className:"font-bold ".concat(o.color),children:r("essential"===n?"subscription.free":"subscription.premium.price")})]})]}),(0,a.jsxs)("div",{className:"p-4 rounded-lg ".concat(o.bgColor," ").concat(o.borderColor," border"),children:[(0,a.jsxs)("h4",{className:"font-medium text-gray-900 mb-3",children:[r("subscription.featuresIncluded"),":"]}),(0,a.jsx)("ul",{className:"space-y-2",children:o.features.map(((e,t)=>(0,a.jsxs)("li",{className:"flex items-center text-sm text-gray-700",children:[(0,a.jsx)("span",{className:"text-green-500 mr-2",children:"\u2713"}),e]},t)))})]}),(0,a.jsx)("div",{className:"flex justify-end pt-4",children:(0,a.jsx)("button",{onClick:s,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:r("modal.close")})})]})})]})})]})},X=e=>{let{onClose:t}=e;const{t:s,currentLanguage:n}=(0,i.$G)(),o=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=o.current;if(e){e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("top","0","important"),e.style.setProperty("left","0","important"),e.style.setProperty("right","0","important"),e.style.setProperty("bottom","0","important"),e.style.setProperty("background-color","rgba(0, 0, 0, 0.5)","important"),e.style.setProperty("backdrop-filter","blur(2px)","important"),e.style.setProperty("display","flex","important"),e.style.setProperty("align-items","center","important"),e.style.setProperty("justify-content","center","important"),e.style.setProperty("padding","16px","important"),e.style.setProperty("animation","fadeIn 0.2s ease-out","important");const t=e.querySelector(".bg-white");t&&(t.style.setProperty("width","95vw","important"),t.style.setProperty("max-width","700px","important"),t.style.setProperty("max-height","85vh","important"),t.style.setProperty("min-width","320px","important"),t.style.setProperty("animation","modalSlideIn 0.3s ease-out","important"))}}),[]);const l=(()=>{const e="https://intelia.com";switch(n){case"fr":return"".concat(e,"/fr/");case"es":return"".concat(e,"/es/");default:return e}})();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z(),{id:"8d2cb29686f6a58a",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}"}),(0,a.jsx)("div",{ref:o,onClick:t,className:"jsx-8d2cb29686f6a58a fixed inset-0 z-50",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-8d2cb29686f6a58a bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"jsx-8d2cb29686f6a58a text-xl font-semibold text-gray-900",children:s("nav.contact")}),(0,a.jsx)("button",{onClick:t,"aria-label":s("modal.close"),title:s("modal.close"),className:"jsx-8d2cb29686f6a58a text-gray-400 hover:text-gray-600 text-2xl transition-colors hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a p-6",children:(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a space-y-4",children:[(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-start space-x-4 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-6 h-6 text-white",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z",className:"jsx-8d2cb29686f6a58a"})})}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex-1",children:[(0,a.jsx)("h3",{className:"jsx-8d2cb29686f6a58a font-semibold text-gray-900 mb-1",children:s("contact.phone")}),(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-sm text-gray-600 mb-2",children:s("contact.phoneDescription")}),(0,a.jsx)("a",{href:"tel:+18666666221",className:"jsx-8d2cb29686f6a58a text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors",children:"+1 (866) 666 6221"})]})]}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-start space-x-4 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-6 h-6 text-white",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75",className:"jsx-8d2cb29686f6a58a"})})}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex-1",children:[(0,a.jsx)("h3",{className:"jsx-8d2cb29686f6a58a font-semibold text-gray-900 mb-1",children:s("contact.email")}),(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-sm text-gray-600 mb-2",children:s("contact.emailDescription")}),(0,a.jsx)("a",{href:"mailto:support@intelia.com",className:"jsx-8d2cb29686f6a58a text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors",children:"support@intelia.com"})]})]}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-start space-x-4 p-3 hover:bg-gray-50 rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a w-12 h-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-6 h-6 text-white",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3s-4.5 4.03-4.5 9 2.015 9 4.5 9zm0 0c-2.485 0-4.5-4.03-4.5-9S9.515 3 12 3s4.5 4.03 4.5 9-2.015 9-4.5 9z",className:"jsx-8d2cb29686f6a58a"})})}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex-1",children:[(0,a.jsx)("h3",{className:"jsx-8d2cb29686f6a58a font-semibold text-gray-900 mb-1",children:s("contact.website")}),(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-sm text-gray-600 mb-2",children:s("contact.websiteDescription")}),(0,a.jsx)("a",{href:l,target:"_blank",rel:"noopener noreferrer",className:"jsx-8d2cb29686f6a58a text-blue-600 hover:text-blue-700 font-medium text-sm transition-colors",children:l})]})]}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a flex justify-end pt-3",children:(0,a.jsx)("button",{onClick:t,className:"jsx-8d2cb29686f6a58a px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:s("modal.close")})})]})})]})})]})},Q=e=>{let{onClose:t}=e;const{t:s,changeLanguage:n,currentLanguage:l}=(0,i.$G)(),{updateProfile:c}=(0,o.useAuthStore)(),[d,u]=(0,r.useState)(!1),m=(0,r.useRef)(null),p=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=m.current;if(e){e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("top","0","important"),e.style.setProperty("left","0","important"),e.style.setProperty("right","0","important"),e.style.setProperty("bottom","0","important"),e.style.setProperty("background-color","rgba(0, 0, 0, 0.5)","important"),e.style.setProperty("backdrop-filter","blur(2px)","important"),e.style.setProperty("animation","fadeIn 0.2s ease-out","important"),e.style.setProperty("display","flex","important"),e.style.setProperty("align-items","center","important"),e.style.setProperty("justify-content","center","important"),e.style.setProperty("padding","16px","important");const t=e.querySelector(".modal-content");t&&(t.style.setProperty("animation","modalSlideIn 0.3s ease-out","important"),t.style.setProperty("width","95vw","important"),t.style.setProperty("max-width","800px","important"),t.style.setProperty("max-height","85vh","important"),t.style.setProperty("min-width","320px","important"),t.style.setProperty("background-color","white","important"))}}),[]);const g=(0,i.Ik)(l);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z(),{id:"48f42c3ef862f813",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}.modal-content.jsx-48f42c3ef862f813{background-color:white!important}"}),(0,a.jsx)("div",{ref:m,style:{backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(2px)"},onClick:e=>{e.target!==e.currentTarget||d||t()},className:"jsx-48f42c3ef862f813 fixed inset-0 z-50",children:(0,a.jsx)("div",{ref:p,style:{backgroundColor:"white"},className:"jsx-48f42c3ef862f813 modal-content bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 p-6",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"jsx-48f42c3ef862f813 text-2xl font-bold text-gray-900",children:s("language.title")}),(0,a.jsx)("button",{onClick:t,disabled:d,"aria-label":s("modal.close"),title:s("modal.close"),className:"jsx-48f42c3ef862f813 text-gray-400 hover:text-gray-600 transition-colors hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center",children:(0,a.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-48f42c3ef862f813 w-6 h-6",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12",className:"jsx-48f42c3ef862f813"})})})]}),(0,a.jsx)("p",{className:"jsx-48f42c3ef862f813 text-gray-600 mb-6",children:s("language.description")}),g&&(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 mb-6 p-4 bg-blue-50 rounded-lg border border-blue-200",children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center",children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 text-2xl mr-3",children:g.flag}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 font-semibold text-blue-900",children:[s("language.current"),": ",g.nativeName]}),(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 text-sm font-bold text-gray-500",children:g.code.toUpperCase()})]})]})}),d&&(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 mb-4 p-3 bg-blue-50 border-l-4 border-blue-400 text-blue-700",children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center",children:[(0,a.jsxs)("svg",{fill:"none",viewBox:"0 0 24 24",className:"jsx-48f42c3ef862f813 animate-spin h-5 w-5 mr-2",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"jsx-48f42c3ef862f813 opacity-25"}),(0,a.jsx)("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z",className:"jsx-48f42c3ef862f813 opacity-75"})]}),(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813",children:s("language.updating")})]})}),(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:i.mT.map((e=>(0,a.jsx)("div",{onClick:()=>!d&&(async e=>{if(e!==l&&!d){u(!0);try{console.log("[LanguageModal] Changement langue:",l,"\u2192",e),await n(e),console.log("[LanguageModal] Interface mise \xe0 jour");{const t={state:{currentLanguage:e},version:0};localStorage.setItem("intelia-language",JSON.stringify(t)),console.log("[LanguageModal] localStorage sauvegard\xe9:",e),setTimeout((()=>{window.location.reload()}),100)}window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}})),window.i18nDebug&&window.i18nDebug.notificationManager.notify(),t(),console.log("[LanguageModal] Modal ferm\xe9e")}catch(s){console.error("[LanguageModal] Erreur changement:",s)}finally{setTimeout((()=>{u(!1)}),300)}}})(e.code),style:{backgroundColor:l===e.code?"#eff6ff":"white"},className:"jsx-48f42c3ef862f813 "+"\n                    relative p-4 rounded-lg border-2 cursor-pointer transition-all duration-200 hover:shadow-md\n                    ".concat(l===e.code?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 hover:border-blue-300 bg-white","\n                    ").concat(d?"opacity-50 cursor-not-allowed":"hover:bg-blue-50","\n                  "),children:(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813 flex items-center space-x-3",children:[(0,a.jsx)("span",{className:"jsx-48f42c3ef862f813 text-2xl",children:e.flag}),(0,a.jsxs)("div",{className:"jsx-48f42c3ef862f813",children:[(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 font-semibold text-gray-900 text-sm",children:e.nativeName}),(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 text-sm font-bold text-gray-500 mt-1",children:e.code.toUpperCase()})]})]}),l===e.code&&(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 flex items-center text-blue-600",children:(0,a.jsx)(L,{className:"w-5 h-5"})})]})},e.code)))}),(0,a.jsx)("div",{className:"jsx-48f42c3ef862f813 mt-8 flex justify-end space-x-3",children:(0,a.jsx)("button",{onClick:t,disabled:d,className:"jsx-48f42c3ef862f813 px-4 py-2 text-gray-600 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:s("modal.close")})})]})})})]})};var Z=s(8225),Y=s(257);const K={async sendInvitation(e,t,s){try{console.log("\ud83d\udce7 [InvitationService] Envoi invitation:",{emails:e,hasMessage:!!t,inviterEmail:s.email});const r=(0,Z.getSupabaseClient)(),{data:n,error:o}=await r.auth.getSession();if(o)throw console.error("\u274c [InvitationService] Erreur session:",o),new Error("Session expir\xe9e - reconnexion n\xe9cessaire");const i=n.session;if(!(null===i||void 0===i?void 0:i.access_token))throw new Error("Session expir\xe9e - reconnexion n\xe9cessaire");console.log("\u2705 [InvitationService] Service initialized");const l=(Y.env.NEXT_PUBLIC_API_BASE_URL||"https://expert.intelia.com/api").replace(/\/api\/?$/,""),c="".concat(l,"/api/v1/invitations/send");console.log("\ud83c\udf10 [InvitationService] URL d'envoi:",c);const d={"Content-Type":"application/json; charset=utf-8",Accept:"application/json",Authorization:"Bearer ".concat(i.access_token)};console.log("\ud83d\udce6 [InvitationService] Headers pr\xe9par\xe9s:",{...d,Authorization:"[HIDDEN]"});const u={emails:e,personal_message:t,inviter_name:s.name,inviter_email:s.email,language:s.language||"fr",force_send:!1};console.log("\ud83d\udccb [InvitationService] Corps de la requ\xeate:",u);const m=await fetch(c,{method:"POST",headers:d,body:JSON.stringify(u)});if(console.log("\ud83d\udce1 [InvitationService] R\xe9ponse re\xe7ue:",{status:m.status,statusText:m.statusText,ok:m.ok}),!m.ok){const e=await m.text();if(console.error("\u274c [InvitationService] Erreur HTTP:",m.status,e),401===m.status)throw await r.auth.signOut(),window.location.href="/",new Error("Session expir\xe9e. Redirection vers la connexion...");let t="Erreur lors de l'envoi des invitations";try{const s=JSON.parse(e);t=s.detail||s.message||t}catch(a){}throw new Error(t)}const p=await m.json();return console.log("\u2705 [InvitationService] Invitations trait\xe9es:",p),p}catch(r){throw console.error("\u274c [InvitationService] Erreur envoi:",r),r}}},ee=e=>{let{onClose:t}=e;const{t:s}=(0,i.$G)(),{user:n}=(0,o.useAuthStore)(),[l,c]=(0,r.useState)(""),[d,u]=(0,r.useState)(""),[m,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)([]),[h,v]=(0,r.useState)(null),x=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=x.current;if(e){e.style.setProperty("width","100vw","important"),e.style.setProperty("height","100vh","important"),e.style.setProperty("top","0","important"),e.style.setProperty("left","0","important"),e.style.setProperty("right","0","important"),e.style.setProperty("bottom","0","important"),e.style.setProperty("background-color","rgba(0, 0, 0, 0.5)","important"),e.style.setProperty("backdrop-filter","blur(2px)","important"),e.style.setProperty("animation","fadeIn 0.2s ease-out","important"),e.style.setProperty("display","flex","important"),e.style.setProperty("align-items","center","important"),e.style.setProperty("justify-content","center","important"),e.style.setProperty("padding","16px","important");const t=e.querySelector(".bg-white");t&&(t.style.setProperty("width","95vw","important"),t.style.setProperty("max-width","700px","important"),t.style.setProperty("max-height","85vh","important"),t.style.setProperty("min-width","320px","important"),t.style.setProperty("animation","modalSlideIn 0.3s ease-out","important"))}}),[]);const b=(0,r.useMemo)((()=>{if(null===n||void 0===n?void 0:n.email)return n;try{const s=localStorage.getItem("supabase.auth.token")||sessionStorage.getItem("supabase.auth.token");if(s){var e;const r=JSON.parse(s);if(null===(e=r.user)||void 0===e?void 0:e.email){var t,a;const e=(null===(t=r.user.user_metadata)||void 0===t?void 0:t.language)||r.user.language||localStorage.getItem("intelia_language")||localStorage.getItem("preferred_language")||(navigator.language.startsWith("en")?"en":navigator.language.startsWith("es")?"es":"fr");return{email:r.user.email,name:(null===(a=r.user.user_metadata)||void 0===a?void 0:a.name)||r.user.name||r.user.email.split("@")[0],id:r.user.id,language:e}}}}catch(r){console.warn(s("invite.authRetrievalError"),r)}return null}),[n,s]);(0,r.useEffect)((()=>{(null===b||void 0===b?void 0:b.email)?f([]):f([s("invite.loginRequired")])}),[b,s]);const y=e=>{const t=e.split(",").map((e=>e.trim())).filter((e=>e.length>0)),s=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=[],r=[];return t.forEach((e=>{s.test(e)?a.push(e):r.push(e)})),{valid:a,invalid:r}},w=()=>{const{valid:e}=y(l);return e.length},j=e=>{if("sent"===e.status)return"".concat(s("invite.invitationSent"),": ").concat(e.email);if("skipped"===e.status){if("user_exists"===e.reason){var t;if(null===(t=e.details)||void 0===t?void 0:t.registered_since){const t=new Date(e.details.registered_since).toLocaleDateString("fr-FR");return"".concat(s("invite.userExistsWithDate"),": ").concat(e.email," (").concat(t,")")}return"".concat(s("invite.userExists"),": ").concat(e.email)}if("already_invited_by_you"===e.reason)return"".concat(s("invite.alreadyInvitedByYou"),": ").concat(e.email);if("already_invited_by_other"===e.reason)return"".concat(s("invite.alreadyInvitedByOther"),": ").concat(e.email)}var a,r;return"failed"===e.status?(null===(a=e.reason)||void 0===a?void 0:a.includes("Invalid email"))?"".concat(s("invite.invalidEmail"),": ").concat(e.email):(null===(r=e.reason)||void 0===r?void 0:r.includes("rate limit"))?s("invite.rateLimit"):"".concat(s("invite.sendFailed"),": ").concat(e.email):e.message};return(null===b||void 0===b?void 0:b.email)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z(),{id:"8d2cb29686f6a58a",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}"}),(0,a.jsx)("div",{ref:x,onClick:t,className:"jsx-8d2cb29686f6a58a fixed inset-0 z-50",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-8d2cb29686f6a58a bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"jsx-8d2cb29686f6a58a text-xl font-semibold text-gray-900",children:s("nav.inviteFriend")}),(0,a.jsx)("button",{onClick:t,"aria-label":s("modal.close"),title:s("modal.close"),className:"jsx-8d2cb29686f6a58a text-gray-400 hover:text-gray-600 text-2xl transition-colors hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a p-6",children:(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a text-center",children:[(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-8 h-8 text-blue-600",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z",className:"jsx-8d2cb29686f6a58a"})})}),(0,a.jsx)("h2",{className:"jsx-8d2cb29686f6a58a text-xl font-semibold text-gray-900 mb-2",children:s("invite.title")}),(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-sm text-gray-600",children:s("invite.subtitle")})]}),h&&(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a space-y-4",children:[(0,a.jsx)("h3",{className:"jsx-8d2cb29686f6a58a text-lg font-semibold text-gray-900 mb-4",children:s("invite.sendStatus")}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a space-y-3",children:h.results.map(((e,t)=>{var r;return(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a "+"p-4 rounded-lg border-l-4 ".concat(e.success&&"sent"===e.status?"bg-green-50 border-green-400":"skipped"===e.status?"bg-blue-50 border-blue-400":"bg-red-50 border-red-400"),children:(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex items-start space-x-3",children:[(0,a.jsx)("span",{className:"jsx-8d2cb29686f6a58a text-2xl mt-1",children:e.success&&"sent"===e.status?"\u2705":"skipped"===e.status?"\ud83d\udc64":"\u274c"}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex-1",children:[(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-sm text-gray-800 font-medium",children:j(e)}),(null===(r=e.details)||void 0===r?void 0:r.last_login)&&(0,a.jsxs)("p",{className:"jsx-8d2cb29686f6a58a text-xs text-gray-500 mt-1",children:[s("invite.lastLogin"),": ",new Date(e.details.last_login).toLocaleDateString("fr-FR")]})]})]})},t)}))}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex space-x-3 mt-6",children:[(0,a.jsx)("button",{onClick:()=>{v(null),c(""),u("")},className:"jsx-8d2cb29686f6a58a flex-1 bg-gray-100 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-200 transition-colors",children:s("invite.inviteOthers")}),(0,a.jsx)("button",{onClick:t,className:"jsx-8d2cb29686f6a58a flex-1 bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:s("modal.close")})]})]}),g.length>0&&(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a bg-red-50 border border-red-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a text-red-800",children:[(0,a.jsxs)("p",{className:"jsx-8d2cb29686f6a58a font-medium mb-2 flex items-center",children:[(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-5 h-5 mr-2",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",className:"jsx-8d2cb29686f6a58a"})}),s("invite.validationError")]}),(0,a.jsx)("ul",{className:"jsx-8d2cb29686f6a58a list-disc list-inside space-y-1 text-sm",children:g.map(((e,t)=>(0,a.jsx)("li",{className:"jsx-8d2cb29686f6a58a",children:e},t)))})]})}),!h&&(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a space-y-6",children:[(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a",children:[(0,a.jsxs)("label",{className:"jsx-8d2cb29686f6a58a block text-sm font-medium text-gray-900 mb-2",children:[s("invite.emailAddresses"),w()>0&&(0,a.jsxs)("span",{className:"jsx-8d2cb29686f6a58a ml-2 text-blue-600 font-normal",children:["(","".concat(s("invite.recipientCount"),": ").concat(w()),")"]})]}),(0,a.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),placeholder:s("invite.emailPlaceholder"),style:{fontSize:"16px",backgroundColor:"white",color:"#111827",lineHeight:"1.5"},rows:3,disabled:m,className:"jsx-8d2cb29686f6a58a w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-xs text-gray-500 mt-1",children:s("invite.emailHelp")})]}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a",children:[(0,a.jsxs)("label",{className:"jsx-8d2cb29686f6a58a block text-sm font-medium text-gray-900 mb-2",children:[s("invite.personalMessage"),(0,a.jsxs)("span",{className:"jsx-8d2cb29686f6a58a text-gray-500 font-normal",children:["(",s("invite.optional"),")"]})]}),(0,a.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:s("invite.messagePlaceholder"),style:{fontSize:"16px",backgroundColor:"white",color:"#111827",lineHeight:"1.5"},rows:4,maxLength:500,disabled:m,className:"jsx-8d2cb29686f6a58a w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),(0,a.jsxs)("div",{className:"jsx-8d2cb29686f6a58a flex justify-between items-center mt-1",children:[(0,a.jsx)("p",{className:"jsx-8d2cb29686f6a58a text-xs text-gray-500",children:s("invite.messageHelp")}),(0,a.jsxs)("span",{className:"jsx-8d2cb29686f6a58a text-xs text-gray-400",children:[d.length,"/500"]})]})]})]}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a flex justify-end space-x-3 pt-4 border-t border-gray-200",children:!h&&(0,a.jsx)("button",{onClick:()=>{console.log('\ud83d\uddb1\ufe0f [InviteFriendModal] Bouton "Envoyer" cliqu\xe9 depuis onClick'),(async()=>{if(console.log('\ud83d\uddb1\ufe0f [InviteFriendModal] Bouton "Envoyer" cliqu\xe9'),console.log("\ud83d\udcca [InviteFriendModal] \xc9tat initial:",{isLoading:m,emailsLength:l.length,hasCurrentUser:!!(null===b||void 0===b?void 0:b.email)}),f([]),v(null),!(null===b||void 0===b?void 0:b.email))return console.log("\u274c [InviteFriendModal] Pas d'utilisateur connect\xe9"),void f([s("invite.loginRequired")]);if(!l.trim())return console.log("\u274c [InviteFriendModal] Pas d'emails fournis"),void f([s("invite.emailRequired")]);const{valid:e,invalid:t}=y(l);if(console.log("\ud83d\udce7 [InviteFriendModal] Validation emails:",{valid:e,invalid:t}),t.length>0)return console.log("\u274c [InviteFriendModal] Emails invalides d\xe9tect\xe9s:",t),void f(["".concat(s("invite.invalidEmails"),": ").concat(t.join(", ")),s("invite.emailFormat")]);if(0===e.length)return console.log("\u274c [InviteFriendModal] Aucun email valide"),void f([s("invite.noValidEmails")]);if(e.length>10)return console.log("\u274c [InviteFriendModal] Trop d'emails:",e.length),void f([s("invite.maxLimit")]);p(!0),console.log("\ud83d\udd04 [InviteFriendModal] D\xe9but du processus d'envoi");try{var a;console.log("\ud83d\ude80 [InviteFriendModal] D\xe9but envoi invitations:",{emails:e,userEmail:b.email,userName:b.name});const t={name:b.name||(null===(a=b.email)||void 0===a?void 0:a.split("@")[0])||"Utilisateur Intelia",email:b.email,language:b.language||"fr"};console.log("\ud83d\udc64 [InviteFriendModal] Informations de l'inviteur:",t);const s=await K.sendInvitation(e,d.trim(),t);console.log("\u2705 [InviteFriendModal] R\xe9sultat re\xe7u:",s),v(s)}catch(r){console.error("\u274c [InviteFriendModal] Erreur envoi:",r);let e=s("invite.sendError");r instanceof Error&&(e=r.message),console.log("\ud83d\udd0d [InviteFriendModal] Analyse de l'erreur:",e),e.includes("403")||e.includes("Forbidden")?f([s("invite.authError"),s("invite.reconnectSuggestion")]):e.includes("401")||e.includes("Unauthorized")?f([s("invite.sessionExpired"),s("invite.sessionExpiredDetail")]):f([e,s("invite.retryOrContact")])}finally{p(!1),console.log("\ud83c\udfc1 [InviteFriendModal] Fin du processus d'envoi")}})()},disabled:m||0===w(),className:"jsx-8d2cb29686f6a58a px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors font-medium flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{className:"jsx-8d2cb29686f6a58a",children:s("invite.sending")})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-8d2cb29686f6a58a w-4 h-4",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5",className:"jsx-8d2cb29686f6a58a"})}),(0,a.jsxs)("span",{className:"jsx-8d2cb29686f6a58a",children:[s("invite.send")," ",w()>0?"(".concat(w(),")"):""]})]})})}),(0,a.jsx)("div",{className:"jsx-8d2cb29686f6a58a text-xs text-gray-500 text-center pt-2 border-t border-gray-100",children:s("invite.footerInfo")})]})})]})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(z(),{id:"5cca0a69e4d97812",children:"@-webkit-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-moz-keyframes fadeIn{from{opacity:0}to{opacity:1}}@-o-keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@-webkit-keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-moz-keyframes modalSlideIn{from{opacity:0;-moz-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-moz-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@-o-keyframes modalSlideIn{from{opacity:0;-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}@keyframes modalSlideIn{from{opacity:0;-webkit-transform:translatey(-20px)scale(.95);-moz-transform:translatey(-20px)scale(.95);-o-transform:translatey(-20px)scale(.95);transform:translatey(-20px)scale(.95)}to{opacity:1;-webkit-transform:translatey(0)scale(1);-moz-transform:translatey(0)scale(1);-o-transform:translatey(0)scale(1);transform:translatey(0)scale(1)}}"}),(0,a.jsx)("div",{ref:x,onClick:t,className:"jsx-5cca0a69e4d97812 fixed inset-0 z-50",children:(0,a.jsxs)("div",{onClick:e=>e.stopPropagation(),className:"jsx-5cca0a69e4d97812 bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"jsx-5cca0a69e4d97812 flex items-center justify-between p-6 border-b border-gray-200",children:[(0,a.jsx)("h2",{className:"jsx-5cca0a69e4d97812 text-xl font-semibold text-gray-900",children:s("nav.inviteFriend")}),(0,a.jsx)("button",{onClick:t,"aria-label":s("modal.close"),title:s("modal.close"),className:"jsx-5cca0a69e4d97812 text-gray-400 hover:text-gray-600 text-2xl transition-colors hover:bg-gray-100 rounded-full w-8 h-8 flex items-center justify-center",children:"\xd7"})]}),(0,a.jsx)("div",{className:"jsx-5cca0a69e4d97812 p-6",children:(0,a.jsxs)("div",{className:"jsx-5cca0a69e4d97812 text-center",children:[(0,a.jsx)("div",{className:"jsx-5cca0a69e4d97812 w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("svg",{fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"jsx-5cca0a69e4d97812 w-8 h-8 text-red-600",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z",className:"jsx-5cca0a69e4d97812"})})}),(0,a.jsx)("h2",{className:"jsx-5cca0a69e4d97812 text-xl font-semibold text-gray-900 mb-2",children:s("invite.loginRequiredTitle")}),(0,a.jsx)("p",{className:"jsx-5cca0a69e4d97812 text-sm text-gray-600 mb-4",children:s("invite.loginRequired")}),(0,a.jsx)("button",{onClick:t,className:"jsx-5cca0a69e4d97812 px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2",children:s("modal.close")})]})})]})})]})},te=r.memo((()=>{(0,T.useRouter)();const{user:e}=(0,o.useAuthStore)(),{t:t}=(0,i.$G)(),[s,n]=(0,r.useState)(!1),[l,c]=(0,r.useState)(!1),[d,u]=(0,r.useState)(!1),[m,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)(!1),[h,v]=(0,r.useState)(!1),x=(0,r.useRef)(!0),b=(0,r.useRef)(!1);(0,r.useEffect)((()=>(x.current=!0,()=>{console.log(t("userMenu.debug.unmounting")),x.current=!1})),[t]);const y=(0,r.useCallback)((e=>{if(!e)return"U";if(e.name&&e.name.includes("@")){const t=e.name.split("@")[0];if(t.includes(".")){const e=t.split(".");return(e[0][0]+e[1][0]).toUpperCase()}return t.substring(0,2).toUpperCase()}if(e.name){const t=e.name.trim().split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():t[0][0].toUpperCase()}if(e.email){const t=e.email.split("@")[0];if(t.includes(".")){const e=t.split(".");return(e[0][0]+e[1][0]).toUpperCase()}return t.substring(0,2).toUpperCase()}return"U"}),[]),w=(0,r.useMemo)((()=>y(e)),[null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.email,y]);(0,r.useEffect)((()=>{((null===e||void 0===e?void 0:e.name)||(null===e||void 0===e?void 0:e.email))&&console.log("UserMenu user data:",{user_name:null===e||void 0===e?void 0:e.name,user_email:null===e||void 0===e?void 0:e.email,calculated_initials:y(e),has_name:!!(null===e||void 0===e?void 0:e.name)})}),[null===e||void 0===e?void 0:e.name,null===e||void 0===e?void 0:e.email,y]);const{currentPlan:j,plan:k,isSuperAdmin:N}=(0,r.useMemo)((()=>{const t=(null===e||void 0===e?void 0:e.plan)||"essential";return{currentPlan:t,plan:U[t]||U.essential,isSuperAdmin:"super_admin"===(null===e||void 0===e?void 0:e.user_type)}}),[null===e||void 0===e?void 0:e.plan,null===e||void 0===e?void 0:e.user_type]),C=(0,r.useMemo)((()=>(null===e||void 0===e?void 0:e.id)?{id:e.id,email:e.email,name:e.name,firstName:e.firstName,lastName:e.lastName,phone:e.phone,country:e.country,linkedinProfile:e.linkedinProfile,companyName:e.companyName,companyWebsite:e.companyWebsite,linkedinCorporate:e.linkedinCorporate,user_type:e.user_type,language:e.language,created_at:e.created_at,plan:e.plan,country_code:e.country_code,area_code:e.area_code,phone_number:e.phone_number,full_name:e.full_name,avatar_url:e.avatar_url,consent_given:e.consent_given,consent_date:e.consent_date,updated_at:e.updated_at,user_id:e.user_id,profile_id:e.profile_id,preferences:e.preferences,is_admin:e.is_admin}:e),[null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.firstName,null===e||void 0===e?void 0:e.lastName,null===e||void 0===e?void 0:e.phone,null===e||void 0===e?void 0:e.country,null===e||void 0===e?void 0:e.linkedinProfile,null===e||void 0===e?void 0:e.companyName,null===e||void 0===e?void 0:e.companyWebsite,null===e||void 0===e?void 0:e.linkedinCorporate,null===e||void 0===e?void 0:e.country_code,null===e||void 0===e?void 0:e.area_code,null===e||void 0===e?void 0:e.phone_number]),S=(0,r.useCallback)((async()=>{if(!b.current&&x.current)try{console.log(t("userMenu.debug.logoutViaService")),b.current=!0,n(!1),await M.performLogout(e)}catch(s){console.error(t("userMenu.debug.logoutServiceError"),s),window.location.href="/"}}),[t,e]),_=(0,r.useCallback)((()=>{x.current&&(n(!1),setTimeout((()=>{x.current&&p(!0)}),50))}),[]),E=(0,r.useCallback)((()=>{x.current&&(n(!1),setTimeout((()=>{x.current&&c(!0)}),50))}),[]),L=(0,r.useCallback)((()=>{x.current&&(n(!1),setTimeout((()=>{x.current&&u(!0)}),50))}),[]),I=(0,r.useCallback)((()=>{x.current&&(n(!1),setTimeout((()=>{x.current&&f(!0)}),50))}),[]),P=(0,r.useCallback)((()=>{x.current&&(n(!1),setTimeout((()=>{x.current&&v(!0)}),50))}),[]),A=(0,r.useCallback)((()=>{x.current&&(n(!1),window.open("/admin/statistics","_blank"))}),[]),D=(0,r.useCallback)((()=>{window.open("https://intelia.com/privacy-policy/","_blank")}),[]),R=(0,r.useCallback)((()=>{x.current&&(console.log(t("userMenu.debug.toggleOpen"),x.current,t("userMenu.debug.currentIsOpen"),s),n((e=>!e)))}),[s,t]),O=(0,r.useCallback)((()=>{x.current&&n(!1)}),[]),z=(0,r.useCallback)((()=>{x.current&&c(!1)}),[]),F=(0,r.useCallback)((()=>{x.current&&u(!1)}),[]),q=(0,r.useCallback)((()=>{x.current&&p(!1)}),[]),B=(0,r.useCallback)((()=>{x.current&&f(!1)}),[]),H=(0,r.useCallback)((()=>{x.current&&v(!1)}),[]);return e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:R,className:"w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center hover:bg-blue-700 transition-colors",title:t("userMenu.openMenu"),"aria-label":t("userMenu.openMenu"),children:(0,a.jsx)("span",{className:"text-white text-xs font-medium",children:w})}),s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:O}),(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50",children:[(0,a.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null===e||void 0===e?void 0:e.name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null===e||void 0===e?void 0:e.email}),(null===e||void 0===e?void 0:e.user_type)&&(0,a.jsxs)("div",{className:"mt-2",children:[!N&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat(k.bgColor," ").concat(k.color," border ").concat(k.borderColor),children:k.name}),N&&(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 border border-red-300",children:t("userMenu.superAdmin")})]})]}),(0,a.jsxs)("div",{className:"py-1",children:[N&&(0,a.jsxs)("button",{onClick:A,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"})}),(0,a.jsx)("span",{children:t("nav.statistics")})]}),!N&&(0,a.jsxs)("button",{onClick:L,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"})}),(0,a.jsx)("span",{children:t("subscription.title")})]}),(0,a.jsxs)("button",{onClick:E,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"})}),(0,a.jsx)("span",{children:t("nav.profile")})]}),(0,a.jsxs)("button",{onClick:I,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m10.5 21 5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 0 1 6-.371m0 0c1.12 0 2.233.038 3.334.114M9 5.25V3m3.334 2.364C11.176 10.658 7.69 15.08 3 17.502m9.334-12.138c.896.061 1.785.147 2.666.257m-4.589 8.495a18.023 18.023 0 0 1-3.827-5.802"})}),(0,a.jsx)("span",{children:t("nav.language")})]}),(0,a.jsxs)("button",{onClick:P,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM3 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 019.374 21c-2.331 0-4.512-.645-6.374-1.766z"})}),(0,a.jsx)("span",{children:t("nav.inviteFriend")})]}),(0,a.jsxs)("button",{onClick:_,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z"})}),(0,a.jsx)("span",{children:t("nav.contact")})]}),(0,a.jsxs)("button",{onClick:D,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-600",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25M16.5 7.5V18a2.25 2.25 0 002.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875v12.75c0 .621.504 1.125 1.125 1.125h2.25"})}),(0,a.jsx)("span",{children:t("nav.legal")})]})]}),(0,a.jsx)("div",{className:"border-t border-gray-100 pt-1",children:(0,a.jsxs)("button",{onClick:S,className:"w-full flex items-center space-x-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75"})}),(0,a.jsx)("span",{children:t("nav.logout")})]})})]})]})]}),!N&&d&&(0,a.jsx)(J,{user:e,onClose:F}),l&&(0,a.jsx)(V,{user:C,onClose:z}),g&&(0,a.jsx)(Q,{onClose:B}),m&&(0,a.jsx)(X,{onClose:q}),h&&(0,a.jsx)(ee,{onClose:H})]}):null}));te.displayName="UserMenuButton";const se=e=>{let{user:t}=e;return null},ae=e=>{let{isOpen:t,onClose:s,onSubmit:n,feedbackType:o,isSubmitting:l=!1}=e;const{t:c}=(0,i.$G)(),[d,u]=(0,r.useState)(""),[m,p]=(0,r.useState)(!1);if(!t)return null;const g=()=>{u(""),s()},f="positive"===o,h=c(f?"feedback.positiveTitle":"feedback.negativeTitle"),v=c(f?"feedback.positivePlaceholder":"feedback.negativePlaceholder");return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:g}),(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,a.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl max-w-md w-full mx-4",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"p-6 pb-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[f?(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-green-600",children:(0,a.jsx)(N,{})})}):(0,a.jsx)("div",{className:"w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-red-600",children:(0,a.jsx)(C,{})})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:h})]}),(0,a.jsx)("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",disabled:m,"aria-label":c("modal.close"),title:c("modal.close"),children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:c("feedback.description")}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("textarea",{value:d,onChange:e=>u(e.target.value),placeholder:v,rows:4,maxLength:500,className:"w-full px-4 py-3 border-2 border-blue-200 rounded-xl focus:border-blue-500 focus:ring-0 outline-none resize-none text-sm placeholder-gray-400 transition-colors",disabled:m}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"".concat(c("feedback.characterCount"),": ").concat(d.length,"/500")}),d.length>450&&(0,a.jsx)("div",{className:"text-xs text-orange-500",children:c("feedback.limitWarning")})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("p",{className:"text-xs text-gray-500 leading-relaxed",children:[c("feedback.privacyNotice")," ",(0,a.jsx)("button",{type:"button",className:"text-blue-600 hover:text-blue-700 underline font-medium",onClick:()=>window.open("https://intelia.com/privacy-policy/","_blank"),children:c("feedback.learnMore")})]})})]}),(0,a.jsx)("div",{className:"px-6 py-4 bg-gray-50 rounded-b-2xl",children:(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:g,disabled:m,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed",children:c("modal.cancel")}),(0,a.jsx)("button",{onClick:async()=>{p(!0);try{await n(o,d.trim()||void 0),u(""),s()}catch(e){console.error(c("feedback.sendError"),e),u(""),s()}finally{p(!1)}},disabled:m,className:"px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2 min-w-[100px] justify-center",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("span",{children:c("feedback.sending")})]}):(0,a.jsx)("span",{children:c("feedback.send")})})]})})]})})]})},re=r.memo((e=>{let{inputMessage:t,setInputMessage:s,onSendMessage:n,isLoadingChat:o,clarificationState:i,isMobileDevice:l,inputRef:c,t:d}=e;const u=(0,r.useCallback)((e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())}),[n]),m=(0,r.useCallback)((e=>{s(e.target.value)}),[s]);return(0,a.jsxs)("div",{className:"flex items-center min-h-[48px] w-full ".concat(l?"mobile-input-container":"space-x-3"),children:[(0,a.jsx)("div",{className:"flex-1 ".concat(l?"mobile-input-wrapper":""),children:(0,a.jsx)("input",{ref:c,type:"text",value:t,onChange:m,onKeyDown:u,placeholder:d(i?"chat.clarificationPlaceholder":"chat.placeholder"),className:"w-full h-12 px-4 bg-gray-100 border-0 rounded-full focus:ring-2 focus:ring-blue-500 focus:bg-white outline-none text-sm flex items-center ".concat(l?"ios-input-fix":""),disabled:o,"aria-label":d("chat.placeholder"),style:{fontSize:l?"16px":"14px",WebkitAppearance:"none",borderRadius:l?"25px":"9999px"}})}),(0,a.jsx)("button",{onClick:n,disabled:o||!t.trim(),className:"flex-shrink-0 h-12 w-12 flex items-center justify-center text-blue-600 hover:text-blue-700 disabled:text-gray-300 transition-colors rounded-full hover:bg-blue-50 ".concat(l?"mobile-send-button":""),title:d(o?"chat.sending":"chat.send"),"aria-label":d(o?"chat.sending":"chat.send"),style:{minWidth:"48px",width:"48px",height:"48px"},children:(0,a.jsx)(j,{})})]})}));re.displayName="ChatInput";const ne=r.memo((e=>{let{processedMessages:t,isLoadingChat:s,handleFeedbackClick:o,getUserInitials:i,user:l,t:c}=e;const d=(0,r.useMemo)((()=>t.map(((e,t)=>(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-start space-x-3 min-w-0 ".concat(e.isUser?"justify-end":"justify-start"),children:[!e.isUser&&(0,a.jsx)("div",{className:"flex-shrink-0 w-10 h-10 grid place-items-center",children:(0,a.jsx)(_,{className:"h-8 w-auto"})}),(0,a.jsx)("div",{className:"px-3 sm:px-4 py-2 rounded-2xl max-w-[85%] sm:max-w-none break-words ".concat(e.isUser?"bg-blue-600 text-white ml-auto":"bg-white border border-gray-200 text-gray-900"),children:e.isUser?(0,a.jsx)("p",{className:"whitespace-pre-wrap leading-relaxed text-sm",children:e.content}):(0,a.jsx)(n.UG,{className:"prose prose-sm max-w-none break-words prose-p:my-3 prose-li:my-1 prose-ul:my-4 prose-strong:text-gray-900 prose-headings:font-bold prose-headings:text-gray-900",components:{h2:e=>{let{node:t,...s}=e;return(0,a.jsx)("h2",{className:"text-xl font-bold text-blue-900 mt-8 mb-6 border-b-2 border-blue-200 pb-3 bg-blue-50 px-4 py-2 rounded-t-lg",...s})},h3:e=>{let{node:t,...s}=e;return(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-800 mt-6 mb-4 border-l-4 border-blue-400 pl-4 bg-gray-50 py-2",...s})},p:e=>{let{node:t,...s}=e;return(0,a.jsx)("p",{className:"leading-relaxed text-gray-800 my-4 text-justify",...s})},ul:e=>{let{node:t,...s}=e;return(0,a.jsx)("ul",{className:"list-disc list-outside space-y-3 text-gray-800 my-6 ml-6 pl-2",...s})},li:e=>{let{node:t,...s}=e;return(0,a.jsx)("li",{className:"leading-relaxed pl-2 my-2",...s})},strong:e=>{let{node:t,...s}=e;return(0,a.jsx)("strong",{className:"font-bold text-blue-800 bg-blue-50 px-1 rounded",...s})},table:e=>{let{node:t,...s}=e;return(0,a.jsx)("div",{className:"overflow-x-auto my-6 -mx-1 sm:mx-0",children:(0,a.jsx)("table",{className:"min-w-full border border-gray-300 rounded-lg shadow-sm",...s})})},th:e=>{let{node:t,...s}=e;return(0,a.jsx)("th",{className:"border border-gray-300 px-4 py-3 bg-blue-100 font-bold text-left text-blue-900",...s})},td:e=>{let{node:t,...s}=e;return(0,a.jsx)("td",{className:"border border-gray-300 px-4 py-3 hover:bg-gray-50",...s})}},children:e.processedContent})}),!e.isUser&&t>0&&e.conversation_id&&(0,a.jsxs)("div",{className:"flex items-center space-x-2 mt-2 ml-2",children:[(0,a.jsx)("button",{onClick:()=>o(e.id,"positive"),className:"p-1.5 rounded-full hover:bg-gray-100 transition-colors ".concat("positive"===e.feedback?"text-green-600 bg-green-50":"text-gray-400"),title:c("chat.helpfulResponse"),"aria-label":c("chat.helpfulResponse"),children:(0,a.jsx)(N,{})}),(0,a.jsx)("button",{onClick:()=>o(e.id,"negative"),className:"p-1.5 rounded-full hover:bg-gray-100 transition-colors ".concat("negative"===e.feedback?"text-red-600 bg-red-50":"text-gray-400"),title:c("chat.notHelpfulResponse"),"aria-label":c("chat.notHelpfulResponse"),children:(0,a.jsx)(C,{})}),e.feedback&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:"text-xs text-gray-500",children:c("chat.feedbackThanks")}),e.feedbackComment&&(0,a.jsx)("span",{className:"text-xs text-blue-600",title:"".concat(c("chat.feedbackComment"),": ").concat(e.feedbackComment),children:"\ud83d\udcac"})]})]}),e.isUser&&(0,a.jsx)("div",{className:"w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0 mt-1",children:(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:i(l)})})]})},"".concat(e.id,"-").concat(t))))),[t,o,i,l,c]);return(0,a.jsxs)(a.Fragment,{children:[0===t.length?(0,a.jsx)("div",{className:"text-center text-gray-500 py-8",children:(0,a.jsx)("div",{className:"text-sm",children:c("chat.noMessages")})}):d,s&&(0,a.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 grid place-items-center flex-shrink-0",children:(0,a.jsx)(_,{className:"h-8 w-auto"})}),(0,a.jsx)("div",{className:"bg-white border border-gray-200 rounded-2xl px-3 sm:px-4 py-3 max-w-[85%] sm:max-w-none break-words",children:(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-500 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})]})]})}));function oe(){const{user:e,isAuthenticated:t,isLoading:s,hasHydrated:n}=(0,o.useAuthStore)(),{t:l,currentLanguage:c}=(0,i.$G)(),d=w((e=>e.currentConversation)),u=w((e=>e.setCurrentConversation)),m=w((e=>e.addMessage)),g=w((e=>e.updateMessage)),f=w((e=>e.createNewConversation)),h=w((e=>e.loadConversations)),[v,b]=(0,r.useState)(""),[y,j]=(0,r.useState)(!1),[N,C]=(0,r.useState)(!1),[S,L]=(0,r.useState)(!1),[I,T]=(0,r.useState)(0),[M,A]=(0,r.useState)(!0),[D,U]=(0,r.useState)(!1),[R,O]=(0,r.useState)(!1),[z,F]=(0,r.useState)(!1),[q,B]=(0,r.useState)(0),[H,W]=(0,r.useState)(null),[G,$]=(0,r.useState)({isOpen:!1,messageId:null,feedbackType:null}),V=(0,r.useRef)(null),J=(0,r.useRef)(null),X=(0,r.useRef)(0),Q=(0,r.useRef)(!0),Z=(0,r.useRef)(null),Y=(0,r.useRef)(!1),K=(0,r.useMemo)((()=>(null===d||void 0===d?void 0:d.messages)||[]),[null===d||void 0===d?void 0:d.messages]),ee=(0,r.useMemo)((()=>K.length>0),[K.length]),oe=(0,r.useCallback)((e=>{console.error("Auth error:",e)}),[]),ie=(0,r.useCallback)((e=>{if(!e)return"U";if(e.name){const t=e.name.trim().split(" ");return t.length>=2?(t[0][0]+t[t.length-1][0]).toUpperCase():t[0][0].toUpperCase()}if(e.email){const t=e.email.split("@")[0];if(t.includes(".")){const e=t.split(".");return(e[0][0]+e[1][0]).toUpperCase()}return t.substring(0,2).toUpperCase()}return"U"}),[]),le=(0,r.useCallback)((e=>{if(!e)return"";let t=e;return t=t.replace(/(#{1,6})\s*([^#\n]+?)([A-Z][a-z])/g,"$1 $2\n\n$3"),t=t.replace(/^(#{1,6}[^\n]+)(?!\n)/gm,"$1\n"),t=t.replace(/([a-z])([A-Z])/g,"$1, $2"),t=t.replace(/([.!?:])([A-Z])/g,"$1 $2"),t=t.replace(/([a-z])(\*\*[A-Z])/g,"$1 $2"),t=t.replace(/([.!?:])\s*(\*\*[^*]+\*\*)/g,"$1\n\n$2"),t=t.replace(/([.!?:])\s*-\s*([A-Z][^:]+:)/g,"$1\n\n### $2"),t=t.replace(/([.!?:])\s*-\s*([A-Z][^-]+)/g,"$1\n\n- $2"),t=t.replace(/([^.\n])\n([\u2022\-\*]\s)/g,"$1\n\n$2"),t=t.replace(/([\u2022\-\*]\s[^\n]+)\n([A-Z][^\u2022\-\*])/g,"$1\n\n$2"),t=t.replace(/(Causes Possibles|Recommandations|Pr\xe9vention|Court terme|Long terme|Imm\xe9diat)([^-:])/g,"\n\n### $1\n\n$2"),t=t.replace(/[ \t]+/g," "),t=t.replace(/\n\n\n+/g,"\n\n"),t=t.trim(),t}),[]),ce=(0,r.useCallback)((e=>{if(!e)return"";if(e.length<100)return e.trim();let t=e;return t=t.replace(/\*\*Source:\s*[^*]+\*\*/g,""),t=t.replace(/Source:\s*[^\n]+/g,""),t=t.replace(/protection, regardless of the species involved[^.]+\./g,""),t=t.replace(/^\d+\.\s+[A-Z][^:]+:\s*$/gm,""),t=t.replace(/^\w\.\s+[A-Z][^:]+:\s*$/gm,""),t=t.replace(/^INTRODUCTION[^\n]*$/gm,""),t=t.replace(/^[A-Z\s]{10,}:?\s*$/gm,""),t=t.replace(/Page\s+\d+\s+of\s+\d+/gi,""),t=t.replace(/\bDOI:\s*[^\s]+/gi,""),t=t.replace(/\s+/g," "),t=t.replace(/\n\s*\n\s*\n/g,"\n\n"),t=t.replace(/^\s*\n+/,""),t=t.replace(/\n+\s*$/,""),t.trim()}),[]),de=(0,r.useMemo)((()=>K.map((e=>({...e,processedContent:e.isUser?e.content:le(e.content)})))),[K,le]);(0,r.useEffect)((()=>(Q.current=!0,()=>{Q.current=!1,document.body.classList.remove("keyboard-open"),Y.current=!1})),[]),(0,r.useEffect)((()=>{if(!Q.current)return;const e=()=>{const e=navigator.userAgent.toLowerCase(),t=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(e),s=window.innerWidth<=1024,a="ontouchstart"in window||navigator.maxTouchPoints>0,r="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,n=window.innerWidth>1200&&navigator.maxTouchPoints>0&&!r;return(t||r||s&&a)&&!n};C(e());const t=()=>{Q.current&&C(e())};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)}),[]),(0,r.useEffect)((()=>{var e;if(!N||!Q.current)return;let t=(null===(e=window.visualViewport)||void 0===e?void 0:e.height)||window.innerHeight,s=!1;B(t);const a=()=>{if(!s&&Q.current&&window.visualViewport){const e=window.visualViewport.height,s=t-e;B(e),L(s>150),T(s>150?s:0),s>150?document.body.classList.add("keyboard-open"):document.body.classList.remove("keyboard-open")}};return window.visualViewport&&window.visualViewport.addEventListener("resize",a),()=>{s=!0,window.visualViewport&&window.visualViewport.removeEventListener("resize",a),document.body.classList.remove("keyboard-open")}}),[N]),(0,r.useEffect)((()=>{if(Q.current){if(K.length>X.current&&M&&!D){const e=setTimeout((()=>{Q.current&&V.current&&V.current.scrollIntoView({behavior:"smooth"})}),100);return()=>clearTimeout(e)}X.current=K.length}}),[K.length,M,D]),(0,r.useEffect)((()=>{const e=J.current;if(!e||!Q.current)return;let t,s=!1,a=!1;const r=()=>{if(!Q.current||a)return;const{scrollTop:r,scrollHeight:n,clientHeight:o}=e,i=Math.abs(n-r-o)<50,l=n-r-o<100;s||(U(!0),s=!0),O(!l&&K.length>3),A(!!i),clearTimeout(t),t=setTimeout((()=>{Q.current&&!a&&(U(!1),s=!1)}),150)};return e.addEventListener("scroll",r,{passive:!0}),()=>{a=!0,e.removeEventListener("scroll",r),clearTimeout(t)}}),[K.length]),(0,r.useEffect)((()=>{if(t&&!d&&!ee&&Q.current){const e={id:"welcome",content:l("chat.welcome"),isUser:!1,timestamp:new Date},t={id:"welcome",title:l("chat.newConversation"),preview:l("chat.startQuestion"),message_count:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),language:c,status:"active",messages:[e]};u(t),X.current=1}}),[t,d,ee,l,c,u]),(0,r.useEffect)((()=>{if("welcome"===(null===d||void 0===d?void 0:d.id)&&1===d.messages.length&&d.messages[0].content!==l("chat.welcome")&&Q.current){const e={...d.messages[0],content:l("chat.welcome")},t={...d,messages:[e]};u(t)}}),[c,l,d,u]),(0,r.useEffect)((()=>{if(t&&(null===e||void 0===e?void 0:e.id)&&Q.current&&!Y.current){Y.current=!0;const t=setTimeout((()=>{Q.current&&h(e.email||e.id).then((()=>{Q.current&&console.log(l("chat.historyLoaded"))})).catch((e=>{Q.current&&(console.error(l("chat.historyLoadError"),e),oe(e))}))}),800);return()=>clearTimeout(t)}}),[t,null===e||void 0===e?void 0:e.id,h,oe,l]);const ue=(0,r.useCallback)((e=>{let t="";if("validation_rejected"===(null===e||void 0===e?void 0:e.type)){var s;let t=e.message||l("chat.rejectionMessage");return(null===(s=e.validation)||void 0===s?void 0:s.suggested_topics)&&e.validation.suggested_topics.length>0&&(t+="\n\n**".concat(l("chat.suggestedTopics"),"**\n"),e.validation.suggested_topics.forEach((e=>{t+="\u2022 ".concat(e,"\n")}))),[t,[]]}if("answer"===(null===e||void 0===e?void 0:e.type)&&(null===e||void 0===e?void 0:e.answer))return t=e.answer.text||"",[t,[]];if("partial_answer"===(null===e||void 0===e?void 0:e.type)&&(null===e||void 0===e?void 0:e.general_answer))return t=e.general_answer.text||"",[t,[]];const a=(null===e||void 0===e?void 0:e.response)||"";if("object"===typeof a&&null!==a)t=String(a.answer||"").trim(),t||(t=l("chat.formatError"));else if(t=String(a).trim()||l("chat.formatError"),t.includes("'type': 'text'")&&t.includes("'answer':")){const e=t.match(/'answer': "(.+?)"/);e&&(t=e[1].replace(/\\"/g,'"').replace(/\\n/g,"\n").replace(/\\\\/g,"\\"))}return[t,[]]}),[l]),me=(0,r.useCallback)((async t=>{const s=t||v;if(!s.trim()||!Q.current)return;const a={id:Date.now().toString(),content:s.trim(),isUser:!0,timestamp:new Date};let r;d&&"welcome"!==d.id&&!d.id.startsWith("temp-")&&(r=d.id),m(a),b(""),j(!0),A(!0),U(!1);try{var n;let t;const a=void 0;if(H?(t=await p(H.originalQuestion+" "+s.trim(),e,c,r,a,!0,H.originalQuestion,{answer:s.trim()}),W(null)):t=await p(s.trim(),e,c,r,a),!Q.current)return;if(!0===(null===(n=t.clarification_result)||void 0===n?void 0:n.clarification_requested)){const e={id:(Date.now()+1).toString(),content:(t.full_text||t.response)+"\n\n".concat(l("chat.clarificationInstruction")),isUser:!1,timestamp:new Date,conversation_id:t.conversation_id};m(e),W({messageId:e.id,originalQuestion:s.trim(),clarificationQuestions:t.clarification_questions||[]})}else{const[e,s]=ue(t),a=ce(e),r={id:(Date.now()+1).toString(),content:a||l("chat.emptyContent"),isUser:!1,timestamp:new Date,conversation_id:t.conversation_id,response_versions:t.response_versions,originalResponse:t.response};m(r)}}catch(o){if(console.error(l("chat.sendError"),o),oe(o),Q.current){const e={id:(Date.now()+1).toString(),content:o instanceof Error?o.message:l("chat.errorMessage"),isUser:!1,timestamp:new Date};m(e)}}finally{Q.current&&j(!1)}}),[v,d,m,H,e,c,ce,oe,l,ue]),pe=(0,r.useCallback)(((e,t)=>{Q.current&&$({isOpen:!0,messageId:e,feedbackType:t})}),[]),ge=(0,r.useCallback)((async(e,t)=>{const{messageId:s}=G;if(!s||!Q.current)return;const a=K.find((e=>e.id===s));if(a&&a.conversation_id){F(!0);try{g(s,{feedback:e,feedbackComment:t});const o="positive"===e?1:-1;try{if(await x.sendFeedback(a.conversation_id,o),t&&t.trim())try{await x.sendFeedbackComment(a.conversation_id,t.trim())}catch(r){console.warn(l("chat.commentNotSent"),r)}}catch(n){throw console.error(l("chat.feedbackSendError"),n),oe(n),Q.current&&g(s,{feedback:null,feedbackComment:void 0}),n}}catch(o){throw console.error(l("chat.feedbackGeneralError"),o),o}finally{Q.current&&F(!1)}}}),[G,K,g,oe,l]),fe=(0,r.useCallback)((()=>{Q.current&&$({isOpen:!1,messageId:null,feedbackType:null})}),[]),he=(0,r.useCallback)((()=>{if(!Q.current)return;f(),W(null);const e={id:"welcome",content:l("chat.welcome"),isUser:!1,timestamp:new Date},t={id:"welcome",title:l("chat.newConversation"),preview:l("chat.startQuestion"),message_count:1,created_at:(new Date).toISOString(),updated_at:(new Date).toISOString(),language:c,status:"active",messages:[e]};u(t),X.current=1,A(!0),U(!1),O(!1)}),[f,l,c,u]),ve=(0,r.useCallback)((()=>{var e;Q.current&&(A(!0),U(!1),O(!1),null===(e=V.current)||void 0===e||e.scrollIntoView({behavior:"smooth"}))}),[]),xe=(0,r.useCallback)((()=>(new Date).toLocaleDateString("fr"===c?"fr-FR":"en-US",{day:"numeric",month:"long",year:"numeric"})),[c]),be=(0,r.useMemo)((()=>N?{height:"100vh",minHeight:"100vh",maxHeight:"100vh"}:{}),[N]),ye=(0,r.useMemo)((()=>N?{height:S?"calc(100vh - 140px - ".concat(I,"px)"):"calc(100vh - 140px)",maxHeight:S?"calc(100vh - 140px - ".concat(I,"px)"):"calc(100vh - 140px)",overflow:"auto",paddingBottom:"1rem"}:{scrollPaddingBottom:"7rem"}),[N,S,I]);return n?s?(0,a.jsx)("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:l("chat.loading")})]})}):t&&e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(se,{user:e}),(0,a.jsxs)("div",{className:"bg-gray-50 flex flex-col relative z-0 ".concat(N?"chat-main-container":"min-h-dvh h-screen"),style:be,children:[(0,a.jsx)("header",{className:"bg-white border-b border-gray-100 px-2 sm:px-4 py-3 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("button",{onClick:he,className:"w-10 h-10 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors flex items-center justify-center border border-gray-200",title:l("nav.newConversation"),"aria-label":l("nav.newConversation"),children:(0,a.jsx)(k,{className:"w-5 h-5"})}),(0,a.jsx)("div",{className:"header-icon-container history-menu-container",children:(0,a.jsx)(P,{})})]}),(0,a.jsxs)("div",{className:"flex-1 min-w-0 flex justify-center items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 grid place-items-center",children:(0,a.jsx)(_,{className:"h-8 w-auto"})}),(0,a.jsx)("h1",{className:"text-lg font-medium text-gray-900 truncate",children:l("common.appName")})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("div",{className:"header-icon-container user-menu-container",children:(0,a.jsx)(te,{})})})]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col min-h-0",children:[(0,a.jsx)("div",{ref:J,className:"flex-1 overflow-y-auto px-2 sm:px-4 py-6 pb-28 overscroll-contain ".concat(N?"chat-scroll-area":""),style:ye,children:(0,a.jsxs)("div",{className:"max-w-full sm:max-w-4xl mx-auto space-y-6 px-2 sm:px-4",children:[ee&&(0,a.jsx)("div",{className:"text-center",children:(0,a.jsx)("span",{className:"text-xs text-gray-400 bg-gray-100 px-3 py-1 rounded-full",children:xe()})}),(0,a.jsx)(ne,{processedMessages:de,isLoadingChat:y,handleFeedbackClick:pe,getUserInitials:ie,user:e,t:l}),(0,a.jsx)("div",{ref:V})]})}),R&&(0,a.jsx)("div",{className:"fixed bottom-24 right-8 z-10",children:(0,a.jsx)("button",{onClick:ve,className:"bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-colors",title:l("chat.scrollToBottom"),"aria-label":l("chat.scrollToBottom"),children:(0,a.jsx)(E,{})})}),(0,a.jsx)("div",{className:"px-2 sm:px-4 py-2 bg-white border-t border-gray-100 z-20 ".concat(N?"chat-input-fixed":"sticky bottom-0"),style:{paddingBottom:"calc(env(safe-area-inset-bottom) + 8px)",position:N?"fixed":"sticky",bottom:0,left:0,right:0,backgroundColor:"white",borderTop:"1px solid rgb(243 244 246)",zIndex:1e3,minHeight:N?"70px":"auto",display:"flex",alignItems:"center"},children:(0,a.jsxs)("div",{className:"max-w-full sm:max-w-4xl lg:max-w-5xl xl:max-w-6xl mx-auto w-full sm:w-[90%] lg:w-[75%] xl:w-[60%]",children:[H&&(0,a.jsx)("div",{className:"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-blue-700 text-sm font-medium",children:l("chat.clarificationMode")}),(0,a.jsx)("button",{onClick:()=>W(null),className:"text-blue-600 hover:text-blue-800 text-sm",children:l("modal.cancel")})]})}),(0,a.jsx)(re,{inputMessage:v,setInputMessage:b,onSendMessage:me,isLoadingChat:y,clarificationState:H,isMobileDevice:N,inputRef:Z,t:l}),(0,a.jsx)("div",{className:"text-center mt-2",children:(0,a.jsx)("p",{className:"text-xs text-gray-500",children:l("chat.disclaimer")})})]})})]})]}),(0,a.jsx)(ae,{isOpen:G.isOpen,onClose:fe,onSubmit:ge,feedbackType:null!==(we=G.feedbackType)&&void 0!==we?we:void 0,isSubmitting:z})]}):(0,a.jsx)("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:l("chat.loading")})]})}):(0,a.jsx)("div",{className:"h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-600",children:l("chat.loading")})]})});var we}ne.displayName="MessageList"},9939:function(e,t,s){"use strict";s.d(t,{Ik:function(){return n},L_:function(){return o},Yc:function(){return i},k$:function(){return r},mT:function(){return a}});const a=[{code:"fr",name:"French",nativeName:"Fran\xe7ais",region:"France",flag:"\ud83c\uddeb\ud83c\uddf7",dateFormat:"fr-FR"},{code:"en",name:"English",nativeName:"English",region:"United States",flag:"\ud83c\uddfa\ud83c\uddf8",dateFormat:"en-US"},{code:"es",name:"Spanish",nativeName:"Espa\xf1ol",region:"Spain",flag:"\ud83c\uddea\ud83c\uddf8",dateFormat:"es-ES"},{code:"pt",name:"Portuguese",nativeName:"Portugu\xeas",region:"Portugal",flag:"\ud83c\uddf5\ud83c\uddf9",dateFormat:"pt-PT"},{code:"de",name:"German",nativeName:"Deutsch",region:"Germany",flag:"\ud83c\udde9\ud83c\uddea",dateFormat:"de-DE"},{code:"nl",name:"Dutch",nativeName:"Nederlands",region:"Netherlands",flag:"\ud83c\uddf3\ud83c\uddf1",dateFormat:"nl-NL"},{code:"pl",name:"Polish",nativeName:"Polski",region:"Poland",flag:"\ud83c\uddf5\ud83c\uddf1",dateFormat:"pl-PL"},{code:"th",name:"Thai",nativeName:"\u0e44\u0e17\u0e22",region:"Thailand",flag:"\ud83c\uddf9\ud83c\udded",dateFormat:"th-TH"},{code:"hi",name:"Hindi",nativeName:"\u0939\u093f\u0902\u0926\u0940",region:"India",flag:"\ud83c\uddee\ud83c\uddf3",dateFormat:"hi-IN"},{code:"zh",name:"Chinese (Mandarin)",nativeName:"\u4e2d\u6587",region:"China",flag:"\ud83c\udde8\ud83c\uddf3",dateFormat:"zh-CN"}],r="en",n=e=>a.find((t=>t.code===e)),o=e=>a.some((t=>t.code===e)),i=()=>{var e;const t=navigator.language||(null===(e=navigator.languages)||void 0===e?void 0:e[0]);if(!t)return r;const s=t.split("-")[0].toLowerCase();return o(s)?s:r};new Set(["ar","he","fa","ur"])},7667:function(e,t,s){"use strict";s.d(t,{$G:function(){return h},Ik:function(){return n.Ik},mT:function(){return n.mT}});var a=s(2265),r=s(8225),n=s(9939);const o=(0,r.getSupabaseClient)();class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}subscribe(e){return this.subscribers.push(e),()=>{this.subscribers=this.subscribers.filter((t=>t!==e))}}notify(){this.subscribers.forEach((e=>{try{e()}catch(t){console.error("Erreur notification i18n:",t)}}))}constructor(){this.subscribers=[]}}const l=i.getInstance(),c={},d=new Set;let u={},m=!0,p=null;const g=()=>{try{const t=localStorage.getItem("intelia-language");if(t){var e;const s=JSON.parse(t);return(null===s||void 0===s||null===(e=s.state)||void 0===e?void 0:e.currentLanguage)||n.k$}}catch(t){console.warn("Erreur lecture langue stock\xe9e:",t)}return n.k$};async function f(e){if(d.has(e))return console.warn("[i18n] Langue ".concat(e," en cache d'erreur, utilisation de ").concat(n.k$)),e===n.k$?{}:f(n.k$);if(c[e])return u=c[e],m=!1,p=e,l.notify(),c[e];try{const t=await fetch("/locales/".concat(e,".json"));if(!t.ok)throw new Error("HTTP ".concat(t.status,": Failed to load translations for ").concat(e));const s=await t.json();if(!s||"object"!==typeof s||0===Object.keys(s).length)throw new Error("Empty or invalid translations for ".concat(e));return c[e]=s,u=s,m=!1,p=e,l.notify(),console.log("[i18n] \u2705 Traductions charg\xe9es pour ".concat(e,": ").concat(Object.keys(s).length," cl\xe9s")),s}catch(t){return console.error("[i18n] \u274c Could not load translations for ".concat(e,":"),t),d.add(e),e!==n.k$?(console.warn("[i18n] \ud83d\udd04 Falling back to ".concat(n.k$)),f(n.k$)):(console.error("[i18n] \ud83d\udca5 Even ".concat(n.k$," failed to load, returning empty translations")),{})}}const h=()=>{const[e,t]=(0,a.useState)(n.k$),[s,r]=(0,a.useState)({}),[i,p]=(0,a.useState)(!0),[,h]=(0,a.useState)({});(0,a.useEffect)((()=>l.subscribe((()=>{h({})}))),[]),(0,a.useEffect)((()=>{(async()=>{try{var e,s;const a=g();if(a&&(0,n.L_)(a))return console.log("[i18n] \ud83d\udce6 Initialisation avec langue stock\xe9e: ".concat(a)),void t(a);const{data:{session:r}}=await o.auth.getSession(),i=null===r||void 0===r||null===(s=r.user)||void 0===s||null===(e=s.user_metadata)||void 0===e?void 0:e.language;if(i&&(0,n.L_)(i))return console.log("[i18n] \ud83d\udce6 Initialisation avec langue Supabase: ".concat(i)),void t(i);const l=(0,n.Yc)();console.log("[i18n] \ud83d\udce6 Initialisation avec langue navigateur: ".concat(l)),t(l)}catch(a){console.log("Erreur initialisation langue, utilisation navigateur");const e=(0,n.Yc)();t(e)}})()}),[]),(0,a.useEffect)((()=>{const s=setInterval((()=>{const s=g();s&&s!==e&&(0,n.L_)(s)&&(console.log("[i18n] \ud83d\udd04 Resynchronisation d\xe9tect\xe9e: ".concat(e," \u2192 ").concat(s)),t(s))}),1e3);return()=>{clearInterval(s)}}),[e]),(0,a.useEffect)((()=>{const s=s=>{if("intelia-language"===s.key&&s.newValue)try{var a;const r=JSON.parse(s.newValue),o=null===r||void 0===r||null===(a=r.state)||void 0===a?void 0:a.currentLanguage;o&&o!==e&&(0,n.L_)(o)&&(console.log("[i18n] \ud83d\udd04 Changement localStorage d\xe9tect\xe9: ".concat(e," \u2192 ").concat(o)),t(o))}catch(r){console.warn("Erreur parsing localStorage change:",r)}};return window.addEventListener("storage",s),()=>{window.removeEventListener("storage",s)}}),[e]),(0,a.useEffect)((()=>{(async()=>{p(!0);try{const t=await f(e);r(t),p(!1)}catch(t){console.error("Erreur chargement traductions:",t),p(!1)}})()}),[e]),(0,a.useEffect)((()=>{const e=e=>{t(e.detail.language)};return window.addEventListener("languageChanged",e),()=>{window.removeEventListener("languageChanged",e)}}),[]);return{t:e=>{const t=Object.keys(s).length>0?s:u;return i&&m||!t[e]?e:t[e]},changeLanguage:async e=>{Object.keys(c).forEach((e=>{delete c[e]})),u={},m=!0,d.delete(e),t(e);try{const t={state:{currentLanguage:e}};localStorage.setItem("intelia-language",JSON.stringify(t)),console.log("[i18n] Langue sauvegard\xe9e:",e)}catch(s){console.warn("[i18n] Erreur sauvegarde langue:",s)}await f(e),window.dispatchEvent(new CustomEvent("languageChanged",{detail:{language:e}}))},getCurrentLanguage:()=>e,formatDate:t=>{const s=(0,n.Ik)(e),a=(null===s||void 0===s?void 0:s.dateFormat)||"en-US";return t.toLocaleDateString(a,{day:"numeric",month:"long",year:"numeric"})},currentLanguage:e,loading:i}}}},function(e){e.O(0,[216,286,744],(function(){return t=8163,e(e.s=t);var t}));var t=e.O();_N_E=t}]);