// ==================== SYST√àME DE TRADUCTION INTELIA EXPERT ====================

import { useState, useEffect } from 'react'
// ‚úÖ CHANGEMENT: Utiliser le singleton au lieu de createClientComponentClient
import { getSupabaseClient } from '@/lib/supabase/singleton'

// ‚úÖ CHANGEMENT: Utiliser le singleton au lieu de createClientComponentClient
const supabase = getSupabaseClient()

// Types pour le syst√®me de traduction
interface TranslationKeys {
  // Navigation et Interface
  'nav.history': string
  'nav.newConversation': string
  'nav.profile': string
  'nav.language': string
  'nav.subscription': string
  'nav.contact': string
  'nav.legal': string
  'nav.logout': string
  'nav.clearAll': string
  'nav.inviteFriend': string
  'nav.account': string
  'nav.settings': string

  // Messages de Chat
  'chat.welcome': string
  'chat.placeholder': string
  'chat.helpfulResponse': string
  'chat.notHelpfulResponse': string
  'chat.voiceRecording': string
  'chat.noConversations': string
  'chat.loading': string
  'chat.errorMessage': string
  'chat.newConversation': string
  'chat.disclaimer': string

  // Modals
  'modal.close': string
  'modal.cancel': string
  'modal.save': string
  'modal.back': string
  'modal.loading': string
  'modal.updating': string

  // Profil
  'profile.title': string
  'profile.personalInfo': string
  'profile.professionalInfo': string
  'profile.contact': string
  'profile.company': string
  'profile.password': string
  'profile.firstName': string
  'profile.lastName': string
  'profile.linkedinProfile': string
  'profile.linkedinCorporate': string
  'profile.email': string
  'profile.phone': string
  'profile.country': string
  'profile.companyName': string
  'profile.companyWebsite': string
  'profile.companyLinkedin': string
  'profile.currentPassword': string
  'profile.newPassword': string
  'profile.confirmPassword': string
  'profile.passwordRequirements': string
  'profile.passwordRequirements8': string
  'profile.passwordRequirementsUpper': string
  'profile.passwordRequirementsLower': string
  'profile.passwordRequirementsNumber': string
  'profile.passwordRequirementsSpecial': string
  'profile.passwordErrors': string
  'profile.passwordChanged': string
  'profile.profileUpdated': string
  'profile.optional': string

  // Langue
  'language.title': string
  'language.description': string
  'language.updating': string
  'language.changeSuccess': string
  'language.interfaceUpdated': string
  'language.reloadForWidget': string
  'language.reloadNow': string
  'language.continueWithoutReload': string

  // Abonnement
  'subscription.title': string
  'subscription.currentPlan': string
  'subscription.modify': string
  'subscription.payment': string
  'subscription.update': string
  'subscription.invoices': string
  'subscription.cancellation': string
  'subscription.cancel': string
  'subscription.confirmCancel': string

  // Contact
  'contact.title': string
  'contact.phone': string
  'contact.phoneDescription': string
  'contact.email': string
  'contact.emailDescription': string
  'contact.website': string
  'contact.websiteDescription': string

  // Dates et Formats
  'date.today': string
  'date.format': string

  // Plans
  'plan.essential': string
  'plan.pro': string
  'plan.max': string

  // Messages d'erreur et succ√®s
  'error.generic': string
  'error.connection': string
  'error.updateProfile': string
  'error.changePassword': string
  'error.firstNameRequired': string
  'error.lastNameRequired': string
  'error.emailRequired': string
  'error.emailInvalid': string
  'error.emailTooLong': string
  'error.firstNameTooLong': string
  'error.lastNameTooLong': string
  'error.companyNameTooLong': string
  'error.urlInvalid': string
  'error.urlProtocol': string
  'error.linkedinInvalid': string
  'error.phonePrefix': string
  'error.currentPasswordRequired': string
  'error.newPasswordRequired': string
  'error.confirmPasswordRequired': string
  'error.currentPasswordIncorrect': string
  'error.passwordServerError': string
  'error.userNotConnected': string
  'error.validationErrors': string
  'success.profileUpdated': string
  'success.passwordChanged': string
  'success.languageUpdated': string

  // Formulaires
  'form.required': string
  'form.phoneFormat': string
  'form.passwordMinLength': string
  'form.passwordUppercase': string
  'form.passwordLowercase': string
  'form.passwordNumber': string
  'form.passwordSpecial': string
  'form.passwordMismatch': string

  // Messages communs
  'common.optional': string
  'common.unexpectedError': string
  'common.loading': string
  'common.saving': string
  'common.success': string
  'common.error': string
  'common.confirm': string
  'common.delete': string
  'common.edit': string
  'common.view': string
  'common.search': string
  'common.filter': string
  'common.clear': string
  'common.reset': string
  'common.apply': string
  'common.update': string

  // Interface utilisateur
  'ui.menu': string
  'ui.close': string
  'ui.open': string
  'ui.expand': string
  'ui.collapse': string
  'ui.previous': string
  'ui.next': string

  // Modales et dialogues
  'dialog.confirm': string
  'dialog.cancel': string
  'dialog.ok': string
  'dialog.yes': string
  'dialog.no': string

  // Messages d'√©tat
  'status.online': string
  'status.offline': string
  'status.connecting': string
  'status.connected': string
  'status.disconnected': string

  // Invitations
  'invite.emailPlaceholder': string
  'invite.namePlaceholder': string
  'invite.messagePlaceholder': string
  'invite.sendButton': string
  'invite.sentSuccess': string
  'invite.error': string
  'invite.invalidEmail': string

  // Contact
  'contact.subject': string
  'contact.message': string
  'contact.sendMessage': string
  'contact.messageSent': string

  // Compte
  'account.settings': string
  'account.preferences': string
  'account.security': string
  'account.privacy': string
  'account.notifications': string

  // Historique
  'history.clear': string
  'history.delete': string
  'history.export': string
  'history.search': string
  'history.filter': string
  'history.noResults': string
  'history.confirmClear': string

  // Menu utilisateur
  'user.menu': string
  'user.profile': string
  'user.settings': string
  'user.logout': string
  'user.account': string

  // Placeholders
  'placeholder.linkedinPersonal': string
  'placeholder.companyName': string
  'placeholder.companyWebsite': string
  'placeholder.linkedinCorporate': string
  'placeholder.countrySelect': string
  'placeholder.currentPassword': string
  'placeholder.newPassword': string
  'placeholder.confirmPassword': string

  // RGPD et Confidentialit√©
  'gdpr.deleteAccount': string
  'gdpr.exportData': string
  'gdpr.confirmDelete': string
  'gdpr.contactSupport': string

  // Pays
  'country.canada': string
  'country.usa': string
  'country.france': string
  'country.belgium': string
  'country.switzerland': string
  'country.mexico': string
  'country.brazil': string
}

// Traductions compl√®tes
const translations: Record<string, TranslationKeys> = {
  fr: {
    // Navigation et Interface
    'nav.history': 'Historique des conversations',
    'nav.newConversation': 'Nouvelle conversation',
    'nav.profile': 'Profil',
    'nav.language': 'Langue',
    'nav.subscription': 'Abonnement',
    'nav.contact': 'Nous joindre',
    'nav.legal': 'Mentions l√©gales',
    'nav.logout': 'D√©connexion',
    'nav.clearAll': 'Tout effacer',
    'nav.inviteFriend': 'Inviter un ami',
    'nav.account': 'Compte',
    'nav.settings': 'Param√®tres',

    // Messages de Chat
    'chat.welcome': 'Bonjour ! Comment puis-je vous aider aujourd\'hui ?',
    'chat.placeholder': 'Bonjour ! Comment puis-je vous aider aujourd\'hui ?',
    'chat.helpfulResponse': 'R√©ponse utile',
    'chat.notHelpfulResponse': 'R√©ponse non utile',
    'chat.voiceRecording': 'Enregistrement vocal',
    'chat.noConversations': 'Aucune conversation pr√©c√©dente',
    'chat.loading': 'Chargement...',
    'chat.errorMessage': 'D√©sol√©, je rencontre un probl√®me technique. Veuillez r√©essayer dans quelques instants.',
    'chat.newConversation': 'Nouvelle conversation',
    'chat.disclaimer': 'Intelia Expert peut faire des erreurs. Faites v√©rifier les r√©ponses par un professionnel au besoin.',

    // Modals
    'modal.close': 'Fermer',
    'modal.cancel': 'Annuler',
    'modal.save': 'Sauvegarder',
    'modal.back': 'Retour',
    'modal.loading': 'Sauvegarde...',
    'modal.updating': 'Mise √† jour en cours...',

    // Profil
    'profile.title': 'Profil',
    'profile.personalInfo': 'Informations personnelles',
    'profile.professionalInfo': 'Informations Professionnelles',
    'profile.contact': 'Contact',
    'profile.company': 'Entreprise',
    'profile.password': 'Mot de passe',
    'profile.firstName': 'Pr√©nom *',
    'profile.lastName': 'Nom de famille *',
    'profile.linkedinProfile': 'Profil LinkedIn personnel',
    'profile.linkedinCorporate': 'Page LinkedIn Entreprise',
    'profile.email': 'Email *',
    'profile.phone': 'T√©l√©phone',
    'profile.country': 'Pays *',
    'profile.companyName': 'Nom de l\'entreprise',
    'profile.companyWebsite': 'Site web de l\'entreprise',
    'profile.companyLinkedin': 'Page LinkedIn de l\'entreprise',
    'profile.currentPassword': 'Mot de passe actuel *',
    'profile.newPassword': 'Nouveau mot de passe *',
    'profile.confirmPassword': 'Confirmer le nouveau mot de passe *',
    'profile.passwordRequirements': 'Le mot de passe doit contenir :',
    'profile.passwordRequirements8': '8+ caract√®res',
    'profile.passwordRequirementsUpper': 'Une majuscule',
    'profile.passwordRequirementsLower': 'Une minuscule',
    'profile.passwordRequirementsNumber': 'Un chiffre',
    'profile.passwordRequirementsSpecial': 'Caract√®re sp√©cial',
    'profile.passwordErrors': 'Erreurs :',
    'profile.passwordChanged': 'Mot de passe chang√© avec succ√®s !',
    'profile.profileUpdated': 'Profil mis √† jour avec succ√®s !',
    'profile.optional': '(optionnel)',

    // Langue
    'language.title': 'Langue',
    'language.description': 'S√©lectionnez votre langue pr√©f√©r√©e pour l\'interface Intelia Expert',
    'language.updating': 'Mise √† jour en cours...',
    'language.changeSuccess': 'Langue modifi√©e !',
    'language.interfaceUpdated': 'L\'interface a √©t√© mise √† jour imm√©diatement.',
    'language.reloadForWidget': 'Pour que le widget de chat soit √©galement dans la nouvelle langue, un rechargement de page est recommand√©.',
    'language.reloadNow': 'üîÑ Recharger maintenant',
    'language.continueWithoutReload': '‚≠êÔ∏è Continuer sans recharger',

    // Abonnement
    'subscription.title': 'Abonnement',
    'subscription.currentPlan': 'Plan',
    'subscription.modify': 'Modifier l\'abonnement',
    'subscription.payment': 'Paiement',
    'subscription.update': 'Mettre √† jour',
    'subscription.invoices': 'Factures',
    'subscription.cancellation': 'Annulation',
    'subscription.cancel': 'Annuler',
    'subscription.confirmCancel': '√ätes-vous s√ªr de vouloir annuler votre abonnement ? Vous perdrez l\'acc√®s aux fonctionnalit√©s premium.',

    // Contact
    'contact.title': 'Nous joindre',
    'contact.phone': 'Nous appeler',
    'contact.phoneDescription': 'Si vous ne trouvez pas de solution, appelez-nous pour parler directement avec notre √©quipe.',
    'contact.email': 'Nous √©crire',
    'contact.emailDescription': 'Envoyez-nous un message d√©taill√© et nous vous r√©pondrons rapidement.',
    'contact.website': 'Visiter notre site web',
    'contact.websiteDescription': 'Pour en savoir plus sur nous et la plateforme Intelia, visitez notre site.',

    // Dates et Formats
    'date.today': 'Aujourd\'hui',
    'date.format': 'fr-FR',

    // Plans
    'plan.essential': 'Essentiel',
    'plan.pro': 'Pro',
    'plan.max': 'Max',

    // Messages d'erreur et succ√®s
    'error.generic': 'Une erreur est survenue',
    'error.connection': 'Erreur de connexion',
    'error.updateProfile': 'Erreur lors de la mise √† jour du profil',
    'error.changePassword': 'Erreur lors du changement de mot de passe',
    'error.firstNameRequired': 'Le pr√©nom est requis',
    'error.lastNameRequired': 'Le nom est requis',
    'error.emailRequired': 'L\'email est requis',
    'error.emailInvalid': 'Format d\'email invalide',
    'error.emailTooLong': 'L\'email est trop long (maximum 254 caract√®res)',
    'error.firstNameTooLong': 'Le pr√©nom est trop long (maximum 50 caract√®res)',
    'error.lastNameTooLong': 'Le nom est trop long (maximum 50 caract√®res)',
    'error.companyNameTooLong': 'Le nom de l\'entreprise est trop long (maximum 100 caract√®res)',
    'error.urlInvalid': 'n\'est pas une URL valide',
    'error.urlProtocol': 'doit commencer par http:// ou https://',
    'error.linkedinInvalid': 'doit √™tre un lien LinkedIn valide',
    'error.phonePrefix': 'T√©l√©phone:',
    'error.currentPasswordRequired': 'Le mot de passe actuel est requis',
    'error.newPasswordRequired': 'Le nouveau mot de passe est requis',
    'error.confirmPasswordRequired': 'La confirmation du mot de passe est requise',
    'error.currentPasswordIncorrect': 'Le mot de passe actuel est incorrect',
    'error.passwordServerError': 'Erreur de connexion au serveur. Veuillez r√©essayer.',
    'error.userNotConnected': 'Utilisateur non connect√©',
    'error.validationErrors': 'Erreurs de validation',
    'success.profileUpdated': 'Profil mis √† jour avec succ√®s !',
    'success.passwordChanged': 'Mot de passe chang√© avec succ√®s !',
    'success.languageUpdated': 'Langue mise √† jour',

    // Formulaires
    'form.required': 'Champ requis',
    'form.phoneFormat': 'Format',
    'form.passwordMinLength': 'Au moins 8 caract√®res',
    'form.passwordUppercase': 'Au moins une majuscule',
    'form.passwordLowercase': 'Au moins une minuscule',
    'form.passwordNumber': 'Au moins un chiffre',
    'form.passwordSpecial': 'Au moins un caract√®re sp√©cial',
    'form.passwordMismatch': 'Les mots de passe ne correspondent pas',

    // Commun
    'common.optional': '(optionnel)',
    'common.unexpectedError': 'Une erreur est survenue.',
    'common.loading': 'Chargement...',
    'common.saving': 'Sauvegarde...',
    'common.success': 'Succ√®s',
    'common.error': 'Erreur',
    'common.confirm': 'Confirmer',
    'common.delete': 'Supprimer',
    'common.edit': 'Modifier',
    'common.view': 'Voir',
    'common.search': 'Rechercher',
    'common.filter': 'Filtrer',
    'common.clear': 'Effacer',
    'common.reset': 'R√©initialiser',
    'common.apply': 'Appliquer',
    'common.update': 'Mettre √† jour',

    // Interface utilisateur
    'ui.menu': 'Menu',
    'ui.close': 'Fermer',
    'ui.open': 'Ouvrir',
    'ui.expand': 'D√©velopper',
    'ui.collapse': 'R√©duire',
    'ui.previous': 'Pr√©c√©dent',
    'ui.next': 'Suivant',

    // Modales et dialogues
    'dialog.confirm': 'Confirmer',
    'dialog.cancel': 'Annuler',
    'dialog.ok': 'OK',
    'dialog.yes': 'Oui',
    'dialog.no': 'Non',

    // Messages d'√©tat
    'status.online': 'En ligne',
    'status.offline': 'Hors ligne',
    'status.connecting': 'Connexion...',
    'status.connected': 'Connect√©',
    'status.disconnected': 'D√©connect√©',

    // Invitations
    'invite.emailPlaceholder': 'Adresse email de votre ami',
    'invite.namePlaceholder': 'Nom de votre ami (optionnel)',
    'invite.messagePlaceholder': 'Message personnalis√© (optionnel)',
    'invite.sendButton': 'Envoyer l\'invitation',
    'invite.sentSuccess': 'Invitation envoy√©e avec succ√®s !',
    'invite.error': 'Erreur lors de l\'envoi de l\'invitation',
    'invite.invalidEmail': 'Adresse email invalide',

    // Contact
    'contact.subject': 'Sujet',
    'contact.message': 'Message',
    'contact.sendMessage': 'Envoyer le message',
    'contact.messageSent': 'Message envoy√© avec succ√®s !',

    // Compte
    'account.settings': 'Param√®tres du compte',
    'account.preferences': 'Pr√©f√©rences',
    'account.security': 'S√©curit√©',
    'account.privacy': 'Confidentialit√©',
    'account.notifications': 'Notifications',

    // Historique
    'history.clear': 'Effacer l\'historique',
    'history.delete': 'Supprimer',
    'history.export': 'Exporter',
    'history.search': 'Rechercher dans l\'historique',
    'history.filter': 'Filtrer l\'historique',
    'history.noResults': 'Aucun r√©sultat trouv√©',
    'history.confirmClear': '√ätes-vous s√ªr de vouloir effacer tout l\'historique ?',

    // Menu utilisateur
    'user.menu': 'Menu utilisateur',
    'user.profile': 'Mon profil',
    'user.settings': 'Param√®tres',
    'user.logout': 'Se d√©connecter',
    'user.account': 'Mon compte',

    // Placeholders
    'placeholder.linkedinPersonal': 'https://linkedin.com/in/votre-profil',
    'placeholder.companyName': 'Nom de votre entreprise ou exploitation',
    'placeholder.companyWebsite': 'https://www.votre-entreprise.com',
    'placeholder.linkedinCorporate': 'https://linkedin.com/company/votre-entreprise',
    'placeholder.countrySelect': 'S√©lectionner un pays ou rechercher...',
    'placeholder.currentPassword': 'Tapez votre mot de passe actuel',
    'placeholder.newPassword': 'Tapez votre nouveau mot de passe',
    'placeholder.confirmPassword': 'Confirmez votre nouveau mot de passe',

    // RGPD et Confidentialit√©
    'gdpr.deleteAccount': 'Supprimer mon compte',
    'gdpr.exportData': 'Exporter mes donn√©es',
    'gdpr.confirmDelete': '√ätes-vous s√ªr de vouloir supprimer d√©finitivement votre compte ? Cette action est irr√©versible.',
    'gdpr.contactSupport': 'Pour supprimer d√©finitivement votre compte, veuillez contacter support@intelia.com',

    // Pays
    'country.canada': 'Canada',
    'country.usa': '√âtats-Unis',
    'country.france': 'France',
    'country.belgium': 'Belgique',
    'country.switzerland': 'Suisse',
    'country.mexico': 'Mexique',
    'country.brazil': 'Br√©sil'
  },

  en: {
    // Navigation et Interface
    'nav.history': 'Conversation history',
    'nav.newConversation': 'New conversation',
    'nav.profile': 'Profile',
    'nav.language': 'Language',
    'nav.subscription': 'Subscription',
    'nav.contact': 'Contact us',
    'nav.legal': 'Legal',
    'nav.logout': 'Logout',
    'nav.clearAll': 'Clear all',
    'nav.inviteFriend': 'Invite a Friend',
    'nav.account': 'Account',
    'nav.settings': 'Settings',

    // Messages de Chat
    'chat.welcome': 'Hello! How can I help you today?',
    'chat.placeholder': 'Hello! How can I help you today?',
    'chat.helpfulResponse': 'Helpful response',
    'chat.notHelpfulResponse': 'Not helpful response',
    'chat.voiceRecording': 'Voice recording',
    'chat.noConversations': 'No previous conversations',
    'chat.loading': 'Loading...',
    'chat.errorMessage': 'Sorry, I\'m experiencing a technical issue. Please try again in a few moments.',
    'chat.newConversation': 'New conversation',
    'chat.disclaimer': 'Intelia Expert can make mistakes. Please verify the answers with a professional if necessary.',

    // Modals
    'modal.close': 'Close',
    'modal.cancel': 'Cancel',
    'modal.save': 'Save',
    'modal.back': 'Back',
    'modal.loading': 'Saving...',
    'modal.updating': 'Updating...',

    // Profil
    'profile.title': 'Profile',
    'profile.personalInfo': 'Personal information',
    'profile.professionalInfo': 'Professional Information',
    'profile.contact': 'Contact',
    'profile.company': 'Company',
    'profile.password': 'Password',
    'profile.firstName': 'First name *',
    'profile.lastName': 'Last name *',
    'profile.linkedinProfile': 'Personal LinkedIn profile',
    'profile.linkedinCorporate': 'Company LinkedIn Page',
    'profile.email': 'Email *',
    'profile.phone': 'Phone',
    'profile.country': 'Country *',
    'profile.companyName': 'Company name',
    'profile.companyWebsite': 'Company website',
    'profile.companyLinkedin': 'Company LinkedIn page',
    'profile.currentPassword': 'Current password *',
    'profile.newPassword': 'New password *',
    'profile.confirmPassword': 'Confirm new password *',
    'profile.passwordRequirements': 'Password must contain:',
    'profile.passwordRequirements8': '8+ characters',
    'profile.passwordRequirementsUpper': 'One uppercase',
    'profile.passwordRequirementsLower': 'One lowercase',
    'profile.passwordRequirementsNumber': 'One number',
    'profile.passwordRequirementsSpecial': 'Special character',
    'profile.passwordErrors': 'Errors:',
    'profile.passwordChanged': 'Password changed successfully!',
    'profile.profileUpdated': 'Profile updated successfully!',
    'profile.optional': '(optional)',

    // Langue
    'language.title': 'Language',
    'language.description': 'Select your preferred language for the Intelia Expert interface',
    'language.updating': 'Updating...',
    'language.changeSuccess': 'Language Changed!',
    'language.interfaceUpdated': 'The interface has been updated immediately.',
    'language.reloadForWidget': 'For the chat widget to also be in the new language, a page reload is recommended.',
    'language.reloadNow': 'üîÑ Reload Now',
    'language.continueWithoutReload': '‚≠êÔ∏è Continue Without Reload',

    // Abonnement
    'subscription.title': 'Subscription',
    'subscription.currentPlan': 'Plan',
    'subscription.modify': 'Modify subscription',
    'subscription.payment': 'Payment',
    'subscription.update': 'Update',
    'subscription.invoices': 'Invoices',
    'subscription.cancellation': 'Cancellation',
    'subscription.cancel': 'Cancel',
    'subscription.confirmCancel': 'Are you sure you want to cancel your subscription? You will lose access to premium features.',

    // Contact
    'contact.title': 'Contact us',
    'contact.phone': 'Call us',
    'contact.phoneDescription': 'If you can\'t find a solution, call us to speak directly with our team.',
    'contact.email': 'Email us',
    'contact.emailDescription': 'Send us a detailed message and we\'ll respond quickly.',
    'contact.website': 'Visit our website',
    'contact.websiteDescription': 'To learn more about us and the Intelia platform, visit our site.',

    // Dates et Formats
    'date.today': 'Today',
    'date.format': 'en-US',

    // Plans
    'plan.essential': 'Essential',
    'plan.pro': 'Pro',
    'plan.max': 'Max',

    // Messages d'erreur et succ√®s
    'error.generic': 'An error occurred',
    'error.connection': 'Connection error',
    'error.updateProfile': 'Error updating profile',
    'error.changePassword': 'Error changing password',
    'error.firstNameRequired': 'First name is required',
    'error.lastNameRequired': 'Last name is required',
    'error.emailRequired': 'Email is required',
    'error.emailInvalid': 'Invalid email format',
    'error.emailTooLong': 'Email is too long (maximum 254 characters)',
    'error.firstNameTooLong': 'First name is too long (maximum 50 characters)',
    'error.lastNameTooLong': 'Last name is too long (maximum 50 characters)',
    'error.companyNameTooLong': 'Company name is too long (maximum 100 characters)',
    'error.urlInvalid': 'is not a valid URL',
    'error.urlProtocol': 'must start with http:// or https://',
    'error.linkedinInvalid': 'must be a valid LinkedIn link',
    'error.phonePrefix': 'Phone:',
    'error.currentPasswordRequired': 'Current password is required',
    'error.newPasswordRequired': 'New password is required',
    'error.confirmPasswordRequired': 'Password confirmation is required',
    'error.currentPasswordIncorrect': 'Current password is incorrect',
    'error.passwordServerError': 'Server connection error. Please try again.',
    'error.userNotConnected': 'User not connected',
    'error.validationErrors': 'Validation errors',
    'success.profileUpdated': 'Profile updated successfully!',
    'success.passwordChanged': 'Password changed successfully!',
    'success.languageUpdated': 'Language updated',

    // Formulaires
    'form.required': 'Required field',
    'form.phoneFormat': 'Format',
    'form.passwordMinLength': 'At least 8 characters',
    'form.passwordUppercase': 'At least one uppercase',
    'form.passwordLowercase': 'At least one lowercase',
    'form.passwordNumber': 'At least one number',
    'form.passwordSpecial': 'At least one special character',
    'form.passwordMismatch': 'Passwords do not match',

    // Commun
    'common.optional': '(optional)',
    'common.unexpectedError': 'An error occurred.',
    'common.loading': 'Loading...',
    'common.saving': 'Saving...',
    'common.success': 'Success',
    'common.error': 'Error',
    'common.confirm': 'Confirm',
    'common.delete': 'Delete',
    'common.edit': 'Edit',
    'common.view': 'View',
    'common.search': 'Search',
    'common.filter': 'Filter',
    'common.clear': 'Clear',
    'common.reset': 'Reset',
    'common.apply': 'Apply',
    'common.update': 'Update',

    // Interface utilisateur
    'ui.menu': 'Menu',
    'ui.close': 'Close',
    'ui.open': 'Open',
    'ui.expand': 'Expand',
    'ui.collapse': 'Collapse',
    'ui.previous': 'Previous',
    'ui.next': 'Next',

    // Modales et dialogues
    'dialog.confirm': 'Confirm',
    'dialog.cancel': 'Cancel',
    'dialog.ok': 'OK',
    'dialog.yes': 'Yes',
    'dialog.no': 'No',

    // Messages d'√©tat
    'status.online': 'Online',
    'status.offline': 'Offline',
    'status.connecting': 'Connecting...',
    'status.connected': 'Connected',
    'status.disconnected': 'Disconnected',

    // Invitations
    'invite.emailPlaceholder': 'Your friend\'s email address',
    'invite.namePlaceholder': 'Your friend\'s name (optional)',
    'invite.messagePlaceholder': 'Custom message (optional)',
    'invite.sendButton': 'Send Invitation',
    'invite.sentSuccess': 'Invitation sent successfully!',
    'invite.error': 'Error sending invitation',
    'invite.invalidEmail': 'Invalid email address',

    // Contact
    'contact.subject': 'Subject',
    'contact.message': 'Message',
    'contact.sendMessage': 'Send Message',
    'contact.messageSent': 'Message sent successfully!',

    // Compte
    'account.settings': 'Account Settings',
    'account.preferences': 'Preferences',
    'account.security': 'Security',
    'account.privacy': 'Privacy',
    'account.notifications': 'Notifications',

    // Historique
    'history.clear': 'Clear History',
    'history.delete': 'Delete',
    'history.export': 'Export',
    'history.search': 'Search History',
    'history.filter': 'Filter History',
    'history.noResults': 'No results found',
    'history.confirmClear': 'Are you sure you want to clear all history?',

    // Menu utilisateur
    'user.menu': 'User Menu',
    'user.profile': 'My Profile',
    'user.settings': 'Settings',
    'user.logout': 'Logout',
    'user.account': 'My Account',

    // Placeholders
    'placeholder.linkedinPersonal': 'https://linkedin.com/in/your-profile',
    'placeholder.companyName': 'Your company or business name',
    'placeholder.companyWebsite': 'https://www.your-company.com',
    'placeholder.linkedinCorporate': 'https://linkedin.com/company/your-company',
    'placeholder.countrySelect': 'Select a country or search...',
    'placeholder.currentPassword': 'Enter your current password',
    'placeholder.newPassword': 'Enter your new password',
    'placeholder.confirmPassword': 'Confirm your new password',

    // RGPD et Confidentialit√©
    'gdpr.deleteAccount': 'Delete my account',
    'gdpr.exportData': 'Export my data',
    'gdpr.confirmDelete': 'Are you sure you want to permanently delete your account? This action is irreversible.',
    'gdpr.contactSupport': 'To permanently delete your account, please contact support@intelia.com',

    // Pays
    'country.canada': 'Canada',
    'country.usa': 'United States',
    'country.france': 'France',
    'country.belgium': 'Belgium',
    'country.switzerland': 'Switzerland',
    'country.mexico': 'Mexico',
    'country.brazil': 'Brazil'
  },

  es: {
    // Navigation et Interface
    'nav.history': 'Historial de conversaciones',
    'nav.newConversation': 'Nueva conversaci√≥n',
    'nav.profile': 'Perfil',
    'nav.language': 'Idioma',
    'nav.subscription': 'Suscripci√≥n',
    'nav.contact': 'Cont√°ctanos',
    'nav.legal': 'Legal',
    'nav.logout': 'Cerrar sesi√≥n',
    'nav.clearAll': 'Borrar todo',
    'nav.inviteFriend': 'Invitar un Amigo',
    'nav.account': 'Cuenta',
    'nav.settings': 'Configuraci√≥n',

    // Messages de Chat
    'chat.welcome': '¬°Hola! ¬øC√≥mo puedo ayudarte hoy?',
    'chat.placeholder': '¬°Hola! ¬øC√≥mo puedo ayudarte hoy?',
    'chat.helpfulResponse': 'Respuesta √∫til',
    'chat.notHelpfulResponse': 'Respuesta no √∫til',
    'chat.voiceRecording': 'Grabaci√≥n de voz',
    'chat.noConversations': 'No hay conversaciones anteriores',
    'chat.loading': 'Cargando...',
    'chat.errorMessage': 'Lo siento, tengo un problema t√©cnico. Por favor, int√©ntalo de nuevo en unos momentos.',
    'chat.newConversation': 'Nueva conversaci√≥n',
    'chat.disclaimer': 'Intelia Expert puede cometer errores. Verifique las respuestas con un profesional si es necesario.',

    // Modals
    'modal.close': 'Cerrar',
    'modal.cancel': 'Cancelar',
    'modal.save': 'Guardar',
    'modal.back': 'Volver',
    'modal.loading': 'Guardando...',
    'modal.updating': 'Actualizando...',

    // Profil
    'profile.title': 'Perfil',
    'profile.personalInfo': 'Informaci√≥n personal',
    'profile.professionalInfo': 'Informaci√≥n Profesional',
    'profile.contact': 'Contacto',
    'profile.company': 'Empresa',
    'profile.password': 'Contrase√±a',
    'profile.firstName': 'Nombre *',
    'profile.lastName': 'Apellido *',
    'profile.linkedinProfile': 'Perfil personal de LinkedIn',
    'profile.linkedinCorporate': 'P√°gina de LinkedIn de la Empresa',
    'profile.email': 'Email *',
    'profile.phone': 'Tel√©fono',
    'profile.country': 'Pa√≠s *',
    'profile.companyName': 'Nombre de la empresa',
    'profile.companyWebsite': 'Sitio web de la empresa',
    'profile.companyLinkedin': 'P√°gina de LinkedIn de la empresa',
    'profile.currentPassword': 'Contrase√±a actual *',
    'profile.newPassword': 'Nueva contrase√±a *',
    'profile.confirmPassword': 'Confirmar nueva contrase√±a *',
    'profile.passwordRequirements': 'La contrase√±a debe contener:',
    'profile.passwordRequirements8': '8+ caracteres',
    'profile.passwordRequirementsUpper': 'Una may√∫scula',
    'profile.passwordRequirementsLower': 'Una min√∫scula',
    'profile.passwordRequirementsNumber': 'Un n√∫mero',
    'profile.passwordRequirementsSpecial': 'Car√°cter especial',
    'profile.passwordErrors': 'Errores:',
    'profile.passwordChanged': '¬°Contrase√±a cambiada con √©xito!',
    'profile.profileUpdated': '¬°Perfil actualizado con √©xito!',
    'profile.optional': '(opcional)',

    // Langue
    'language.title': 'Idioma',
    'language.description': 'Selecciona tu idioma preferido para la interfaz de Intelia Expert',
    'language.updating': 'Actualizando...',
    'language.changeSuccess': '¬°Idioma Cambiado!',
    'language.interfaceUpdated': 'La interfaz se ha actualizado inmediatamente.',
    'language.reloadForWidget': 'Para que el widget de chat tambi√©n est√© en el nuevo idioma, se recomienda recargar la p√°gina.',
    'language.reloadNow': 'üîÑ Recargar Ahora',
    'language.continueWithoutReload': '‚≠êÔ∏è Continuar Sin Recargar',

    // Abonnement
    'subscription.title': 'Suscripci√≥n',
    'subscription.currentPlan': 'Plan',
    'subscription.modify': 'Modificar suscripci√≥n',
    'subscription.payment': 'Pago',
    'subscription.update': 'Actualizar',
    'subscription.invoices': 'Facturas',
    'subscription.cancellation': 'Cancelaci√≥n',
    'subscription.cancel': 'Cancelar',
    'subscription.confirmCancel': '¬øEst√°s seguro de que quieres cancelar tu suscripci√≥n? Perder√°s el acceso a las funciones premium.',

    // Contact
    'contact.title': 'Cont√°ctanos',
    'contact.phone': 'Ll√°manos',
    'contact.phoneDescription': 'Si no encuentras una soluci√≥n, ll√°manos para hablar directamente con nuestro equipo.',
    'contact.email': 'Escr√≠benos',
    'contact.emailDescription': 'Env√≠anos un mensaje detallado y te responderemos r√°pidamente.',
    'contact.website': 'Visita nuestro sitio web',
    'contact.websiteDescription': 'Para saber m√°s sobre nosotros y la plataforma Intelia, visita nuestro sitio.',

    // Dates et Formats
    'date.today': 'Hoy',
    'date.format': 'es-ES',

    // Plans
    'plan.essential': 'Esencial',
    'plan.pro': 'Pro',
    'plan.max': 'M√°ximo',

    // Messages d'erreur et succ√®s
    'error.generic': 'Ocurri√≥ un error',
    'error.connection': 'Error de conexi√≥n',
    'error.updateProfile': 'Error al actualizar el perfil',
    'error.changePassword': 'Error al cambiar la contrase√±a',
    'error.firstNameRequired': 'El nombre es requerido',
    'error.lastNameRequired': 'El apellido es requerido',
    'error.emailRequired': 'El email es requerido',
    'error.emailInvalid': 'Formato de email inv√°lido',
    'error.emailTooLong': 'El email es demasiado largo (m√°ximo 254 caracteres)',
    'error.firstNameTooLong': 'El nombre es demasiado largo (m√°ximo 50 caracteres)',
    'error.lastNameTooLong': 'El apellido es demasiado largo (m√°ximo 50 caracteres)',
    'error.companyNameTooLong': 'El nombre de la empresa es demasiado largo (m√°ximo 100 caracteres)',
    'error.urlInvalid': 'no es una URL v√°lida',
    'error.urlProtocol': 'debe empezar con http:// o https://',
    'error.linkedinInvalid': 'debe ser un enlace de LinkedIn v√°lido',
    'error.phonePrefix': 'Tel√©fono:',
    'error.currentPasswordRequired': 'La contrase√±a actual es requerida',
    'error.newPasswordRequired': 'La nueva contrase√±a es requerida',
    'error.confirmPasswordRequired': 'La confirmaci√≥n de contrase√±a es requerida',
    'error.currentPasswordIncorrect': 'La contrase√±a actual es incorrecta',
    'error.passwordServerError': 'Error de conexi√≥n al servidor. Por favor, int√©ntalo de nuevo.',
    'error.userNotConnected': 'Usuario no conectado',
    'error.validationErrors': 'Errores de validaci√≥n',
    'success.profileUpdated': '¬°Perfil actualizado con √©xito!',
    'success.passwordChanged': '¬°Contrase√±a cambiada con √©xito!',
    'success.languageUpdated': 'Idioma actualizado',

    // Formulaires
    'form.required': 'Campo requerido',
    'form.phoneFormat': 'Formato',
    'form.passwordMinLength': 'Al menos 8 caracteres',
    'form.passwordUppercase': 'Al menos una may√∫scula',
    'form.passwordLowercase': 'Al menos una min√∫scula',
    'form.passwordNumber': 'Al menos un n√∫mero',
    'form.passwordSpecial': 'Al menos un car√°cter especial',
    'form.passwordMismatch': 'Las contrase√±as no coinciden',

    // Commun
    'common.optional': '(opcional)',
    'common.unexpectedError': 'Ocurri√≥ un error.',
    'common.loading': 'Cargando...',
    'common.saving': 'Guardando...',
    'common.success': '√âxito',
    'common.error': 'Error',
    'common.confirm': 'Confirmar',
    'common.delete': 'Eliminar',
    'common.edit': 'Editar',
    'common.view': 'Ver',
    'common.search': 'Buscar',
    'common.filter': 'Filtrar',
    'common.clear': 'Limpiar',
    'common.reset': 'Restablecer',
    'common.apply': 'Aplicar',
    'common.update': 'Actualizar',

    // Interface utilisateur
    'ui.menu': 'Men√∫',
    'ui.close': 'Cerrar',
    'ui.open': 'Abrir',
    'ui.expand': 'Expandir',
    'ui.collapse': 'Contraer',
    'ui.previous': 'Anterior',
    'ui.next': 'Siguiente',

    // Modales et dialogues
    'dialog.confirm': 'Confirmar',
    'dialog.cancel': 'Cancelar',
    'dialog.ok': 'OK',
    'dialog.yes': 'S√≠',
    'dialog.no': 'No',

    // Messages d'√©tat
    'status.online': 'En l√≠nea',
    'status.offline': 'Sin conexi√≥n',
    'status.connecting': 'Conectando...',
    'status.connected': 'Conectado',
    'status.disconnected': 'Desconectado',

    // Invitations
    'invite.emailPlaceholder': 'Direcci√≥n de email de tu amigo',
    'invite.namePlaceholder': 'Nombre de tu amigo (opcional)',
    'invite.messagePlaceholder': 'Mensaje personalizado (opcional)',
    'invite.sendButton': 'Enviar Invitaci√≥n',
    'invite.sentSuccess': '¬°Invitaci√≥n enviada con √©xito!',
    'invite.error': 'Error al enviar la invitaci√≥n',
    'invite.invalidEmail': 'Direcci√≥n de email inv√°lida',

    // Contact
    'contact.subject': 'Asunto',
    'contact.message': 'Mensaje',
    'contact.sendMessage': 'Enviar Mensaje',
    'contact.messageSent': '¬°Mensaje enviado con √©xito!',

    // Compte
    'account.settings': 'Configuraci√≥n de Cuenta',
    'account.preferences': 'Preferencias',
    'account.security': 'Seguridad',
    'account.privacy': 'Privacidad',
    'account.notifications': 'Notificaciones',

    // Historique
    'history.clear': 'Limpiar Historial',
    'history.delete': 'Eliminar',
    'history.export': 'Exportar',
    'history.search': 'Buscar en Historial',
    'history.filter': 'Filtrar Historial',
    'history.noResults': 'No se encontraron resultados',
    'history.confirmClear': '¬øEst√°s seguro de que quieres limpiar todo el historial?',

    // Menu utilisateur
    'user.menu': 'Men√∫ de Usuario',
    'user.profile': 'Mi Perfil',
    'user.settings': 'Configuraci√≥n',
    'user.logout': 'Cerrar Sesi√≥n',
    'user.account': 'Mi Cuenta',

    // Placeholders
    'placeholder.linkedinPersonal': 'https://linkedin.com/in/tu-perfil',
    'placeholder.companyName': 'Nombre de tu empresa o negocio',
    'placeholder.companyWebsite': 'https://www.tu-empresa.com',
    'placeholder.linkedinCorporate': 'https://linkedin.com/company/tu-empresa',
    'placeholder.countrySelect': 'Seleccionar un pa√≠s o buscar...',
    'placeholder.currentPassword': 'Ingresa tu contrase√±a actual',
    'placeholder.newPassword': 'Ingresa tu nueva contrase√±a',
    'placeholder.confirmPassword': 'Confirma tu nueva contrase√±a',

    // RGPD et Confidentialit√©
    'gdpr.deleteAccount': 'Eliminar mi cuenta',
    'gdpr.exportData': 'Exportar mis datos',
    'gdpr.confirmDelete': '¬øEst√°s seguro de que quieres eliminar permanentemente tu cuenta? Esta acci√≥n es irreversible.',
    'gdpr.contactSupport': 'Para eliminar permanentemente tu cuenta, por favor contacta support@intelia.com',

    // Pays
    'country.canada': 'Canad√°',
    'country.usa': 'Estados Unidos',
    'country.france': 'Francia',
    'country.belgium': 'B√©lgica',
    'country.switzerland': 'Suiza',
    'country.mexico': 'M√©xico',
    'country.brazil': 'Brasil'
  }
}

// Hook de traduction (avec singleton)
export const useTranslation = () => {
  const [currentLanguage, setCurrentLanguage] = useState<string>('fr')

  // ‚úÖ Initialiser avec la langue de l'utilisateur (utilise le singleton)
  useEffect(() => {
    const getUserLanguage = async () => {
      try {
        // ‚úÖ Le client singleton est d√©j√† initialis√© plus haut
        const { data: { session } } = await supabase.auth.getSession()
        if (session?.user?.user_metadata?.language) {
          setCurrentLanguage(session.user.user_metadata.language)
        }
      } catch (error) {
        console.log('Utilisation de la langue par d√©faut (fr) - singleton')
      }
    }
    getUserLanguage()
  }, [])

  // √âcouter les changements de langue
  useEffect(() => {
    const handleLanguageChange = (event: CustomEvent) => {
      setCurrentLanguage(event.detail.language)
    }

    window.addEventListener('languageChanged', handleLanguageChange as EventListener)
    
    return () => {
      window.removeEventListener('languageChanged', handleLanguageChange as EventListener)
    }
  }, [])

  const t = (key: keyof TranslationKeys): string => {
    return translations[currentLanguage]?.[key] || translations['fr'][key] || key
  }

  const changeLanguage = (newLanguage: string) => {
    setCurrentLanguage(newLanguage)
    // √âmettre l'√©v√©nement pour mettre √† jour d'autres composants
    window.dispatchEvent(new CustomEvent('languageChanged', { 
      detail: { language: newLanguage } 
    }))
  }

  const getCurrentLanguage = () => currentLanguage

  const formatDate = (date: Date) => {
    const locale = t('date.format')
    return date.toLocaleDateString(locale, { 
      day: 'numeric', 
      month: 'long', 
      year: 'numeric' 
    })
  }

  return {
    t,
    changeLanguage,
    getCurrentLanguage,
    formatDate,
    currentLanguage
  }
}

// Fonction utilitaire pour obtenir les langues disponibles
export const getAvailableLanguages = () => [
  { code: 'en', name: 'English', region: 'United States' },
  { code: 'fr', name: 'Fran√ßais', region: 'France' },
  { code: 'es', name: 'Espa√±ol', region: 'Latinoam√©rica' }
]

// Export du type pour utilisation dans d'autres composants
export type { TranslationKeys }